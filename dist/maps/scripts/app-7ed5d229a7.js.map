{"version":3,"sources":["scripts/app-7ed5d229a7.js"],"names":["angular","module","directive","templateUrl","restrict","link","postLink","scope","element","attrs","isSmall","isAlertSymbolDisplayed","isRestrictions","stream","Restrictions","length","isMessage","AlertMessage","getAlertMessage","expand","console","log","getCounties","Counties","map","c","Name","join","getAlternativeNames","LocalNames","StreamApiService","displayedCounties","init","clearCounties","loadMoreCounties","numberOfCountiesToAdd","numberOfDisplayedCounties","numberOfChildCounties","region","children","numberOfCountiesRemaining","Math","min","finalIndex","i","countyToInject","push","getScrollContainer","getRegionScrollBodyId","result","getRegionId","id","displayedStreams","clearStreams","loadMoreStreams","numberOfStreamsToAdd","numberOfDisplayedStreams","numberOfChildStreams","county","numberOfStreamsRemaining","streamToInject","getCountyScrollBodyId","getCountyId","StreamRatioViewModel","model","TroutStreamsLength","PalsLength","streamRatio","stage","isLoaded","streams","selectedStream","$watch","newSelectedStream","oldSelectedStream","controller","$scope","TableOfContentsRepository","RegionGeometryService","$anchorScroll","isSmallView","getInitialMapState","mapState","isExpanded","isLoading","selectedRegionGeometry","selectedRegion","selectedCounty","highlightedStream","currentClientCoordinates","NaN","selectCounty","countyId","selectRegion","regionModel","Error","canRetrieveFromCache","stateModel","parent","getRegion","then","newSelectedRegionGeometry","getTableOfContents","toc","bustCache","bustTableOfContentsCache","toggleMinimap","LinearReferenceViewModel","parseFloat","LengthMiles","inverseLength","width","createTickMarks","clampedLength","floor","tickMarks","xOffset","height","yOffset","tickWidth","drawLines","streamLine","d3","select","append","attr","publicSegments","Pal","Sections","segment","publicLand","selectAll","data","enter","d","lakes","Lakes","accessPoints","AccessPoints","TroutStreams","troutStreamSections","forEach","restriction","index","restrictionModels","linearReferenceViewModel","roadIntersections","LinearOffset","IsOverOrNearPublicLand","firstMark","fsm","$rootScope","replace","scrollBody","scrollStop","scrollableContainer","contentOffset","scrollObject","zIndexOverride","attributes","control","header","$","this","getContent","candidateContent","content","clonedHeader","window","setColumnHeaderSizes","is","clonedColumns","find","each","column","clonedColumn","css","offsetWidth","determineVisibility","scrollTop","currentContent","contentTop","offset","top","contentBottom","outerHeight","createClone","visibility","calculateSize","remove","removeClass","position","left","z-index","outerWidth","$broadcast","clone","after","addClass","on","trigger","$on","off","$location","el","navigationMenu","menuTitles","menuItems","activeMenu","menuOnClick","e","menuTitle","currentTarget","submenu","next","slideToggle","chevron","toggleClass","menuOnKeydown","getCurrentMenuItem","keyCode","tabOutOfMenu","triggerMenuItem","highlightMenuItem","shiftKey","focus","firstTabItem","preventDefault","stopPropagation","first","focusedMenu","menuOnFocus","click","keydown","path","allMenuItems","menuItem","menu","split","indexOf","parentElement","submenus","parents","show","chevrons","prev","menuButton","bodyOnKeydown","ctrlKey","altKey","isMenuClosed","hasClass","setMenuSpin","setTimeout","$filter","transclude","orderBy","currentPage","pagedDataName","fsmBigData","rightHandExpression","pageSize","parseInt","sourceData","rawData","sortedData","pagedData","page","sortTypes","sortColumns","transcludedScope","nextPage","dataSlice","slice","apply","renderData","addSortColumn","columnName","sortType","splice","direction","unshift","onPageScroll","s","document","scrollPercent","$apply","$parent","$watchCollection","newData","sortIconTemplate","columnHeader","fsmSort","sortIcon","currentSortType","swapIcons","classToAdd","applySort","cursor","MINI_MAP_CLASS","GeometryApiService","$q","$timeout","minimapState","regionGeometries","selectedRegionId","selectedCountyId","isMacro","loadingRegion","active","event","item","type","name","unwatchRegionId","newRegionId","oldRegionId","soughtRegion","currentRegions","filter","f","zoomToGeometry","unwatchCountyId","newCounty","oldCounty","soughtCounty","currentCounties","unwatchGeometries","newGeometries","oldGeometries","drawGeometries","geometries","root","highlightCounty","zoomToRegion","regionId","initializeMap","stateObject","projection","geo","albersUsa","scale","translate","pointRadius","state","geometry","b","bounds","max","t","zoom","behavior","scaleExtent","size","zoomed","svg","stopped","onBackgroundClick","counties","states","regions","onRegionClick","onLoadRegion","bind","resetLoadRegion","minifyMinimap","macrofyMinimap","isMacroMode","reset","drawGeometryToMap","getFipsCodeSelector","shortName","classed","transition","duration","call","style","regionElement","arrayOfStreams","selectedStreams","_","unique","flatten","streamObjects","Id","delay","exit","node","dx","dy","x","y","getFipsCode","countyFeature","fips","statefp","countyfp","attribute","defaultPrevented","pluck","value","currentState","minStreamCount","countyStreamCounts","feat","stream_count","maxStreamCount","countyChoroplethScale","linear","domain","range","unwatchTableOfContents","factory","RectangleLayoutService","proto","prototype","getScale","itemLength","sqrt","getXGivenY","getYGivenX","pythagoreanTheorem","getBoundingBox","numberOfItems","minimumXPosition","minimumYPosition","xPrime","ceil","yPrime","newYLength","yZLength","newXLength","xZLength","candidate","ROOT_CLASS","WIDTH","HEIGHT","troutStreamIntersections","IsOverOrNearTroutStreamSection","sort","a","denominator","publicTroutStreamIntersections","numerator","rows","generator","dimensions","numberOfColumns","numberOfRows","boxWidth","widthOfContainer","heightOfContainer","container","xPosition","yPosition","BaseApiService","HierarchicalGeometryViewModel","TABLE_OF_CONTENTS_CACHE_KEY","COUNTIES_CACHE_KEY","REGIONS_CACHE_KEY","logCache","Object","create","key","cache","get","promise","doCall","regionTopoJson","topojson","feature","objects","streamProperties","stateHash","features","prop","properties","gid","centroidLatitude","short_name","centroidLongitude","indexBy","regionHash","sortBy","countyhash","countyModel","extend","countyByRegion","groupBy","minnesota","regionByState","streamHash","streamModel","CentroidLongitude","CentroidLatitude","stateId","streamCountyModel","put","BaseCollection","HierarchicalGeometryCollection","constructor","RegionRepositoryService","getRegions","isCached","regionid","cacheRegion","uncacheRegion","REGION_CACHE_KEY","createKey","RegionApiService","regionKey","createPath","totalLength","publicLandLength","computeRadiusFromLength","area","PI","waterRadius","publicLandLengthTOWaterLengthRatio","publicLandRadius","$cacheFactory","$http","getStreams","deferred","defer","gettingData","response","resolve","StreamLineViewModel","lineSegment","stop","Stop","start","Start","abs","getRegionGeometries","BaseModel","json","_fromJSON","hasOwnProperty","toJSON","hash","destroy","generateIdomaticName","udefOrArray","_models","_addAll","toArray","copy","arrayOrUndefined","modelData","len","add","instanceModel","modelDataOrId","referenceToModelOrId","_removeByModel","_removeById","empty","sortFn","sortDesc","modelA","modelB","sortByType","sortByString","sortByCount","sortByNumber","useLowercase","toLowerCase","at","getPage","pageNumber","perPage","startIndex","endIndex","contains","merge","otherCollection","self","removed","added","methods","method","args","Array","arguments","SORT","TYPE","ARRAY_LENGTH","STRING","DATE","NUMBER","sessionStorage","DEBUGGER_LATENCY","globalCache","resetCache","removeAll","info","endpoint","config","url","API_BASE_PATH","params","exceptionType","reject","catch","reason","run","runBlock","$log","debug","$inject","routerConfig","$stateProvider","$urlRouterProvider","controllerAs","otherwise","$logProvider","debugEnabled","$templateCache"],"mappings":"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","file":"scripts/app-7ed5d229a7.js","sourcesContent":["(function() {\n  'use strict';\n  angular.module('fsm', []);\n  angular\n    .module('troutSpotr', ['ngAnimate', 'ngCookies', 'ngAria', 'ui.router', 'fsm', 'infinite-scroll']);\n\n})();\n\n'use strict';\n\n/**\n * @ngdoc directive\n * @name troutDashApp.directive:StreamListItemDirective\n * @description\n * # StreamListItemDirective\n */\nangular.module('troutSpotr')\n  .directive('streamListItemDirective', function() {\n    return {\n      templateUrl: 'app/ui/streamList/streamListItem/streamlistitemtemplate.html',\n      restrict: 'A',\n      link: function postLink(scope, element, attrs) {\n        scope.isSmall = true;\n        scope.isAlertSymbolDisplayed = function() {\n          if (scope.isSmall === false) {\n            return false;\n          }\n\n          var isRestrictions = scope.stream.Restrictions.length > 0;\n          var isMessage = scope.stream.AlertMessage != null && scope.stream.AlertMessage.length > 0;\n\n          if (isRestrictions && isMessage) {\n            return true;\n          }\n        };\n\n        scope.getAlertMessage = function() {\n          return scope.stream.AlertMessage;\n        };\n\n        scope.expand = function() {\n          scope.isSmall = !scope.isSmall;\n          console.log(scope.stream);\n        };\n\n        scope.getCounties = function() {\n          if (!scope.stream.Counties) {\n            return null;\n          }\n\n          return scope.stream.Counties.map(function(c) {\n            return c.Name;\n          }).join(',');\n        };\n\n        scope.getAlternativeNames = function() {\n          if (!scope.stream.LocalNames) {\n            return null;\n          }\n\n          if (scope.stream.LocalNames.length === 0) {\n            return '';\n          }\n\n          return 'aka ' + scope.stream.LocalNames.join(',');\n        };\n      }\n    };\n  });\n'use strict';\n\n/**\n * @ngdoc directive\n * @name troutDashApp.directive:StreamListItemDirective\n * @description\n * # StreamListItemDirective\n */\nangular.module('troutSpotr')\n  .directive('streamListItemHeader', function () {\n    return {\n      templateUrl: 'app/ui/streamList/streamListItem/StreamListItemHeaderTemplate.html',\n      restrict: 'A',\n      link: function postLink(scope, element, attrs) {\n\n      }\n    };\n  });\n\n'use strict';\n/**\n * @ngdoc directive\n * @name troutDashApp.directive:StreamListDirective\n * @description\n * # StreamListDirective\n */\nangular.module('troutSpotr')\n  .directive('regionHeader', ['StreamApiService',\n    function(StreamApiService) {\n      return {\n        //app/ui/main/main.html\n        templateUrl: 'app/ui/streamList/region/RegionHeaderTemplate.html',\n        restrict: 'A',\n        link: function postLink(scope, element, attrs) {\n          scope.displayedCounties = [];\n\n          scope.init = function() {\n            scope.clearCounties();  \n          };\n\n          scope.clearCounties = function() {\n            scope.displayedCounties = [];\n          };\n\n          scope.loadMoreCounties = function(numberOfCountiesToAdd) {\n            var numberOfDisplayedCounties = scope.displayedCounties.length;\n            var numberOfChildCounties = scope.region.children.length;\n\n            numberOfCountiesToAdd = numberOfCountiesToAdd == null ? 1 : numberOfCountiesToAdd;\n            var numberOfCountiesRemaining = numberOfChildCounties - numberOfDisplayedCounties;\n            numberOfCountiesToAdd = Math.min(numberOfCountiesRemaining, numberOfCountiesToAdd);\n            var finalIndex = numberOfDisplayedCounties + numberOfCountiesToAdd;\n            for (var i = numberOfDisplayedCounties; i < finalIndex; i++) {\n              var countyToInject = scope.region.children[i];\n              scope.displayedCounties.push(countyToInject);\n            }\n          };\n\n          scope.getScrollContainer = function() {\n            return '#js-list-container';\n          };\n\n          scope.getRegionScrollBodyId = function(region) {\n            var result = '#' + scope.getRegionId(region);\n            return result;\n          };\n\n          scope.getRegionId = function(region) {\n            var result = 'hdr-region_' + region.id;\n            return result;\n          };\n\n          scope.init();\n        }\n      };\n    }\n  ]);\n'use strict';\n/**\n * @ngdoc directive\n * @name troutDashApp.directive:StreamListDirective\n * @description\n * # StreamListDirective\n */\nangular.module('troutSpotr')\n  .directive('countyHeader', ['StreamApiService',\n    function(StreamApiService) {\n      return {\n        //app/ui/main/main.html\n        templateUrl: 'app/ui/streamList/county/CountyHeaderTemplate.html',\n        restrict: 'A',\n        link: function postLink(scope, element, attrs) {\n          scope.displayedStreams = [];\n\n          scope.init = function() {\n            scope.clearStreams();  \n          };\n\n          scope.clearStreams = function() {\n            scope.displayedStreams = [];\n          };\n\n          scope.loadMoreStreams = function(numberOfStreamsToAdd) {\n            var numberOfDisplayedStreams = scope.displayedStreams.length;\n            var numberOfChildStreams = scope.county.children.length;\n\n            numberOfStreamsToAdd = numberOfStreamsToAdd == null ? 30 : numberOfStreamsToAdd;\n            var numberOfStreamsRemaining = numberOfChildStreams - numberOfDisplayedStreams;\n            numberOfStreamsToAdd = Math.min(numberOfStreamsRemaining, numberOfStreamsToAdd);\n            var finalIndex = numberOfDisplayedStreams + numberOfStreamsToAdd;\n            for (var i = numberOfDisplayedStreams; i < finalIndex; i++) {\n              var streamToInject = scope.county.children[i];\n              scope.displayedStreams.push(streamToInject);\n            }\n          };\n\n          scope.getCountyScrollBodyId = function(county) {\n            var result = '#' + scope.getCountyId(county);\n            return result;\n          };\n\n          scope.getScrollContainer = function() {\n            return '#js-list-container';\n          };\n\n          scope.getCountyId = function(county) {\n            return 'hdr-county_' + county.id;\n          };\n\n          scope.init();\n        }\n      };\n    }\n  ]);\n'use strict';\n\n/**\n * @ngdoc directive\n * @name troutDashApp.directive:streamRatio\n * @description\n * # streamRatio\n */\nangular.module('troutSpotr')\n  .directive('streamRatio', function (StreamRatioViewModel) {\n    return {\n      templateUrl: 'app/ui/streamRatio/streamratiotemplate.html',\n      restrict: 'A',\n      link: function postLink(scope, element, attrs) {\n        var model = new StreamRatioViewModel(scope.stream.TroutStreamsLength, scope.stream.PalsLength);\n        scope.streamRatio = model;\n      }\n    };\n  });\n\n'use strict';\n/**\n * @ngdoc directive\n * @name troutDashApp.directive:StreamListDirective\n * @description\n * # StreamListDirective\n */\nangular.module('troutSpotr')\n  .directive('streamList', ['StreamApiService',\n    function(StreamApiService) {\n      return {\n        //app/ui/main/main.html\n        templateUrl: 'app/ui/streamList/streamlisttemplate.html',\n        restrict: 'A',\n        link: function postLink(scope, element, attrs) {\n          scope.stage = {\n            isLoaded: false,\n            streams: null,\n            selectedStream: null\n          };\n\n          // scope.getScrollContainer = function() {\n          //   return '#js-list-container';\n          // };\n\n          // scope.getRegionScrollBodyId = function(region) {\n          //   var result = '#' + scope.getRegionId(region);\n          //   return result;\n          // };\n\n          // scope.getRegionId = function(region) {\n          //   var result = 'hdr-region_' + region.id;\n          //   return result;\n          // };\n\n          scope.getScrollContainer = function() {\n            return '#js-list-container';\n          };\n\n          scope.$watch('stage.selectedStream', function(newSelectedStream, oldSelectedStream) {\n            if (newSelectedStream == null) {\n              return;\n            }\n          });\n        }\n      };\n    }\n  ]);\n'use strict';\n\n/**\n * @ngdoc function\n * @name troutDashApp.controller:StreamlistcontrollerCtrl\n * @description\n * # StreamlistcontrollerCtrl\n * Controller of the troutDashApp\n */\nangular.module('troutSpotr')\n\t.controller('StreamlistcontrollerCtrl', ['$scope', 'StreamApiService', \n\t\t'TableOfContentsRepository', 'RegionGeometryService', \n\t\t'$anchorScroll',\n\t\tfunction ($scope, StreamApiService, TableOfContentsRepository, RegionGeometryService, $anchorScroll) {\n\t\t$scope.isSmallView = false;\n\n\t\tvar getInitialMapState = function() {\n\t\t\tvar mapState = {\n\t\t\t\tisExpanded: false,\n\t\t\t\tisLoading: false,\n\t\t\t\tselectedRegionGeometry: null,\n\t\t\t\tselectedRegion: null,\n\t\t\t\tselectedCounty: null,\n\t\t\t\thighlightedStream: null,\n\t\t\t\tcurrentClientCoordinates: [NaN, NaN]\n\t\t\t};\n\t\t\treturn mapState;\n\t\t};\n\n\t\t$scope.mapState = getInitialMapState();\n\n\t\t$scope.selectCounty = function(countyId) {\n\t\t\tconsole.log(countyId);\n\t\t};\n\n\t\t$scope.selectRegion = function(regionModel) {\n\t\t\tif (regionModel == null) {\n\t\t\t\tthrow new Error('regionModel cannot be null');\n\t\t\t}\n\n\t\t\t\n\n\t\t\t// TODO: fix this to have an actual cache.\n\t\t\t// try to pull it from the cache\n\t\t\tvar canRetrieveFromCache = false;\n\t\t\tif (canRetrieveFromCache) {\n\t\t\t\t// return it from our cache.\n\t\t\t\t// TODO: fix this part too\n\t\t\t\t$scope.mapState.selectedRegionGeometry = null;\n\t\t\t\t$scope.mapState.selectedRegion = [regionModel];\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// load it from our repository.\n\t\t\tvar stateModel = regionModel.parent;\n\t\t\treturn RegionGeometryService.getRegion(stateModel, regionModel)\n\t\t\t\t.then(function(newSelectedRegionGeometry) {\n\t\t\t\t\t$scope.mapState.selectedRegionGeometry = [newSelectedRegionGeometry];\n\t\t\t\t\t$scope.mapState.selectedRegion = [regionModel];\n\t\t\t\t\t$anchorScroll('region-hdr_' + regionModel.id);\n\t\t\t\t\treturn newSelectedRegionGeometry;\n\t\t\t\t});\n\t\t};\n\n\t\t$scope.getTableOfContents = function() {\n\t\t\treturn TableOfContentsRepository.getTableOfContents()\n\t\t\t\t.then(function(toc) {\n\t\t\t\t\treturn toc;\n\t\t\t\t});\n\t\t};\n\n\t\t$scope.bustCache = function() {\n\t\t\tconsole.log('busting cache...');\n\t\t\t// this is actually going directly to the base cache...\n\t\t\tTableOfContentsRepository.bustTableOfContentsCache();\n\t\t};\n\n\t\t$scope.toggleMinimap = function() {\n\t\t\tif ($scope.mapState == null) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$scope.mapState.isExpanded = !$scope.mapState.isExpanded;\n\t\t};\n\t}]);\n\n'use strict';\n\n/**\n * @ngdoc directive\n * @name troutDashApp.directive:streamLine\n * @description\n * # streamLine\n */\nangular.module('troutSpotr')\n  .directive('streamLine', function(LinearReferenceViewModel) {\n    return {\n      templateUrl: 'app/ui/streamLine/streamlinetemplate.html',\n      restrict: 'A',\n      link: function(scope, element, attrs) {\n        var length = parseFloat(scope.stream.LengthMiles);\n        if (length <= 0) {\n          return;\n        }\n        var inverseLength = 1 / length;\n        scope.stage = {\n          width: element.width()\n        };\n\n        var createTickMarks = function(LengthMiles) {\n          var clampedLength = Math.floor(length);\n          var tickMarks = [];\n          if (clampedLength < 1) {\n            tickMarks.push({\n              xOffset: 0,\n              width: 1,\n              height: 3,\n              yOffset: 7\n            });\n\n            return tickMarks;\n          }\n\n          var tickWidth = scope.stage.width / LengthMiles;\n          for (var i = 0; i <= clampedLength; i++) {\n            tickMarks.push({\n              xOffset: i * tickWidth,\n              width: 1.5,\n              height: 4,\n              yOffset: 8\n            });\n          }\n\n          return tickMarks;\n        };\n\n\n        scope.drawLines = function() {\n\n          var length = parseFloat(scope.stream.LengthMiles);\n          var inverseLength = 1 / length;\n          scope.streamLine = d3.select(element[0])\n            .append('svg')\n            .attr('class', 'stream-line')\n            .attr('width', scope.stage.width)\n            .attr('height', 16)\n            .attr('xmlns', 'http://www.w3.org/2000/svg');\n\n          // PUBLIC LAND\n          // Prepare\n          scope.publicSegments = scope.stream.Pal.Sections.map(function(segment) {\n            return new LinearReferenceViewModel(segment, inverseLength);\n          });\n\n          // Stage\n          scope.streamLine.publicLand = scope.streamLine.append('g')\n            .attr('class', 'stream-line_public-land');\n\n          // Execute\n          scope.streamLine.publicLand.selectAll('rect')\n            .data(scope.publicSegments).enter()\n            .append('rect')\n            .attr('x', function(d) {\n              return d.xOffset * scope.stage.width;\n            })\n            .attr('y', 0)\n            .attr('width', function(d) {\n              return d.width * scope.stage.width;\n            })\n            .attr('height', 11)\n            .attr('rx', 4)\n            .attr('ry', 4)\n            .attr('class', 'public-land');\n\n\n          // STREAM LINE\n          scope.streamLine.stream = scope.streamLine.append('g')\n            .attr('class', 'stream-line_stream')\n            .append('rect')\n            .attr('x', 0)\n            .attr('y', 3)\n            .attr('height', 5)\n            .attr('width', scope.stage.width);\n\n          // LAKES\n          // Prepare\n          scope.lakes = scope.stream.Lakes.Sections.map(function(segment) {\n            return new LinearReferenceViewModel(segment, inverseLength);\n          });\n\n          scope.accessPoints = scope.stream.AccessPoints;\n\n          // Stage\n          scope.streamLine.lakes = scope.streamLine.append('g')\n            .attr('class', 'stream-line_stream'); // TODO: CHANGE TO LAKE CLASS\n\n          // Execute\n          scope.streamLine.lakes.selectAll('rect')\n            .data(scope.lakes).enter()\n            .append('rect')\n            .attr('x', function(d) {\n              return d.xOffset * scope.stage.width;\n            })\n            .attr('y', 1)\n            .attr('width', function(d) {\n              return d.width * scope.stage.width;\n            })\n            .attr('height', 9)\n            .attr('rx', 4)\n            .attr('ry', 4)\n            .attr('class', 'stream-line_stream');\n\n\n\n          // TROUT STREAM SECTIONS\n          scope.publicSegments = scope.stream.TroutStreams.Sections.map(function(segment) {\n            return new LinearReferenceViewModel(segment, inverseLength);\n          });\n\n          // Stage\n          scope.streamLine.troutStreamSections = scope.streamLine.append('g')\n            .attr('class', 'stream-line_route');\n\n          // Execute\n          scope.streamLine.append('g')\n            .attr('class', 'stream-line_route')\n            .selectAll('g').data(scope.publicSegments).enter()\n            .append('g')\n            .append('rect')\n            .attr('x', function(d) {\n              return d.xOffset * scope.stage.width;\n            })\n            .attr('y', 3)\n            .attr('width', function(d) {\n              return d.width * scope.stage.width;\n            })\n            .attr('height', 5)\n            .attr('class', 'stream-line_route');\n\n          // RESTRICTIONS\n          scope.stream.Restrictions.forEach(function(restriction, index) {\n\n            var restrictionModels = restriction.Sections.map(function(segment) {\n              var linearReferenceViewModel = new LinearReferenceViewModel(segment, inverseLength);\n              segment.segment = linearReferenceViewModel;\n              return segment;\n            });\n\n            scope.streamLine.append('g')\n              .attr('class', index === 0 ? 'stream-line_restriction' : 'stream-line_restriction_secondary')\n              .selectAll('g').data(restrictionModels).enter()\n              .append('g')\n              // .selectAll('rect').data(function(d) {\n              //     return d.segment;\n              // }).enter()\n              .append('rect')\n              .attr('x', function(d) {\n                return d.segment.xOffset * scope.stage.width;\n              })\n              .attr('y', 3)\n              .attr('width', function(d) {\n                return d.segment.width * scope.stage.width;\n              })\n              .attr('height', 5)\n              .attr('class', 'restriction');\n          });\n\n          scope.streamLine.roadIntersections = scope.streamLine.append('g')\n            .attr('class', 'stream-line_roadIntersections');\n\n\n          scope.streamLine.roadIntersections.selectAll('circle')\n            .data(scope.accessPoints).enter()\n            .append('circle')\n            .attr('cy', 5)\n            .attr('r', 2)\n            .attr('cx', function(d) {\n              return (1 - (d.LinearOffset / length)) * scope.stage.width;\n            })\n            .attr('class', function(d) {\n              return d.IsOverOrNearPublicLand ? 'roadIntersetion_public' : 'roadIntersetion_private';\n            });\n\n          var tickMarks = createTickMarks(length);\n          var firstMark = tickMarks[0];\n\n          firstMark.width = 1;\n          firstMark.height = 3;\n          scope.streamLine.tickMarks = scope.streamLine\n            .append('g')\n            .attr('class', 'stream-line_grid-lines')\n            .selectAll('rect').data(tickMarks).enter()\n            .append('rect')\n            .attr('x', function(d) {\n              return scope.stage.width - d.xOffset - d.width;\n            })\n            .attr('y', function(d) {\n              return d.yOffset;\n            })\n            .attr('width', function(d) {\n              return d.width;\n            })\n            .attr('height', function(d) {\n              return d.height;\n            })\n            .attr('class', 'tick');\n        };\n\n\n\n        scope.drawLines();\n      }\n    };\n  });\n'use strict';\n(function(angular) {\n    var fsm = angular.module('fsm');\n\n    fsm.directive('fsmStickyHeader', ['$rootScope', function($rootScope) {\n        return {\n            restrict: 'EA',\n            replace: false,\n            scope: {\n                scrollBody: '=',\n                scrollStop: '=',\n                scrollableContainer: '=',\n                contentOffset: '=',\n                scrollObject: '=',\n                zIndexOverride: '='\n            },\n            link: function(scope, element, attributes, control) {\n                var header = $(element, this);\n                var getContent = function() {\n\n                    var candidateContent;\n                    if (content == null || content.length !== 1) {\n                        content = $(scope.scrollBody);\n                    }\n\n                    return content;\n                };\n\n                scope.zIndexOverride = scope.zIndexOverride != null ? scope.zIndexOverride : 10000;\n\n                var content = getContent();\n                var clonedHeader = null;\n                var content = $(scope.scrollBody);\n                var scrollableContainer = $(scope.scrollableContainer);\n                var contentOffset = scope.contentOffset || 0;\n\n                if (scrollableContainer.length === 0) {\n                    scrollableContainer = $(window);\n                }\n\n                function setColumnHeaderSizes() {\n                    if (clonedHeader.is('tr') || clonedHeader.is('thead')) {\n                        var clonedColumns = clonedHeader.find('th');\n                        header.find('th').each(function(index, column) {\n                            var clonedColumn = $(clonedColumns[index]);\n                            clonedColumn.css('width', column.offsetWidth + 'px');\n                        });\n                    }\n                };\n\n                function determineVisibility() {\n                    var scrollTop = scrollableContainer.scrollTop() + scope.scrollStop;\n                    var currentContent = getContent();\n                    if (currentContent.length !== 1) {\n                        return;\n                    }\n                    var contentTop = currentContent.offset().top;\n                    var contentBottom = contentTop + currentContent.outerHeight(false);\n\n                    if ((scrollTop > contentTop) && (scrollTop < contentBottom)) {\n                        if (!clonedHeader) {\n                            createClone();\n                            clonedHeader.css({\n                                \"visibility\": \"visible\"\n                            });\n                        }\n\n                        if (scrollTop < contentBottom && scrollTop > contentBottom - clonedHeader.outerHeight(false)) {\n                            var top = contentBottom - scrollTop + scope.scrollStop - clonedHeader.outerHeight(false);\n                            clonedHeader.css('top', top + 'px');\n                        } else {\n                            calculateSize();\n                        }\n                    } else {\n                        if (clonedHeader) {\n                            /*\n                             * remove cloned element (switched places with original on creation)\n                             */\n                            header.remove();\n                            header = clonedHeader;\n                            clonedHeader = null;\n\n                            header.removeClass('fsm-sticky-header');\n                            header.css({\n                                position: 'relative',\n                                left: 0,\n                                top: 0,\n                                width: 'auto',\n                                'z-index': 0,\n                                visibility: 'visible'\n                            });\n                        }\n                    }\n                };\n\n                function calculateSize() {\n                    clonedHeader.css({\n                        top: scope.scrollStop,\n                        width: header.outerWidth(),\n                        left: header.offset().left\n                    });\n\n                    setColumnHeaderSizes();\n                };\n\n                function createClone() {\n                    /*\n                     * switch place with cloned element, to keep binding intact\n                     */\n                    $rootScope.$broadcast('header-clone', scope.scrollObject);\n                    clonedHeader = header;\n                    header = clonedHeader.clone();\n                    clonedHeader.after(header);\n                    clonedHeader.addClass('fsm-sticky-header');\n                    clonedHeader.css({\n                        position: 'fixed',\n                        'z-index': scope.zIndexOverride,\n                        visibility: 'hidden'\n                    });\n                    calculateSize();\n                };\n\n                scrollableContainer.on('scroll.fsmStickyHeader', determineVisibility).trigger(\"scroll\");\n                scrollableContainer.on('resize.fsmStickyHeader', determineVisibility);\n\n                scope.$on('$destroy', function() {\n                    scrollableContainer.off('.fsmStickyHeader');\n                });\n            }\n        };\n    }]);\n\n    fsm.directive('fsmMenu', ['$location', function($location) {\n        return {\n            restrict: 'A',\n            scope: {},\n            link: function(scope, el, attrs) {\n                var navigationMenu = angular.element(el);\n                var menuTitles = navigationMenu.find('.fsm-menu-title');\n                var menuItems = navigationMenu.find('[tc-menu-item]:visible');\n                var activeMenu = 0;\n\n                function menuOnClick(e) {\n                    var menuTitle = angular.element(e.currentTarget);\n                    // Find if our menu item has submenu items\n                    var submenu = menuTitle.next('.fsm-sub-menu');\n\n                    // If there is submenus, then we wan to either open or close the folder\n                    submenu.slideToggle('fast', function() {\n                        // swap the arrow from up to down, or vise-versa\n                        var chevron = menuTitle.children('[class*=\\'fa-chevron\\']');\n                        chevron.toggleClass('fa-chevron-down fa-chevron-up');\n\n                        // Find the list of currently visible menu items for keyboarding through.\n                        menuItems = navigationMenu.find('[tc-menu-item]:visible');\n                    });\n\n                }\n\n                function menuOnKeydown(e) {\n                    activeMenu = getCurrentMenuItem();\n\n                    if (e.keyCode === 9) {\n                        tabOutOfMenu(e);\n                    } else if (e.keyCode === 13 || e.keyCode === 37 || e.keyCode === 39) {\n                        triggerMenuItem(e);\n                    } else if (e.keyCode === 38 || e.keyCode === 40) {\n                        highlightMenuItem(e);\n                    }\n                }\n\n                function tabOutOfMenu(e) {\n                    if (e.shiftKey) {\n                        $('[fsm-menu-button]').focus();\n                    } else {\n                        var firstTabItem = $('[tabindex=1]');\n\n                        if (firstTabItem.length == 0) {\n                            return;\n                        } else {\n                            firstTabItem.focus();\n                        }\n                    }\n\n                    e.preventDefault();\n                    e.stopPropagation();\n                }\n\n                function triggerMenuItem(e) {\n                    e.currentTarget = $(menuItems[activeMenu]).children('a').first();\n                    menuOnClick(e);\n                }\n\n                function highlightMenuItem(e) {\n                    e.preventDefault();\n                    e.stopPropagation();\n\n                    if (e.keyCode === 38) {\n                        if (activeMenu > 0) {\n                            $(menuItems[activeMenu - 1]).children('a').first().focus();\n                        } else {\n                            $(menuItems[menuItems.length - 1]).children('a').first().focus();\n                        }\n                    } else if (e.keyCode === 40) {\n                        if (activeMenu < (menuItems.length - 1)) {\n                            $(menuItems[activeMenu + 1]).children('a').first().focus();\n                        } else {\n                            $(menuItems[0]).children('a').first().focus();\n                        }\n                    }\n                }\n\n                function getCurrentMenuItem() {\n                    var focusedMenu = navigationMenu.find(':focus');\n\n                    if (focusedMenu.length === 1) {\n                        return menuItems.index(focusedMenu.parent('[tc-menu-item]').first());\n                    }\n\n                    return menuItems.index(navigationMenu.find('[tc-menu-item].active').first());\n                }\n\n                function menuOnFocus(e) {\n                    e.preventDefault();\n                    e.stopPropagation();\n\n                    activeMenu = getCurrentMenuItem();\n                    $(menuItems[activeMenu]).children('a').first().focus();\n                }\n\n                menuTitles.click(menuOnClick);\n                navigationMenu.keydown(menuOnKeydown);\n                navigationMenu.focus(menuOnFocus);\n\n                scope.$watch(function() {\n                    return $location.path();\n                }, function(path) {\n                    // grab all the a tags that start with #, indicating and angular route.\n                    var allMenuItems = el.find('a[href^=\\'#\\']');\n\n                    angular.forEach(allMenuItems, function(menuItem) {\n                        var menu = angular.element(menuItem);\n                        var link = menu.attr('href').split('#')[1];\n\n                        if (path.indexOf(link) == 0) {\n                            // activate the menu item\n                            angular.element(menuItem.parentElement).addClass('active');\n\n                            // open up the submenus if they are not open\n                            var submenus = menu.parents('.fsm-sub-menu');\n                            submenus.show();\n\n                            // turn the chevrons up on the menu titles\n                            var chevrons = submenus.prev().children('[class*=\\'fa-chevron\\']');\n                            chevrons.removeClass('fa-chevron-down');\n                            chevrons.addClass('fa-chevron-up');\n                        } else {\n                            angular.element(menuItem.parentElement).removeClass('active');\n                        }\n                    });\n\n                    menuItems = navigationMenu.find('[tc-menu-item]:visible');\n                });\n            }\n        }\n    }]);\n\n    fsm.directive('fsmMenuButton', function() {\n        return {\n            restrict: 'EA',\n            replace: false,\n            scope: {},\n            link: function(scope, element, attributes, control) {\n                var menuButton = $(element, this);\n\n                menuButton.addClass('fsm-menu-button');\n                menuButton.keydown(menuOnKeydown);\n                $('body').keydown(bodyOnKeydown);\n\n                function bodyOnKeydown(e) {\n                    if (e.keyCode === 77 && e.ctrlKey && e.altKey) {\n                        if (isMenuClosed()) {\n                            menuOnClick();\n                        }\n                        $('[fsm-menu]').focus();\n                    } else if (e.keyCode === 77 && e.ctrlKey) {\n                        menuButton.focus();\n                        menuOnClick();\n                    }\n                }\n\n                function isMenuClosed() {\n                    return $('body').hasClass('fsm-menu-toggle');\n                }\n\n                function menuOnClick() {\n                    $('body').toggleClass('fsm-menu-toggle');\n                    setMenuSpin();\n                    setTimeout(setMenuSpin, 50);\n                };\n\n                function menuOnKeydown(e) {\n                    if (e.keyCode === 32 || e.keyCode === 13) {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        menuOnClick();\n                    }\n                }\n\n                function setMenuSpin() {\n                    menuButton.find('.fsm-menu-button-open').toggleClass('fsm-spin-forward');\n                    menuButton.find('.fsm-menu-button-close').toggleClass('fsm-spin-backward');\n                };\n\n                menuButton.on('click.fsmMenuButton', menuOnClick);\n\n                scope.$on('$destroy', function() {\n                    menuButton.off('.fsmMenuButton');\n                });\n            }\n        }\n    });\n\n    fsm.directive('fsmBigData', ['$filter', function($filter) {\n\n        return {\n            restrict: 'AE',\n            scope: {},\n            replace: false,\n            transclude: true,\n            link: function(scope, element, attrs, controller, transclude) {\n                var orderBy = $filter('orderBy');\n                var currentPage = 0;\n                var pagedDataName = attrs.fsmBigData.split(' of ')[0];\n                var rightHandExpression = attrs.fsmBigData.split(' of ')[1];\n                var pageSize = parseInt(rightHandExpression.split(' take ')[1], 10);\n                var sourceData = rightHandExpression.split(' take ')[0];\n\n                // Interesting things can be done here with the source object...\n                // var displayGetter = $parse(sourceData);\n                // var displaySetter = displayGetter.assign;\n                // var results = orderBy(displayGetter(scope.$parent), sortColumns);\n                // displaySetter(scope.$parent, results)\n\n                var rawData = [];\n                var sortedData = [];\n                var pagedData = [];\n                var page = $(window);\n                var sortTypes = ['None', 'Ascending', 'Descending'];\n                var sortColumns = [];\n\n                transclude(function(clone, transcludedScope) {\n\n                    transcludedScope.sortTypes = sortTypes;\n\n                    element.append(clone);\n                    transcludedScope[pagedDataName] = pagedData;\n\n                    function nextPage() {\n                        var dataSlice = sortedData.slice(pageSize * currentPage, (pageSize * (currentPage + 1)));\n                        if (dataSlice.length > 0) {\n                            pagedData.push.apply(pagedData, dataSlice);\n                            currentPage++;\n                        }\n                    }\n\n                    function renderData() {\n                        if (sortColumns.length) {\n                            sortedData = orderBy(rawData, sortColumns);\n                        } else {\n                            sortedData = rawData;\n                        }\n\n                        pagedData.length = 0;\n                        currentPage = 0;\n                        nextPage();\n                    }\n\n                    function addSortColumn(columnName, sortType) {\n\n                        // If this column is currently in the sort stack, remove it.\n                        for (var i = 0; i < sortColumns.length; i++) {\n                            if (sortColumns[i].indexOf(columnName) > -1) {\n                                sortColumns.splice(i, 1);\n                            }\n                        }\n\n                        // Push this sort on the top of the stack (aka. array)\n                        if (sortType > 0) {\n                            var direction = '';\n                            if (sortTypes[sortType] === 'Descending') {\n                                direction = '-';\n                            }\n                            sortColumns.unshift(direction + columnName);\n                        }\n\n                        renderData();\n                    }\n\n                    function onPageScroll() {\n                        var s = $(window).scrollTop();\n                        var d = $(document).height();\n                        var c = $(window).height();\n                        var scrollPercent = (s / (d - c));\n\n                        if (scrollPercent > 0.98) {\n                            // We use scope.apply here to tell angular about these changes because \n                            // they happen outside of angularjs context... we're using jquery here\n                            // to figure out when we need to load another page of data.\n                            transcludedScope.$apply(nextPage);\n                        }\n                    }\n\n                    transcludedScope.$parent.$watchCollection(sourceData, function(newData) {\n                        if (newData) {\n                            rawData = newData;\n                            renderData();\n                        }\n                    });\n\n                    transcludedScope.addSortColumn = addSortColumn;\n\n                    page.on('scroll.fsmBigData', onPageScroll).trigger('scroll');\n\n                    transcludedScope.$on('$destroy', function() {\n                        page.off('.fsmBigData');\n                    });\n                });\n            }\n        };\n    }]);\n\n    fsm.directive('fsmSort', [function() {\n        var sortIconTemplate = '<i class=\"fa fa-sort\"></i>';\n\n        return {\n            restrict: 'AE',\n            replace: false,\n            scope: {},\n            link: function(scope, element, attrs) {\n                var columnHeader = element;\n                var columnName = attrs.fsmSort;\n                var sortIcon = angular.element(sortIconTemplate);\n                columnHeader.append('&nbsp;');\n                columnHeader.append(sortIcon);\n                var currentSortType = 0;\n\n                function swapIcons() {\n                    sortIcon.removeClass('fa-sort-desc fa-sort-asc fa-sort');\n\n                    var classToAdd = 'fa-sort';\n\n                    if (scope.$parent.sortTypes[currentSortType] === 'Ascending') {\n                        classToAdd = 'fa-sort-asc';\n                    } else if (scope.$parent.sortTypes[currentSortType] === 'Descending') {\n                        classToAdd = 'fa-sort-desc';\n                    }\n\n                    sortIcon.addClass(classToAdd);\n                };\n\n                function applySort() {\n                    // Find the kind of sort this should now be\n                    currentSortType++;\n                    if (currentSortType == scope.$parent.sortTypes.length) {\n                        currentSortType = 0;\n                    }\n\n                    scope.$apply(scope.$parent.addSortColumn(columnName, currentSortType));\n\n                    swapIcons();\n                };\n\n                columnHeader.css({\n                    cursor: 'pointer'\n                });\n\n                columnHeader.on('click.fsmSort', applySort);\n\n                columnHeader.on('keydown.fsmSort', function(e) {\n                    if (e.keyCode === 13) {\n                        applySort();\n                        e.preventDefault();\n                        e.stopPropagation();\n                    }\n                });\n\n                scope.$on('$destroy', function() {\n                    columnHeader.off('.fsmSort');\n                });\n            }\n        };\n    }]);\n})(window.angular);\n'use strict';\n\n/**\n * @ngdoc directive\n * @name troutDashApp.directive:speciesSummary\n * @description\n * # speciesSummary\n */\nangular.module('troutSpotr')\n  .directive('speciesSummary', function() {\n    return {\n      templateUrl: 'app/ui/speciesSummary/speciessummarytemplate.html',\n      restrict: 'A',\n      link: function postLink(scope, element, attrs) {}\n    };\n  });\n'use strict';\n\n/**\n * @ngdoc directive\n * @name troutDashApp.directive:restrictionLegend\n * @description\n * # restrictionLegend\n */\nangular.module('troutSpotr')\n  .directive('restrictionLegend', function () {\n    return {\n      templateUrl: 'app/ui/restrictions/restrictionlegendtemplate.html',\n      restrict: 'A',\n      link: function postLink(scope, element, attrs) {\n      \tconsole.log('restrictionlegend directive', scope.stream);\n      }\n    };\n  });\n\n'use strict';\n\n/**\n * @ngdoc directive\n * @name troutDashApp.directive:miniMapDirective\n * @description\n * # miniMapDirective\n */\n\nvar MINI_MAP_CLASS = '.js-mini-map';\n\nangular.module('troutSpotr')\n  .directive('miniMapDirective', [\n    '$rootScope', 'GeometryApiService', '$q', '$timeout',\n    function($rootScope, GeometryApiService, $q, $timeout) {\n      return {\n        // app/ui/main/main.html\n        templateUrl: 'app/ui/miniMap/minimaptemplate.html',\n        restrict: 'A',\n        link: function postLink(scope, element, attrs) {\n          scope.minimapState = {\n            isLoading: true,\n            regionGeometries: null,\n            selectedRegionId: null,\n            selectedCountyId: null,\n            width: 75,\n            height: 45,\n            isMacro: true,\n\n            loadingRegion: d3.select(null)\n          };\n\n          scope.active = d3.select(null);\n          scope.selectedCounty = d3.select(null);\n\n          $rootScope.$on('county-select', function(event, item) {\n            console.log(item);\n\n          });\n\n          $rootScope.$on('header-clone', function(event, item) {\n            if (item == null) {\n              return;\n            }\n\n            if (item.type === 'region') {\n              $timeout(function() {\n                scope.minimapState.selectedRegionId = item.id;\n                scope.$apply();\n              });\n            }\n\n            if (item.type === 'county') {\n              $timeout(function() {\n                scope.minimapState.selectedCountyId = item.name;\n                scope.$apply();\n              });\n            }\n          });\n\n          var unwatchRegionId = scope.$watch(function() {\n            return scope.minimapState.selectedRegionId;\n          }, function(newRegionId, oldRegionId) {\n            if (newRegionId == null) {\n              return;\n            }\n\n            if (newRegionId === oldRegionId) {\n              return;\n            }\n            // console.log('new region!', newRegionId);\n\n            var soughtRegion = scope.currentRegions.filter(function(f) {\n              return f.id === newRegionId;\n            });\n\n            if (soughtRegion.length > 0 && newRegionId !== oldRegionId) {\n              zoomToGeometry(soughtRegion[0]);\n            }\n\n          });\n\n          var unwatchCountyId = scope.$watch(function() {\n            return scope.minimapState.selectedCountyId;\n          }, function(newCounty, oldCounty) {\n            if (newCounty == null) {\n              return;\n            }\n\n            // console.log('new County!', newCounty);\n            var soughtCounty = scope.currentCounties.filter(function(f) {\n              return f.name === newCounty;\n            });\n            if (soughtCounty.length > 0 && newCounty !== oldCounty) {\n              selectCounty(soughtCounty[0]);\n            }\n          });\n\n          var unwatchGeometries = scope.$watch(function() {\n            return scope.minimapState.regionGeometries;\n          }, function(newGeometries, oldGeometries) {\n            if (newGeometries == null) {\n              return;\n            }\n\n            drawGeometries(newGeometries);\n          });\n\n          var drawGeometries = function(geometries) {\n            var root = d3.select(element[0]);\n          };\n\n          var highlightCounty = function(countyId) {\n            console.log('highlight county');\n          };\n\n          var zoomToRegion = function(regionId) {\n            console.log('zoom to region');\n          };\n\n          // var gettingGeometries = GeometryApiService.getRegionGeometries();\n          // var gettingRegionData = StreamApiService.getRegions();\n\n          // This function takes geometry and will create a geometry and path\n          // function that are centred on this geometry.\n          var initializeMap = function(stateObject) {\n            // initialize a unit projection.\n            scope.projection = d3.geo.albersUsa()\n              .scale(1)\n              .translate([0, 0]);\n\n            // Create a path generator.\n            scope.path = d3.geo.path()\n              .projection(scope.projection)\n              .pointRadius(0.15);\n\n            var state = stateObject.geometry;\n\n            // Compute the bounds of a feature of interest, then derive scale & translate.\n            var b = scope.path.bounds(state),\n              s = 0.95 / Math.max((b[1][0] - b[0][0]) / scope.minimapState.width, (b[1][1] - b[0][1]) / scope.minimapState.height),\n              t = [(scope.minimapState.width - s * (b[1][0] + b[0][0])) / 2, (scope.minimapState.height - s * (b[1][1] + b[0][1])) / 2];\n\n            // Update the projection to use computed scale & translate.\n            scope.projection\n              .scale(s)\n              .translate(t);\n\n            scope.zoom = d3.behavior.zoom()\n              .translate([0, 0])\n              .scale(1)\n              .scaleExtent([1, 8])\n              .size([scope.minimapState.width, scope.minimapState.height])\n              .on('zoom', zoomed);\n\n            scope.svg = d3.select(element[0]).select(MINI_MAP_CLASS)\n              .append('svg')\n              .attr('viewBox', '0 0 ' + scope.minimapState.width + ' ' + scope.minimapState.height)\n              .attr('preserveAspectRatio', 'xMinYMin meet')\n              .attr('class', 'minimap-root')\n              .on('click', stopped, true);\n\n            scope.root = scope.svg.append('g')\n              .attr('class', 'minimap-geography');\n\n            scope.root.append('rect')\n              .attr('class', 'minimap-geography_background')\n              .attr('width', '100%')\n              .attr('height', '100%')\n              .on('click', onBackgroundClick);\n\n            scope.counties = scope.root.append('g')\n              .attr('class', 'minimap-geography minimap-geogrpahy_counties');\n\n            scope.states = scope.root.append('g')\n              .attr('class', 'minimap-geography minimap-geogrpahy_states');\n\n            scope.streams = scope.root.append('g')\n              .attr('class', 'minimap-geography minimap-geogrpahy_streams');\n\n            scope.regions = scope.root.append('g')\n              .attr('class', 'minimap-geography minimap-geogrpahy_regions');\n          };\n\n          var onRegionClick = function(region, regionId) {\n            var isMacro = scope.minimapState.isMacro;\n            if (isMacro) {\n              // assume selection has occured.\n              // set loading state on region.\n              onLoadRegion.bind(this)(region);\n              scope.minimapState.selectedRegionId = region.id;\n              scope.selectRegion(region)\n                .then(function(geometry) {\n                  $timeout(function() {\n\n                    resetLoadRegion();\n                    // set controller's state\n                    $timeout(minifyMinimap, 500);\n                  }, 1000);\n\n                });\n\n              // TODO: remove the minification.\n            } else {\n              macrofyMinimap();\n            }\n\n            $timeout(function() {\n              scope.$apply();\n            });\n          };\n\n          var onBackgroundClick = function() {\n            var isMacroMode = scope.minimapState.isMacro;\n            if (isMacroMode) {\n              // TODO: reset state\n              // TODO: set to minify\n\n              minifyMinimap();\n\n            } else {\n              // TODO: set state to outer.\n              macrofyMinimap();\n            }\n\n            $timeout(function() {\n              scope.$apply();\n            });\n\n          };\n\n          var minifyMinimap = function() {\n            scope.minimapState.isMacro = false;\n          };\n\n          var macrofyMinimap = function() {\n            scope.minimapState.isMacro = true;\n            reset();\n          };\n\n          var drawGeometryToMap = function(states, regions, counties) {\n            // scope.countiesGroup = scope.counties;\n            scope.counties.selectAll('path.minimap-geography_county')\n              .data(counties, function(d) {\n                return d.id;\n              })\n              .enter().append('path')\n              .attr('d', function(d) {\n                return scope.path(d.geometry);\n              })\n              .attr('data-id', function(d) {\n                return getFipsCodeSelector(d);\n              })\n              .attr('class', 'minimap-geography_county');\n\n            scope.regions.selectAll('path.minimap-geogrpahy_region')\n              .data(regions, function(d) {\n                return d.id;\n              })\n              .enter().append('path')\n\n            .attr('class', 'minimap-geogrpahy_region')\n              .attr('data-id', function(d) {\n                return d.id;\n              })\n              .attr('id', function(d) {\n                return 'region_' + d.id;\n              })\n              .attr('data-name', function(d) {\n                return d.shortName;\n              })\n              .attr('d', function(d) {\n                return scope.path(d.geometry);\n              })\n              .on('click', onRegionClick);\n          };\n\n          function reset() {\n            scope.active.classed('active', false);\n            scope.active = d3.select(null);\n\n            scope.svg.transition()\n              .duration(300)\n              .call(scope.zoom.translate([0, 0]).scale(1).event);\n          }\n\n          function zoomed() {\n            scope.root.style('stroke-width', 1.5 / d3.event.scale + 'px');\n            scope.root.attr('transform', 'translate(' + d3.event.translate + ')scale(' + d3.event.scale + ')');\n          }\n\n          function onLoadRegion(regionElement) {\n            resetLoadRegion();\n            scope.minimapState.loadingRegion = d3.select(this).classed('minimap-geogrpahy_region_loading', true);\n            // show streams.\n            var arrayOfStreams = regionElement.children.map(function(county) {\n              return county.children;\n            });\n\n            var selectedStreams = _.unique(_.flatten(arrayOfStreams), 'Id');\n\n\n            var streamObjects = scope.streams.selectAll('path.minimap-geography_stream')\n              .data(selectedStreams, function(d) {\n                return d.Id;\n              });\n            streamObjects.enter()\n              .append('path')\n              .attr('class', 'minimap-geography_stream')\n              .attr('data-id', function(d) {\n                return d.id;\n              })\n              .attr('id', function(d) {\n                return 'streamPoint_' + d.id;\n              })\n              .attr('data-name', function(d) {\n                return d.name;\n              })\n              .attr('d', function(d) {\n                return scope.path(d.geometry);\n              })\n              .style('opacity', 0)\n              .transition()\n              .delay(200)\n              .duration(750)\n              .style('opacity', 1);\n\n            streamObjects.exit()\n              .transition()\n              .duration(300)\n              .style('opacity', 0)\n              .remove();\n\n          }\n\n          function resetLoadRegion() {\n            if (scope.minimapState.loadingRegion == null) {\n              return;\n            }\n\n            scope.minimapState.loadingRegion.classed('minimap-geogrpahy_region_loading', false);\n            scope.minimapState.loadingRegion = d3.select(null);\n          }\n\n          function zoomToGeometry(d, t) {\n            if (scope.active.node() === this)  {\n              return reset();\n            }\n            scope.active.classed('active', false);\n            scope.active = d3.select(element[0]).classed('active', true);\n            var bounds = scope.path.bounds(d.geometry),\n              dx = bounds[1][0] - bounds[0][0],\n              dy = bounds[1][1] - bounds[0][1],\n              x = (bounds[0][0] + bounds[1][0]) / 2,\n              y = (bounds[0][1] + bounds[1][1]) / 2,\n              scale = 0.95 / Math.max(dx / scope.minimapState.width, dy / scope.minimapState.height),\n              translate = [scope.minimapState.width / 2 - scale * x, scope.minimapState.height / 2 - scale * y];\n\n            scope.svg.transition()\n              .delay(200)\n              .duration(750)\n              .call(scope.zoom.translate(translate).scale(scale).event);\n          }\n\n          function getFipsCode(countyFeature) {\n            if (countyFeature == null) {\n              return '';\n            }\n\n            var fips = countyFeature.statefp + countyFeature.countyfp;\n            return fips;\n          }\n\n          function getFipsCodeSelector(countyFeature) {\n            return 'county_' + getFipsCode(countyFeature);\n          }\n\n          function selectCounty(d) {\n            var fips = getFipsCodeSelector(d);\n            var attribute = '[data-id=' + fips + ']';\n            var t = scope.counties.select(attribute).node();\n            if (scope.selectedCounty.node() === t) {\n              return;\n            }\n\n            scope.selectedCounty.classed('active', false);\n            scope.selectedCounty = d3.select(t).classed('active', true);\n          }\n\n          function stopped() {\n            if (d3.event.defaultPrevented) d3.event.stopPropagation();\n          }\n\n          scope.getTableOfContents()\n            .then(function(toc) {\n\n              var states = _.map(toc);\n              var regions = _(states)\n                .pluck('children')\n                .flatten()\n                .value();\n\n              var counties = _(regions)\n                .pluck('children')\n                .flatten()\n                .value();\n\n              scope.currentState = states[0];\n              scope.currentCounties = counties;\n              scope.currentRegions = regions;\n\n              var minStreamCount = 0;\n              var countyStreamCounts = scope.currentCounties.map(function(feat) {\n                return Math.max(0, feat.stream_count);\n              });\n              var maxStreamCount = d3.max(countyStreamCounts);\n\n              scope.countyChoroplethScale = d3.scale.linear()\n                .domain([minStreamCount, maxStreamCount])\n                .range(['#FFFFBB', '#BB00CC']);\n\n\n              scope.minimapState.isLoading = false;\n              initializeMap(scope.currentState);\n              drawGeometryToMap(states, regions, counties);\n\n            });\n\n          scope.$on('$destroy', function() {\n            unwatchRegionId();\n            unwatchCountyId();\n            unwatchGeometries();\n            unwatchTableOfContents();\n          });\n        }\n      };\n    }\n  ]);\n(function() {\n\t'use strict';\n\n\t/**\n\t * @ngdoc function\n\t * @name troutDashApp.controller:StreamlistcontrollerCtrl\n\t * @description\n\t * # StreamlistcontrollerCtrl\n\t * Controller of the troutDashApp\n\t */\n\tangular.module('troutSpotr')\n\t\t.controller('MainController', ['$scope', 'StreamApiService',\n\t\t\t'TableOfContentsRepository', 'RegionGeometryService',\n\t\t\t'$anchorScroll',\n\t\t\tfunction($scope, StreamApiService, TableOfContentsRepository, RegionGeometryService, $anchorScroll) {\n\t\t\t\t$scope.isSmallView = true;\n\t\t\t\tvar getInitialMapState = function() {\n\t\t\t\t\tvar mapState = {\n\t\t\t\t\t\tisExpanded: false,\n\t\t\t\t\t\tisLoading: false,\n\t\t\t\t\t\tselectedRegionGeometry: null,\n\t\t\t\t\t\tselectedRegion: null,\n\t\t\t\t\t\tselectedCounty: null,\n\t\t\t\t\t\thighlightedStream: null,\n\t\t\t\t\t\tcurrentClientCoordinates: [NaN, NaN]\n\t\t\t\t\t};\n\t\t\t\t\treturn mapState;\n\t\t\t\t};\n\n\t\t\t\t$scope.mapState = getInitialMapState();\n\n\t\t\t\t$scope.selectCounty = function(countyId) {\n\t\t\t\t\tconsole.log(countyId);\n\t\t\t\t};\n\n\t\t\t\t$scope.selectRegion = function(regionModel) {\n\t\t\t\t\tif (regionModel == null) {\n\t\t\t\t\t\tthrow new Error('regionModel cannot be null');\n\t\t\t\t\t}\n\n\n\n\t\t\t\t\t// TODO: fix this to have an actual cache.\n\t\t\t\t\t// try to pull it from the cache\n\t\t\t\t\tvar canRetrieveFromCache = false;\n\t\t\t\t\tif (canRetrieveFromCache) {\n\t\t\t\t\t\t// return it from our cache.\n\t\t\t\t\t\t// TODO: fix this part too\n\t\t\t\t\t\t$scope.mapState.selectedRegionGeometry = null;\n\t\t\t\t\t\t$scope.mapState.selectedRegion = [regionModel];\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// load it from our repository.\n\t\t\t\t\tvar stateModel = regionModel.parent;\n\t\t\t\t\treturn RegionGeometryService.getRegion(stateModel, regionModel)\n\t\t\t\t\t\t.then(function(newSelectedRegionGeometry) {\n\t\t\t\t\t\t\t$scope.mapState.selectedRegionGeometry = [newSelectedRegionGeometry];\n\t\t\t\t\t\t\t$scope.mapState.selectedRegion = [regionModel];\n\t\t\t\t\t\t\t$anchorScroll('region-hdr_' + regionModel.id);\n\t\t\t\t\t\t\treturn newSelectedRegionGeometry;\n\t\t\t\t\t\t});\n\t\t\t\t};\n\n\t\t\t\t$scope.getTableOfContents = function() {\n\t\t\t\t\treturn TableOfContentsRepository.getTableOfContents()\n\t\t\t\t\t\t.then(function(toc) {\n\t\t\t\t\t\t\treturn toc;\n\t\t\t\t\t\t});\n\t\t\t\t};\n\n\t\t\t\t$scope.bustCache = function() {\n\t\t\t\t\tconsole.log('busting cache...');\n\t\t\t\t\t// this is actually going directly to the base cache...\n\t\t\t\t\tTableOfContentsRepository.bustTableOfContentsCache();\n\t\t\t\t};\n\n\t\t\t\t$scope.toggleMinimap = function() {\n\t\t\t\t\tif ($scope.mapState == null) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t$scope.mapState.isExpanded = !$scope.mapState.isExpanded;\n\t\t\t\t};\n\t\t\t}\n\t\t]);\n\n})();\nangular.module('troutSpotr')\n  .factory('RectangleLayoutService', [function() {\n    'use strict';\n\n    function RectangleLayoutService(width, height) {\n      this.width = width;\n      this.height = height;\n    }\n\n    var proto = RectangleLayoutService.prototype;\n\n    function getScale(width, height, itemLength) {\n      return Math.sqrt(itemLength / (width * height));\n    }\n\n    function getXGivenY(width, height, y) {\n      return (width / height) * y;\n    }\n\n    function getYGivenX(width, height, x) {\n      return (height / width) * x;\n    }\n\n    function pythagoreanTheorem(x, y) {\n      return Math.sqrt((x * x) + (y * y));\n    }\n\n    proto.getBoundingBox = function (numberOfItems) {\n      if (numberOfItems === 1) {\n        return [1, 1];\n      }\n\n      var scale = getScale(this.width, this.height, numberOfItems);\n      var minimumXPosition = this.width * scale;\n      var minimumYPosition = this.height * scale;\n\n      var xPrime = Math.ceil(minimumXPosition);\n      var yPrime = Math.ceil(minimumYPosition);\n\n      var newYLength = getYGivenX(this.width, this.height, xPrime);\n      var yZLength = pythagoreanTheorem(xPrime, newYLength);\n\n      var newXLength = getXGivenY(this.width, this.height, yPrime);\n      var xZLength = pythagoreanTheorem(newXLength, yPrime);\n\n      var candidate = function() {\n        if (xZLength > yZLength) {\n          return [xPrime, Math.floor(minimumYPosition)];\n        } else if (yZLength > xZLength) {\n          return [Math.floor(minimumXPosition), yPrime];\n        }\n        return [Math.ceil(minimumXPosition), Math.ceil(minimumYPosition)];\n      };\n\n      var result = candidate();\n      if (result[0] * result[1] < numberOfItems) {\n        return [xPrime, yPrime];\n      }\n      return result;\n    };\n\n    \n    return RectangleLayoutService;\n  }]);\nangular.module('troutSpotr')\n  .directive('accessPointSummaryTally', ['RectangleLayoutService', function(RectangleLayoutService) {\n    'use strict';\n    return {\n      templateUrl: 'app/ui/accessPointSummary/AccessPointSummaryTallyTemplate.html',\n      restrict: 'A',\n      link: function postLink(scope , element/*, attrs*/ ) {\n        var ROOT_CLASS = '.js-tally-root';\n        var WIDTH = 32;\n        var HEIGHT = 24;\n\n        var troutStreamIntersections = scope.stream.AccessPoints.filter(function(i) {\n          return i.IsOverOrNearTroutStreamSection;\n        }).sort(function(a) {\n          return a.IsOverOrNearPublicLand ? -100 : 100;\n        });\n        scope.denominator = troutStreamIntersections.length;\n        var publicTroutStreamIntersections = troutStreamIntersections.filter(function(i) {\n          return i.IsOverOrNearPublicLand;\n        });\n        scope.numerator = publicTroutStreamIntersections.length;\n        scope.rows = Math.ceil(Math.sqrt(scope.denominator));\n        if (scope.rows === 0) {\n          return;\n        }\n\n        // if (scope.rows > 3) { debugger};\n\n        var generator = new RectangleLayoutService(3, 2);\n        var dimensions = generator.getBoundingBox(scope.denominator);\n        var numberOfColumns = dimensions[0];\n        var numberOfRows = dimensions[1];\n\n        var boxWidth = 3;\n\n        var widthOfContainer = numberOfColumns * boxWidth;\n        var heightOfContainer = numberOfRows * boxWidth;\n\n        var offset = [(WIDTH - widthOfContainer) * 0.5, (HEIGHT - heightOfContainer) * 0.5];\n        scope.root = d3.select(element[0]).select(ROOT_CLASS);\n        scope.container = scope.root.append('g')\n          .attr('class', 'access-points')\n          .attr('transform', 'translate(' + offset[0] + ', ' + offset[1] + ')');\n\n        scope.container.selectAll('circle')\n          .data(troutStreamIntersections)\n          .enter()\n          .append('circle')\n          .attr('data-length', scope.denominator)\n          .attr('data-width', numberOfColumns)\n          .attr('data-height', numberOfRows)\n          .attr('cx', function(d, index) {\n            var xPosition = ((index % numberOfColumns) * (boxWidth * 1.0));\n            // console.log(xPosition);\n            return xPosition;\n          })\n          .attr('cy', function(d, index) {\n            var yPosition = Math.floor(index / numberOfColumns) * (boxWidth * 1.0);\n            return yPosition;\n          })\n          .attr('r', boxWidth * 0.5)\n          .attr('class', function(d) {\n            return d.IsOverOrNearPublicLand ? 'numerator' : 'denominator';\n          });\n\n\n      }\n    };\n  }]);\nangular.module('troutSpotr')\n  .directive('accessPointSummary', [function() {\n    'use strict';\n    return {\n      templateUrl: 'app/ui/accessPointSummary/AccessPointSummaryTemplate.html',\n      restrict: 'A',\n      link: function postLink(scope /*, element, attrs*/ ) {\n        var troutStreamIntersections = scope.stream.AccessPoints.filter(function(i) {\n          return i.IsOverOrNearTroutStreamSection;\n        });\n        scope.denominator = troutStreamIntersections.length;\n        var publicTroutStreamIntersections = troutStreamIntersections.filter(function(i) {\n          return i.IsOverOrNearPublicLand;\n        });\n        scope.numerator = publicTroutStreamIntersections.length;\n      }\n    };\n  }]);\n\n/**\n * @ngdoc service\n * @name troutDashApp.TableOfContentsRepository\n * @description\n * # TableOfContentsRepository\n * Factory in the troutDashApp.\n */\nangular.module('troutSpotr')\n    .factory('TableOfContentsRepository', ['BaseApiService', 'RegionGeometryService', 'HierarchicalGeometryViewModel',\n        function(BaseApiService, RegionGeometryService, HierarchicalGeometryViewModel) {\n            'use strict';\n            var TABLE_OF_CONTENTS_CACHE_KEY = 'tableOfContents';\n            var COUNTIES_CACHE_KEY = 'counties';\n            var REGIONS_CACHE_KEY = 'regions';\n            var TableOfContentsRepository = function() {\n                BaseApiService.call(this);\n                this.logCache();\n            };\n\n            var proto = TableOfContentsRepository.prototype = Object.create(BaseApiService.prototype);\n\n            proto.bustTableOfContentsCache = function() {\n                var key = TABLE_OF_CONTENTS_CACHE_KEY;\n                this.cache.remove(TABLE_OF_CONTENTS_CACHE_KEY);\n            };\n\n            proto.getTableOfContents = function() {\n                var key = TABLE_OF_CONTENTS_CACHE_KEY;\n                if (this.cache.get(key)) {\n                    console.log('found in cache');\n                    return this.cache.get(key);\n                }\n\n                var promise = this.doCall({}, 'assets/data/tableOfContents.topo.json')\n                    .then(function(regionTopoJson) {\n                        var state = topojson.feature(regionTopoJson, regionTopoJson.objects.state);\n                        var regions = topojson.feature(regionTopoJson, regionTopoJson.objects.region);\n                        var counties = topojson.feature(regionTopoJson, regionTopoJson.objects.county);\n                        var streams = topojson.feature(regionTopoJson, regionTopoJson.objects.streamProperties);\n\n                        var stateHash = _(state.features)\n                            .map(function(feature) {\n                                var stateModel = new HierarchicalGeometryViewModel();\n                                var prop = feature.properties;\n                                stateModel.id = prop.gid;\n                                stateModel.name = prop.name;\n                                stateModel.centroidLatitude = NaN;\n                                stateModel.shortName = prop.short_name;\n                                stateModel.centroidLongitude = NaN;\n                                stateModel.parent = null;\n                                stateModel.type = 'state';\n                                stateModel.children = [];\n                                stateModel.geometry = feature;\n                                return stateModel;\n                            })\n                            .indexBy('id')\n                            .value();\n\n                        var regionHash = _(regions.features)\n                            .map(function(feature) {\n                                var regionModel = new HierarchicalGeometryViewModel();\n                                regionModel.shortName = feature.properties.name;\n                                regionModel.id = feature.properties.gid;\n                                regionModel.name = feature.properties.name;\n                                regionModel.geometry = feature;\n                                regionModel.type = 'region';\n                                return regionModel;\n                            })\n                            .sortBy('name')\n                            .indexBy('id')\n                            .value();\n\n                        var countyhash = _(counties.features)\n                            .filter(function(feature) {\n                                return feature.properties.stream_count > 0;\n                            })\n                            .map(function(feature) {\n                                var countyModel = new HierarchicalGeometryViewModel();\n                                var properties = feature.properties;\n                                countyModel.id = properties.gid;\n                                countyModel.name = properties.name;\n                                countyModel.geometry = feature;\n                                _.extend(countyModel, properties);\n                                countyModel.type = 'county';\n                                return countyModel;\n                            })\n                            .sortBy('name')\n                            .indexBy('id')\n                            .value();\n\n                        var countyByRegion = _(countyhash)\n                            .groupBy('region_id')\n                            .value();\n\n                        // TODO: Fix this nonsense.\n                        var minnesota = stateHash['49'];\n                        var regionByState = _(regionHash)\n                            .groupBy(function() {\n                                return minnesota.id;\n                            })\n                            .value();\n\n                        var streamHash = _(streams.features)\n                            .map(function(feature) {\n                                var streamModel = new HierarchicalGeometryViewModel();\n                                var properties = feature.properties;\n                                streamModel.id = properties.Id;\n                                streamModel.name = properties.Name;\n                                streamModel.geometry = feature;\n                                streamModel.centroidLongitude = properties.CentroidLongitude;\n                                streamModel.centroidLatitude = properties.CentroidLatitude;\n                                _.extend(streamModel, properties);\n                                // console.table(streamModel.AccessPoints);\n                                streamModel.type = 'streamCentroid';\n                                return streamModel;\n                            })\n                            .sortBy('name')\n                            .indexBy('id')\n                            .value();\n\n                        _.forEach(stateHash, function(state) {\n                            var stateId = state.id;\n                            var regions = regionByState[stateId];\n                            state.children = regions;\n                            // _(regions).forEach(function(r) { r.parent = state; });\n                            _.forEach(state.children, function(region) {\n                                var regionId = region.id;\n                                var counties = countyByRegion[regionId];\n                                region.children = counties;\n                                region.parent = state;\n                                _.forEach(region.children, function(c) {\n                                    c.parent = region;\n                                });\n                            });\n                        });\n\n                        // now we have to get the streams under the counties.\n                        // we have to respect the Many to Many relationship.\n                        _.forEach(streamHash, function(stream) {\n                            _.forEach(stream.Counties, function(streamCountyModel) {\n                                var countyModel = countyhash[streamCountyModel.Id];\n                                countyModel.children.push(stream);\n                                // what to do about the parent tho?\n                            });\n                        });\n\n                        this.logCache();\n                        return stateHash;\n\n                    }.bind(this));\n                this.cache.put(key, promise);\n                return promise;\n            };\n\n            TableOfContentsRepository.prototype = proto;\n            return new TableOfContentsRepository();\n        }\n    ]);\n'use strict';\n\n/**\n * @ngdoc service\n * @name troutDashApp.HierarchicalGeometryViewModel\n * @description\n * # HierarchicalGeometryViewModel\n * Factory in the troutDashApp.\n */\nangular.module('troutSpotr')\n  .factory('HierarchicalGeometryViewModel', function () {\n    function HierarchicalGeometryViewModel() {\n        this.init();\n    }\n\n    HierarchicalGeometryViewModel.prototype =  {\n      id: null,\n      name: '',\n      shortName: '',\n      geometry: null,\n      centroidLatitude: NaN,\n      centroidLongitude: NaN,\n      type: null,\n      parent: null,\n      children: [],\n\n      init: function() {\n        this.id = null;\n        this.name = '';\n        this.shortName = '';\n        this.geometry = null;\n        this.centroidLongitude = NaN;\n        this.centroidLatitude = NaN; \n        this.parent = null;\n        this.children = [];\n      }\n    };\n\n\n    return HierarchicalGeometryViewModel;\n  });\n\n'use strict';\n\n/**\n * @ngdoc service\n * @name troutDashApp.HierarchicalGeometryCollection\n * @description\n * # HierarchicalGeometryCollection\n * Factory in the troutDashApp.\n */\nangular.module('troutSpotr')\n  .factory('HierarchicalGeometryCollection', function (BaseCollection, HierarchicalGeometryViewModel) {\n    function HierarchicalGeometryCollection(data) {\n        BaseCollection.call(this, data);\n    }\n\n    /** @lends  HierarchicalGeometryCollection.prototype */\n    var proto = HierarchicalGeometryCollection.prototype = Object.create(BaseCollection.prototype);\n    HierarchicalGeometryCollection.prototype.constructor = HierarchicalGeometryCollection;\n\n    /**\n     * Constructor used to create models from JSON data\n     * @property {Function} model HierarchicalGeometryViewModel constructor function\n     */\n    proto.model = HierarchicalGeometryViewModel;\n\n    return HierarchicalGeometryCollection;\n  });\n\n'use strict';\n\n/**\n * @ngdoc service\n * @name troutDashApp.RegionRepositoryService\n * @description\n * # RegionRepositoryService\n * Factory in the troutDashApp.\n */\nangular.module('troutSpotr')\n  .factory('RegionRepositoryService', function (RegionGeometryService, TableOfContentsRepository, $q) {\n    var RegionRepositoryService = function () {\n        \n    };\n\n    var proto = {\n    \tgetRegions: function() {\n    \t\treturn TableOfContentsRepository.getTableOfContents()\n    \t\t\t.then(function(states) {\n    \t\t\t\tconsole.log('got em');\n    \t\t\t});\n    \t},\n\n    \tisCached: function(regionid) {\n            return false;\n    \t},\n\n    \tcacheRegion: function(regionId) {\n            return true;\n    \t},\n\n    \tuncacheRegion: function(regionId) {\n            return true;\n    \t},\n\n        getRegion: function(regionId) {\n            if (this.isCached()) {\n                // todo this\n            }\n\n            \n        }\n    };\n\n    RegionRepositoryService.prototype = proto;\n    return new RegionRepositoryService();\n  });\n\n'use strict';\n\nvar REGION_CACHE_KEY = 'region';\nvar createKey = function(stateId, regionId) {\n\treturn REGION_CACHE_KEY + '_' + stateId + '_' + regionId;\n};\n/**\n * @ngdoc service\n * @name troutDashApp.RegionGeometryService\n * @description\n * # RegionGeometryService\n * Factory in the troutDashApp.\n */\nangular.module('troutSpotr')\n  .factory('RegionGeometryService', ['BaseApiService', 'RegionApiService', 'HierarchicalGeometryViewModel', \n  \tfunction (BaseApiService, RegionApiService, HierarchicalGeometryViewModel) {\n    var RegionGeometryService = function () {\n        BaseApiService.call(this);\n    };\n\n    var proto = RegionGeometryService.prototype = Object.create(BaseApiService.prototype);\n\n    proto.getRegion = function(stateModel, regionModel) {\n\t\tif (stateModel == null || stateModel.shortName == null) {\n\t\t\tthrow new Error('state cannot be null');\n\t\t}\n\n\t\tif (regionModel == null || regionModel.shortName == null) {\n\t\t\tthrow new Error('region cannot be null');\n\t\t}\n\n\t\tvar stateId = stateModel.shortName;\n\t\tvar regionId = regionModel.shortName;\n\t\tvar regionKey = createKey(stateId, regionId);\n\n        if (this.cache.get(regionKey)) {\n            console.log('found in cache');\n            return this.cache.get(regionKey);\n        }\n\n\t\tvar promise = RegionApiService.getRegion(stateId, regionId)\n\t\t\t.then(function(geometry) {\n\t\t\t\tconsole.log('new geom', geometry);\n\t\t\t\treturn geometry;\n\t\t\t});\n\n        this.cache.put(regionKey, promise);\n    \treturn promise;\n\t};\n\n    RegionGeometryService.prototype = proto;\n    return new RegionGeometryService();\n  }]);\n\n'use strict';\nvar createPath = function(stateId, regionId) {\n  return stateId + '/' + regionId + '.topo.json';\n};\n/**\n * @ngdoc service\n * @name troutDashApp.RegionApiService\n * @description\n * # RegionApiService\n * Factory in the troutDashApp.\n */\nangular.module('troutSpotr')\n  .factory('RegionApiService', ['BaseApiService', function(BaseApiService) {\n    var RegionApiService = function() {\n      BaseApiService.call(this);\n      this.logCache();\n    };\n\n    var proto = RegionApiService.prototype = Object.create(BaseApiService.prototype);\n\n    proto.getRegion = function(stateId, regionId) {\n      if (stateId == null) {\n        throw new Error('stateId cannot be null');\n      }\n\n      if (regionId == null) {\n        throw new Error('regionId cannot be null');\n      }\n\n      var path = createPath(stateId, regionId);\n      return this.doCall({}, 'assets/data/' + path);\n    };\n\n    RegionApiService.prototype = proto;\n    return new RegionApiService();\n  }]);\n'use strict';\n\n/**\n * @ngdoc service\n * @name troutDashApp.StreamRatioViewModel\n * @description\n * # StreamRatioViewModel\n * Factory in the troutDashApp.\n */\nangular.module('troutSpotr')\n  .factory('StreamRatioViewModel', function () {\n        var StreamRatioViewModel = function(totalLength, publicLandLength) {\n            this.totalLength = 0;\n            this.publicLandLength = 0;\n            this.init(totalLength, publicLandLength);\n        };\n\n        var proto = StreamRatioViewModel.prototype;\n\n        proto.init = function(totalLength, publicLandLength) {\n            if (totalLength == null || publicLandLength < 0) {\n                throw new Error('totalLength cannot be null or less than 0');\n            }\n\n            if (publicLandLength == null || publicLandLength < 0) {\n                throw new Error('publicLength cannot be null or less than 0');\n            }\n\n            if (publicLandLength > totalLength) {\n                // clamp - technically this can be true, given the fact\n                // that a stream can have easement and not be a trout stream section.\n                // BUG: Currently we're computing how much is on trout streams.\n\n                publicLandLength = totalLength;\n            }\n\n            this.totalLength = totalLength;\n            this.publicLandLength = publicLandLength;\n\n            var computeRadiusFromLength = function(length) {\n                var area = Math.sqrt(length / Math.PI);\n                return area;\n            };\n\n            this.waterRadius = computeRadiusFromLength(this.totalLength);\n            // LIE about the width.\n           \t// use the diameter of the water ratio to determine how large\n           \tvar publicLandLengthTOWaterLengthRatio = this.publicLandLength / this.totalLength;\n            this.publicLandRadius = this.waterRadius * publicLandLengthTOWaterLengthRatio;\n        };\n\n        return StreamRatioViewModel;\n  });\n\n'use strict';\n\n/**\n * @ngdoc service\n * @name troutDashApp.StreamApiService\n * @description\n * # StreamApiService\n * Factory in the troutDashApp.\n */\nangular.module('troutSpotr')\n  .factory('StreamApiService', ['$rootScope', '$cacheFactory', '$http', '$q', '$timeout',\n    function($rootScope, $cacheFactory, $http, $q, $timeout) {\n      function StreamApiService() {\n\n      }\n\n      StreamApiService.prototype = {\n        getStreams: function() {\n          var deferred = $q.defer();\n\n          $timeout(function() {\n            var gettingData = $http.get('./data/trout-dash-minnesota.json')\n              .then(function(response) {\n                return response.data;\n              });\n\n            deferred.resolve(gettingData);\n          }, 1000);\n\n          return deferred.promise;\n        },\n\n        getRegions: function() {\n          // return $http.get('./data/regionDetails.json')\n          //   .then(function(response) {\n          //     return response.data;\n          //   });\n\n          var deferred = $q.defer();\n\n          $timeout(function() {\n            var gettingData = $http.get('./data/regionDetails.json')\n              .then(function(response) {\n                return response.data;\n              });\n\n            deferred.resolve(gettingData);\n          }, 1000);\n\n          return deferred.promise;\n        }\n      };\n\n      return new StreamApiService();\n    }\n  ]);\n'use strict';\n\n/**\n * @ngdoc service\n * @name troutDashApp.LinearReferenceViewModel\n * @description\n * # LinearReferenceViewModel\n * Factory in the troutDashApp.\n */\nangular.module('troutSpotr')\n  .factory('LinearReferenceViewModel', function () {\n    var StreamLineViewModel = function (lineSegment, inverseLength) {\n        this.lineSegment = null;\n        this.xOffset = 0.0;\n        this.width = 0.0;\n        this.init(lineSegment, inverseLength);\n    };\n\n    StreamLineViewModel.prototype.init = function(lineSegment, inverseLength) {\n      this.lineSegment = lineSegment;\n      var stop = lineSegment.Stop * inverseLength;\n      var start = lineSegment.Start * inverseLength;\n      this.xOffset = 1.0 - stop;\n      this.width = Math.abs(stop - start);\n    };\n\n    return StreamLineViewModel;\n  });\n\n'use strict';\n\n/**\n * @ngdoc service\n * @name troutDashApp.GeometryApiService\n * @description\n * # GeometryApiService\n * Factory in the troutDashApp.\n */\nangular.module('troutSpotr')\n  .factory('GeometryApiService', ['$rootScope', '$cacheFactory', '$http', '$q', '$timeout',\n    function ($rootScope, $cacheFactory, $http, $q, $timeout) {\n    function GeometryApiService() {\n\n    }\n\n    GeometryApiService.prototype = {\n      getRegionGeometries: function() {\n        var deferred = $q.defer();\n\n          $timeout(function() {\n            var gettingData = $http.get('./data/regionGeometry.json')\n            .then(function(response) {\n              return response.data;\n            });\n\n            deferred.resolve(gettingData);\n          }, 1000);\n\n          return deferred.promise;\n      }\n    };\n\n    return new GeometryApiService();\n  }]);\n\n'use strict';\n\n/**\n * @ngdoc service\n * @name troutDashApp.BaseModel\n * @description\n * # BaseModel\n * Factory in the troutDashApp.\n */\nangular.module('troutSpotr')\n  .factory('BaseModel', function () {\n    function BaseModel(json) {\n        if (json) {\n            this._fromJSON(json);\n        }\n    }\n\n    /** @lends  BaseModel.prototype */\n    BaseModel.prototype = {\n        constructor: BaseModel,\n        /**\n         * Merges properties from a POJO into the model\n         * @param  {Object} json raw data\n         */\n        _fromJSON: function(json) {\n            var key;\n            for (key in json) {\n                if (json.hasOwnProperty(key)) {\n                    this[key] = json[key];\n                }\n            }\n        },\n\n        /**\n         * Returns an object hash of the model properties\n         * @return {Object}\n         */\n        toJSON: function() {\n            var hash = {};\n            var key;\n            for (key in this) {\n                if (this.hasOwnProperty(key) && typeof this[key] !== 'function') {\n                    hash[key] = this[key];\n                }\n            }\n\n            return hash;\n        },\n\n        destroy: function() {\n            var key;\n            for (key in this) {\n                if (this.hasOwnProperty(key)) {\n                    delete this[key];\n                }\n            }\n        }\n    };\n\n    BaseModel.generateIdomaticName = function(model) {\n        return model.type;\n    };\n\n    return BaseModel;\n  });\n\n'use strict';\n\n/**\n * @ngdoc service\n * @name troutDashApp.BaseCollection\n * @description\n * # BaseCollection\n * Factory in the troutDashApp.\n */\nangular.module('troutSpotr')\n  .factory('BaseCollection', function (BaseModel) {\n    function BaseCollection(udefOrArray) {\n        this._models = [];\n        if (udefOrArray) {\n            this._addAll(udefOrArray);\n        }\n    }\n\n    /** @lends BaseCollection.prototype */\n    BaseCollection.prototype = {\n\n        /**\n         * @property {Function} model BaseModel constructor function, used to convert raw JSON into models\n         */\n        model: BaseModel,\n        constructor: BaseCollection,\n\n        /**\n         * @property {BaseModel[]} _models Reference store for model instances\n         */\n        _models: null,\n\n        /**\n         * @property {Number} Number of models in the colleciton\n         */\n        length: 0,\n\n        /**\n         * @method\n         * @return {Object[]} Array of POJO model data\n         */\n        toJSON: function() {\n            return this.map(function(model) {\n                return model.toJSON();\n            });\n        },\n\n        toArray: function() {\n            return this._models.slice();\n        },\n\n        destroy: function() {\n            this.each(function(model) {\n                model.destroy();\n            });\n            this._models.length = 0;\n            this._models = null;\n        },\n\n        /**\n         * @method\n         * @param {BaseModel[]|null} arrayOrUndefined Returns a new instance of BaseCollection.\n         * @return {BaseCollection} Returns a copy of the collection. If an array of BaseModels are passed, only those\n         *                          models are included. Otherwise, the full collection is copied.\n         */\n        copy: function(arrayOrUndefined) {\n            if (arrayOrUndefined) {\n                return new this.constructor(arrayOrUndefined);\n            }\n\n            return new this.constructor(this._models);\n        },\n\n        /**\n         * @method\n         * @param {Object[]|BaseModel[]} modelData Convenience method for adding many models.  Iterates and calls #add\n         * @see add\n         */\n        _addAll: function(modelData) {\n            var i;\n            var len = modelData.length;\n            for (i = 0; i < len; i++) {\n                this.add(modelData[i]);\n            }\n        },\n\n        /**\n         * Adds a model to the collection.  If type Object is passed, it gets passed to new {this.model} first\n         * @method\n         * @param {Object|BaseModel} modelData Model data to add\n         */\n        add: function(modelData) {\n            var instanceModel;\n            if (!(modelData instanceof this.model)) {\n                instanceModel = new this.model(modelData);\n            } else {\n                instanceModel = modelData;\n            }\n\n            this._models.push(instanceModel);\n            this.length++;\n            return this.length;\n        },\n\n        /**\n         * Remove a model from the collection.  Delegates to _removeByModel or _removeByModelId based on the parameter\n         * @method\n         * @param {BaseModel|Number} modelDataOrId Model instance or model id value\n         * @return {Number} Length of the collection after attempting to remove the model\n         */\n        remove: function(modelDataOrId) {\n            var model;\n            // avoid concurrency bug\n            var referenceToModelOrId = modelDataOrId;\n            if (referenceToModelOrId instanceof this.model) {\n                model = this._removeByModel(referenceToModelOrId);\n            } else {\n                model = this._removeById(referenceToModelOrId);\n            }\n\n            if (model && model !== -1) {\n                this.length--;\n            }\n\n            return this.length;\n        },\n\n        /**\n         * Remove all elements from the collection and reset its length to 0\n         * @method\n         */\n        empty: function() {\n            this._models.length = 0;\n            this.length = 0;\n        },\n\n        /**\n         * Return the first element from the collection\n         * Especially useful for creating non-queue based pools\n         * @return {BaseModel|undefined}\n         */\n        first: function() {\n            return this._models[0];\n        },\n\n        /**\n         * Applies browser-standard sorting via Array.prototype.sort to _models\n         * @method\n         * @param {Function} sortFn Sorting function to use\n         */\n        sort: function(sortFn) {\n            this._models.sort(sortFn);\n        },\n\n        /**\n         * Applies browser-standard sorting via Array.prototype.sort to _models.  Directly compares model keys\n         * @method\n         * @param {String} key      Model key to sort by\n         * @param {Boolean|Undefined} sortDesc If true, sorts by descending order\n         */\n        sortBy: function(key, sortDesc) {\n            this.sort(function(modelA, modelB) {\n                var a = modelA[key];\n                var b = modelB[key];\n\n                if (sortDesc) {\n                    return a > b ? -1 : a < b ? 1 : 0;\n                } else {\n                    return a < b ? -1 : a > b ? 1 : 0;\n                }\n            });\n        },\n\n        /**\n         * Strategy method for browser-standard sorting via Array.prototype.sort to _models. Delegates sorting to a\n         * private method based on the type parameter\n         * @method\n         * @param {String} key      Model key to sort by\n         * @param {Boolean|Undefined} sortDesc If true, sorts by descending order\n         * @param {BaseCollection.SORT.TYPE} type Sorting method is delegated by the type value\n         */\n        sortByType: function(key, sortDesc, type) {\n            if (type === 'string') {\n                this.sortByString(key, sortDesc, true);\n            } else if (type === 'arrayLength') {\n                this.sortByCount(key, sortDesc);\n            } else if (type === 'number') {\n                this.sortByNumber(key, sortDesc);\n            } else {\n                this.sortBy(key, sortDesc);\n            }\n        },\n\n        /**\n         * Strategy method for browser-standard sorting via Array.prototype.sort to _models. Key must be a model\n         * property of type String.\n         * Default sort is ascii order, unless useLowercase is true\n         * @method\n         * @param {String} key      Model key to sort by\n         * @param {Boolean|Undefined} sortDesc If true, sorts by descending order\n         * @param {Boolean} [type=false] Use alphabetical instead of ascii\n         */\n        sortByString: function(key, sortDesc, useLowercase) {\n            this.sort(function(modelA, modelB) {\n                var a = modelA[key];\n                var b = modelB[key];\n\n                if (useLowercase) {\n                    a = a.toLowerCase();\n                    b = b.toLowerCase();\n                }\n\n                if (sortDesc) {\n                    return a > b ? -1 : a < b ? 1 : 0;\n                } else {\n                    return a < b ? -1 : a > b ? 1 : 0;\n                }\n            });\n        },\n\n        /**\n         * Strategy method for browser-standard sorting via Array.prototype.sort to _models. Key must be a model\n         * property of type Array.\n         * Default sort is ascending order, unless sortDesc is true\n         * @method\n         * @param {String} key      Model key to sort by\n         * @param {Boolean|Undefined} sortDesc If true, sorts by descending order\n         * @param {Boolean} [type=false] Use descending or ascending order (ascending is default)\n         */\n        sortByCount: function(key, sortDesc) {\n            this.sort(function(modelA, modelB) {\n                var a = modelA[key] ? modelA[key].length : 0;\n                var b = modelB[key] ? modelB[key].length : 0;\n\n                if (sortDesc) {\n                    return a > b ? -1 : a < b ? 1 : 0;\n                } else {\n                    return a < b ? -1 : a > b ? 1 : 0;\n                }\n            });\n        },\n\n         /**\n         * Strategy method for browser-standard sorting via Array.prototype.sort to _models. Key must be a model\n         * property of type Array.\n         * Default sort is ascending order, unless sortDesc is true\n         * @method\n         * @param {String} key      Model key to sort by\n         * @param {Boolean|Undefined} sortDesc If true, sorts by descending order\n         * @param {Boolean} [type=false] Use descending or ascending order (ascending is default)\n         */\n        sortByNumber: function(key, sortDesc) {\n            this.sort(function(modelA, modelB) {\n                var a = modelA[key] ? modelA[key] : 0;\n                var b = modelB[key] ? modelB[key] : 0;\n\n                if (sortDesc) {\n                    return a > b ? -1 : a < b ? 1 : 0;\n                } else {\n                    return a < b ? -1 : a > b ? 1 : 0;\n                }\n            });\n        },\n\n        /**\n         * @method\n         * @param  {Number|String} id ID of the model to return\n         * @return {BaseModel}    Found model\n         */\n        get: function(id) {\n            var i = 0;\n            var len = this._models.length;\n            for (; i < len; i++) {\n                // Some server IDs are BIGINT (strings), others are numbers. However, all are auto-incremented, so\n                // 0 is never a valid identifier and type coersion is both acceptable and necessary in this case.\n                /* jshint eqeqeq:false */\n                if (this._models[i].id == id) {\n                    return this._models[i];\n                }\n            }\n        },\n\n        /**\n         * Return the model at the given index.  Appropriate only when .each is not acceptable (i.e. in a for loop)\n         * @param  {Integer} index index of the model\n         * @return {BaseModel}\n         */\n        at: function(index) {\n            return this._models[index];\n        },\n\n        /**\n         * @method\n         * @param  {Number} pageNumber Starting index of models to return\n         * @param  {Number} perPage    Range length of models to return\n         * @return {BaseModel[]}       Array of models starting at pageNumber up to but not including pageNumber+perPage\n         */\n        getPage: function(pageNumber, perPage) {\n            var startIndex = perPage * (pageNumber - 1);\n            var endIndex = startIndex + perPage;\n\n            if (startIndex > this._models.length - 1) {\n                return [];\n            }\n\n            return this._models.slice(startIndex, endIndex);\n        },\n\n        contains: function(id) {\n            var i;\n            var len = this.length;\n            for (i = 0; i < len; i++) {\n                if (this._models[i].id === id) {\n                    return true;\n                }\n            }\n            return false;\n        },\n\n        /**\n         * Compare this collection to another, then\n         *   remove and add items individually until the two match\n         * @param otherCollection {BaseCollection}\n         *   A collection of the same type as `this`\n         * @return {Object<Array<?>>}\n         *   A diff representing the changes made to this object. Example:\n         *   - this collection's IDs: [1, 2, 3, 4, 5]\n         *   - other collection's IDs: [4, 5, 6, 7]\n         *   - after merge, this collection's IDs: [4, 5, 6, 7]\n         *   - return value: {removed: [1, 2, 3], added: [6, 7]}\n         */\n        merge: function(otherCollection) {\n            var self;\n            var removed; \n            var added;\n\n            // Ignore collections of different types\n            if (this.constructor !== otherCollection.constructor) {\n                return []; // exit early\n            }\n\n            self = this;\n            removed = [];\n            added = [];\n\n            // Remove models\n            this.each(function(element, index) {\n                if (!otherCollection.contains(element.id)) {\n                    this.remove(element.id);\n                    removed.push(element.id);\n                }\n            });\n\n            // Add model objects\n            otherCollection.each(function(element, index) {\n                if (!this.contains(element.id)) {\n                    this.add(element);\n                    added.push(element.id);\n                }\n            });\n\n            return {\n                'removed': removed,\n                'added': added\n            };\n\n        },\n\n        /**\n         * @method\n         * @param  {Number} id ID of model to remove\n         * @return {BaseModel|Number} Model removed, or -1 if model not found\n         */\n        _removeById: function(id) {\n            var len = this.length;\n            var i;\n\n            for (i = 0; i < len; i++) {\n                if (this._models[i].id === id) {\n                    return this._models.splice(i, 1);\n                }\n            }\n        },\n\n        /**\n         * @method\n         * @param  {BaseModel} Model to remove\n         * @return {BaseModel|Number} Model removed, or -1 if model not found\n         */\n        _removeByModel: function(model) {\n            var len = this.length;\n            var i;\n\n            for(i = 0; i < len; i++) {\n                if (this._models[i] === model) {\n                    return this._models.splice(i, 1);\n                }\n            }\n        }\n    };\n\n    // Borrowed from Backbone\n    // @see http://backbonejs.org/docs/backbone.html\n    var methods = [\n        'forEach',\n        'each',\n        'map',\n        'reduce',\n        'find',\n        'filter',\n        'indexOf'\n    ];\n\n    _.each(methods, function(method) {\n        BaseCollection.prototype[method] = function() {\n            var args = Array.prototype.slice.call(arguments);\n            args.unshift(this._models);\n            return _[method].apply(_, args);\n        };\n    });\n\n    /**\n     * Sorting constants\n     * @memberOf BaseCollection\n     * @constant\n     */\n    BaseCollection.SORT = {\n        /** @enum Sorting types */\n        TYPE: {\n            ARRAY_LENGTH: 'arrayLength',\n            STRING: 'string',\n            DATE: 'date',\n            NUMBER: 'number'\n        }\n    };\n\n    return BaseCollection;\n  });\n\n'use strict';\n\n/**\n * @ngdoc service\n * @name troutDashApp.BaseApiService\n * @description\n * # BaseApiService\n * Factory in the troutDashApp.\n */\n\n\n\nangular.module('troutSpotr')\n  .factory('BaseApiService', ['$rootScope', '$cacheFactory', '$http', '$q', '$timeout',\n    function ($rootScope, $cacheFactory, $http, $q, $timeout) {\n    var sessionStorage = window.sessionStorage;\n    var DEBUGGER_LATENCY = 800;\n    var globalCache = $cacheFactory('du');\n\n    function BaseApiService() {\n        this.cache = globalCache;\n    }\n\n    BaseApiService.prototype = {\n      cache: null,\n      resetCache: function() {\n          globalCache.removeAll();\n      },\n\n      logCache: function() {\n        var info = this.cache.info();\n        console.log('cache', info);\n      },\n\n      doCall: function(data, endpoint, cache) {\n        cache = false;\n\n        var config = {\n            url: BaseApiService.API_BASE_PATH + endpoint,\n            params: data,\n            cache: cache,\n            method: 'GET'\n        };\n\n        var deferred = $q.defer();\n\n          $timeout(function() {\n            var gettingData = $http(config)\n              .then(function(response) {\n                  if (response && response.data && response.data.exceptionType) {\n                      return $q.reject(response.data);\n                  }\n\n                  return response.data;\n              }).catch(function(reason) {\n                  // perform some operation here if need be...\n                  return $q.reject(reason);\n              });\n\n            deferred.resolve(gettingData);\n          }, DEBUGGER_LATENCY);\n\n          return deferred.promise;\n      }\n    };\n\n    BaseApiService.API_BASE_PATH = '';\n\n    return BaseApiService;\n  }]);\n\n(function() {\n  'use strict';\n\n  angular\n    .module('troutSpotr')\n    .run(runBlock);\n\n  /** @ngInject */\n  function runBlock($log) {\n\n    $log.debug('runBlock end');\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('troutSpotr')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig($stateProvider, $urlRouterProvider) {\n    $stateProvider\n      .state('home', {\n        url: '/',\n        templateUrl: 'app/ui/main/main.html',\n        controller: 'MainController',\n        controllerAs: 'main'\n      });\n\n    $urlRouterProvider.otherwise('/');\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('troutSpotr');\n    // .constant('malarkey', malarkey)\n    // .constant('moment', moment);\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('troutSpotr')\n    .config(config);\n\n  /** @ngInject */\n  function config($logProvider) {\n    // Enable log\n    $logProvider.debugEnabled(true);\n  }\n\n})();\n\nangular.module(\"troutSpotr\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"app/ui/accessPointSummary/AccessPointSummaryTallyTemplate.html\",\"<svg class=\\\"js-tally-root access-point\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" width=\\\"100%\\\" height=\\\"100%\\\" viewbox=\\\"0 0 32 24\\\"></svg>\");\n$templateCache.put(\"app/ui/accessPointSummary/AccessPointSummaryTemplate.html\",\"<span class=\\\"access-point\\\"><span data-ng-class=\\\"{\\'hide\\': numerator === 0}\\\" class=\\\"numerator\\\">{{::numerator}}:</span><span class=\\\"denominator\\\">{{::denominator}}</span></span>\");\n$templateCache.put(\"app/ui/main/main.html\",\"<div class=\\\"container\\\"><div data-mini-map-directive=\\\"\\\"></div><div data-stream-list=\\\"\\\"></div></div>\");\n$templateCache.put(\"app/ui/miniMap/minimaptemplate.html\",\"<div class=\\\"somethingContainer\\\" data-ng-class=\\\"{\\'somethingContainer-major\\': minimapState.isMacro}\\\"><div class=\\\"js-mini-map something\\\"></div></div>\");\n$templateCache.put(\"app/ui/speciesSummary/speciessummarytemplate.html\",\"<span class=\\\"icon\\\"><svg preserveaspectratio=\\\"xMidYMid meet\\\" width=\\\"100%\\\" height=\\\"100%\\\" viewbox=\\\"0 0 16 16\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" class=\\\"species\\\"><g><g class=\\\"species brown\\\"><circle class=\\\"population\\\" data-is-populated=\\\"{{::stream.HasBrownTrout}}\\\" data-ng-class=\\\"{\\'none\\': stream.HasBrownTrout === false}\\\" cx=\\\"4\\\" cy=\\\"12\\\" r=\\\"2.5\\\"></circle><circle class=\\\"stocking {{stream.HasStockedBrownTrout ? \\'stocked\\' : \\'none\\'}}\\\" data-is-stocked=\\\"{{::stream.HasStockedBrownTrout}}\\\" cx=\\\"4\\\" cy=\\\"12\\\" r=\\\"2.7\\\"></circle></g><g class=\\\"species brook\\\"><circle class=\\\"population\\\" data-is-populated=\\\"{{::stream.HasBrookTrout}}\\\" data-ng-class=\\\"{\\'none\\': stream.HasBrookTrout === false}\\\" cx=\\\"12\\\" cy=\\\"12\\\" r=\\\"2.5\\\"></circle><circle class=\\\"stocking {{stream.HasStockedBrookTrout ? \\'stocked\\' : \\'none\\'}}\\\" data-is-stocked=\\\"{{::stream.HasStockedBrookTrout}}\\\" cx=\\\"12\\\" cy=\\\"12\\\" r=\\\"2.7\\\"></circle></g><g class=\\\"species rainbow\\\"><circle class=\\\"population\\\" data-is-populated=\\\"{{::stream.HasRainbowTrout}}\\\" data-ng-class=\\\"{\\'none\\': stream.HasRainbowTrout === false}\\\" cx=\\\"8\\\" cy=\\\"5.0718\\\" r=\\\"2.5\\\"></circle><circle class=\\\"stocking {{stream.HasStockedRainbowTrout ? \\'stocked\\' : \\'none\\'}}\\\" data-is-stocked=\\\"{{::stream.HasStockedRainbowTrout}}\\\" cx=\\\"8\\\" cy=\\\"5.0718\\\" r=\\\"2.7\\\"></circle></g></g></svg></span>\");\n$templateCache.put(\"app/ui/restrictions/restrictionlegendtemplate.html\",\"<ul class=\\\"restrictions\\\" data-ng-repeat=\\\"restriction in stream.Restrictions\\\"><li><div class=\\\"media\\\"><div class=\\\"media-hd legend\\\" data-ng-class=\\\"{\\'stream-line_restriction\\': $index === 0, \\'stream-line_restriction_secondary\\': $index === 1}\\\"></div><span class=\\\"media-bd heading\\\">{{restriction.FullText}}</span></div></li></ul>\");\n$templateCache.put(\"app/ui/restrictions/streamrestrictiontemplate.html\",\"<ul class=\\\"restrictions\\\" data-ng-repeat=\\\"restriction in restrictionViewModel.restrictions\\\"><li><div class=\\\"media\\\"><div class=\\\"media-hd legend {{restriction.cssClass}}\\\"></div><span class=\\\"media-bd heading\\\">{{restriction.text}}</span></div></li></ul>\");\n$templateCache.put(\"app/ui/streamLine/streamlinetemplate.html\",\"<div class=\\\"js-stream-line\\\"></div>\");\n$templateCache.put(\"app/ui/streamList/streamlisttemplate.html\",\"<div data-ng-cloak=\\\"\\\" id=\\\"js-list-container\\\"><div data-ng-repeat=\\\"region in mapState.selectedRegion | limitTo:1 | orderBy:\\'name\\'\\\" id=\\\"{{::getRegionId(region)}}\\\" data-region-header=\\\"\\\"></div></div>\");\n$templateCache.put(\"app/ui/streamRatio/streamratiotemplate.html\",\"<svg class=\\\"stream-ratio\\\" preserveaspectratio=\\\"xMidYMid meet\\\" width=\\\"100%\\\" height=\\\"100%\\\" viewbox=\\\"0 0 16 16\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><g class=\\\"stream-line_route\\\"><circle cx=\\\"8\\\" cy=\\\"8\\\" ng-attr-r=\\\"{{::streamRatio.waterRadius * 2.2}}\\\"></circle></g><g class=\\\"stream-ratio_public-land\\\"><circle cx=\\\"8\\\" cy=\\\"8\\\" ng-attr-r=\\\"{{::streamRatio.publicLandRadius * 2.2}}\\\"></circle></g></svg>\");\n$templateCache.put(\"app/ui/streamList/county/CountyHeaderTemplate.html\",\"<div fsm-sticky-header=\\\"\\\" scroll-body=\\\"getCountyScrollBodyId(county)\\\" scroll-stop=\\\"23\\\" scroll-object=\\\"county\\\" z-index-override=\\\"10000\\\" class=\\\"sectionTitle region-header\\\">{{::county.name}} Co. {{displayedStreams.length}} : {{county.children.length}}</div><div infinite-scroll=\\\"loadMoreStreams()\\\" infinite-scroll-distance=\\\"1\\\"><div ng-class-odd=\\\"\\'box\\'\\\" ng-class-even=\\\"\\'box box-secondary\\'\\\" data-ng-repeat=\\\"stream in displayedStreams\\\"><div data-stream-list-item-directive=\\\"\\\"></div></div></div>\");\n$templateCache.put(\"app/ui/streamList/streamListItem/StreamListItemHeaderTemplate.html\",\"<div class=\\\"header-container\\\"><div data-ng-click=\\\"expand()\\\" class=\\\"primary\\\"><span data-stream-ratio=\\\"\\\" class=\\\"icon\\\"></span> <span class=\\\"title\\\">{{::stream.Name}}</span></div><div class=\\\"details header-container\\\"><div class=\\\"icon\\\"><div data-species-summary=\\\"\\\"></div></div><div class=\\\"icon\\\" data-access-point-summary-tally=\\\"\\\"></div><div class=\\\"icon\\\"><svg class=\\\"alert\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" width=\\\"40%\\\" height=\\\"40%\\\" viewbox=\\\"0 0 32 32\\\"><path d=\\\"M31.858 27.675c-3.196-5.42-11.116-18.857-14.395-24.42-0.987-1.672-1.947-1.641-2.859-0.096-3.223 5.464-11.137 18.878-14.395 24.402-0.004 0.006-0.87 2.439 0.954 2.439h29.561c1.969 0 1.048-2.471 1.134-2.325z\\\"></path><text class=\\\"alert-text\\\" x=\\\"12\\\" y=\\\"25\\\" font-family=\\\"Futura\\\" font-size=\\\"24\\\">!</text></svg></div></div></div>\");\n$templateCache.put(\"app/ui/streamList/streamListItem/streamlistitemtemplate.html\",\"<div class=\\\"box\\\" data-stream-id=\\\"{{::stream.Id}}\\\"><div><div data-stream-list-item-header=\\\"\\\"></div><div data-ng-if=\\\"isSmall === false\\\"><div class=\\\"containerBody grid-row\\\"><div class=\\\"grid-row-col_12of12\\\"><div data-stream-line=\\\"\\\"></div></div></div><div class=\\\"grid-row\\\"><div class=\\\"grid-row-col grid-row-col_9of12 media_list\\\"><div data-ng-if=\\\"stream.Restrictions.length > 0\\\" data-restriction-legend=\\\"\\\"></div><div data-ng-repeat=\\\"accessPoint in stream.AccessPoints | orderBy:\\'LinearOffset\\':true\\\"><span class=\\\"roadIntersectionIndicator\\\" data-ng-class=\\\"{\\'roadIntersectionIndicator_public\\': accessPoint.IsOverOrNearPublicLand}\\\"></span> <span class=\\\"roadIntersectionIndicator troutStreamIntersection\\\" data-ng-class=\\\"{\\'troutStreamIntersection_none\\': accessPoint.IsOverOrNearTroutStreamSection === false}\\\"></span> <a class=\\\"heading\\\" target=\\\"_blank\\\" href=\\\"https://www.google.com/maps/@{{accessPoint.Latitude}},{{accessPoint.Longitude}},17z\\\">{{accessPoint.Name}}</a></div></div><div class=\\\"grid-row-col grid-row-col_3of12\\\"><div data-stream-ratio-text=\\\"\\\"></div></div></div></div></div></div>\");\n$templateCache.put(\"app/ui/streamList/region/RegionHeaderTemplate.html\",\"<div fsm-sticky-header=\\\"\\\" scroll-body=\\\"getRegionScrollBodyId(region)\\\" scroll-stop=\\\"0\\\" scroll-object=\\\"region\\\" z-index-override=\\\"10100\\\" class=\\\"sectionTitle region-header\\\"><a id=\\\"region-hdr_{{region.id}}\\\" href=\\\"#\\\">{{::region.name}} {{displayedCounties.length}} : {{region.children.length}}</a></div><div infinite-scroll=\\\"loadMoreCounties()\\\" infinite-scroll-distance=\\\"1\\\"><div data-ng-repeat=\\\"county in displayedCounties\\\" id=\\\"{{::getCountyId(county)}}\\\" data-county-header=\\\"\\\"></div></div>\");}]);"],"sourceRoot":"/source/"}