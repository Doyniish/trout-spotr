{"version":3,"sources":["scripts/app-1ad788a646.js"],"names":["angular","module","directive","templateUrl","restrict","link","scope","element","attrs","isSmall","isAlertSymbolDisplayed","isRestrictions","stream","Restrictions","length","isMessage","AlertMessage","getAlertMessage","expand","console","log","getCounties","Counties","map","c","Name","join","getAlternativeNames","LocalNames","StreamApiService","displayedCounties","init","clearCounties","loadMoreCounties","numberOfCountiesToAdd","numberOfDisplayedCounties","numberOfChildCounties","region","children","numberOfCountiesRemaining","Math","min","finalIndex","i","countyToInject","push","getScrollContainer","getRegionScrollBodyId","result","getRegionId","id","displayedStreams","clearStreams","loadMoreStreams","numberOfStreamsToAdd","numberOfDisplayedStreams","numberOfChildStreams","county","numberOfStreamsRemaining","streamToInject","getCountyScrollBodyId","getCountyId","StreamRatioViewModel","model","TroutStreamsLength","PalsLength","streamRatio","stage","isLoaded","streams","selectedStream","$watch","newSelectedStream","oldSelectedStream","controller","$scope","TableOfContentsRepository","RegionGeometryService","$anchorScroll","isSmallView","getInitialMapState","mapState","isExpanded","isLoading","selectedRegionGeometry","selectedRegion","selectedCounty","highlightedStream","currentClientCoordinates","NaN","selectCounty","countyId","selectRegion","regionModel","Error","canRetrieveFromCache","stateModel","parent","getRegion","then","newSelectedRegionGeometry","getTableOfContents","toc","bustCache","bustTableOfContentsCache","toggleMinimap","LinearReferenceViewModel","parseFloat","LengthMiles","width","createTickMarks","clampedLength","floor","tickMarks","xOffset","height","yOffset","tickWidth","drawLines","inverseLength","streamLine","d3","select","append","attr","publicSegments","Pal","Sections","segment","publicLand","selectAll","data","enter","d","lakes","Lakes","accessPoints","AccessPoints","TroutStreams","troutStreamSections","forEach","restriction","index","restrictionModels","linearReferenceViewModel","roadIntersections","LinearOffset","IsOverOrNearPublicLand","firstMark","fsm","$rootScope","replace","scrollBody","scrollStop","scrollableContainer","contentOffset","scrollObject","zIndexOverride","attributes","control","setColumnHeaderSizes","clonedHeader","is","clonedColumns","find","header","each","column","clonedColumn","$","css","offsetWidth","determineVisibility","scrollTop","currentContent","getContent","contentTop","offset","top","contentBottom","outerHeight","createClone","visibility","calculateSize","remove","removeClass","position","left","z-index","outerWidth","$broadcast","clone","after","addClass","this","content","window","on","trigger","$on","off","$location","el","menuOnClick","e","menuTitle","currentTarget","submenu","next","slideToggle","chevron","toggleClass","menuItems","navigationMenu","menuOnKeydown","activeMenu","getCurrentMenuItem","keyCode","tabOutOfMenu","triggerMenuItem","highlightMenuItem","shiftKey","focus","firstTabItem","preventDefault","stopPropagation","first","focusedMenu","menuOnFocus","menuTitles","click","keydown","path","allMenuItems","menuItem","menu","split","indexOf","parentElement","submenus","parents","show","chevrons","prev","bodyOnKeydown","ctrlKey","altKey","isMenuClosed","menuButton","hasClass","setMenuSpin","setTimeout","$filter","transclude","orderBy","currentPage","pagedDataName","fsmBigData","rightHandExpression","pageSize","parseInt","sourceData","rawData","sortedData","pagedData","page","sortTypes","sortColumns","transcludedScope","nextPage","dataSlice","slice","apply","renderData","addSortColumn","columnName","sortType","splice","direction","unshift","onPageScroll","s","document","scrollPercent","$apply","$parent","$watchCollection","newData","sortIconTemplate","swapIcons","sortIcon","classToAdd","currentSortType","applySort","columnHeader","fsmSort","cursor","MINI_MAP_CLASS","GeometryApiService","$q","$timeout","reset","active","classed","svg","transition","duration","call","zoom","translate","scale","event","zoomed","root","style","onLoadRegion","regionElement","resetLoadRegion","minimapState","loadingRegion","arrayOfStreams","selectedStreams","_","unique","flatten","streamObjects","Id","name","geometry","delay","exit","zoomToGeometry","node","bounds","dx","dy","x","y","max","getFipsCode","countyFeature","fips","statefp","countyfp","getFipsCodeSelector","attribute","t","counties","stopped","defaultPrevented","regionGeometries","selectedRegionId","selectedCountyId","isMacro","item","type","unwatchRegionId","newRegionId","oldRegionId","soughtRegion","currentRegions","filter","f","unwatchCountyId","newCounty","oldCounty","soughtCounty","currentCounties","unwatchGeometries","newGeometries","oldGeometries","drawGeometries","geometries","initializeMap","stateObject","projection","geo","albersUsa","pointRadius","state","b","behavior","scaleExtent","size","onBackgroundClick","states","regions","onRegionClick","regionId","bind","minifyMinimap","macrofyMinimap","isMacroMode","drawGeometryToMap","shortName","pluck","value","currentState","minStreamCount","countyStreamCounts","feat","stream_count","maxStreamCount","countyChoroplethScale","linear","domain","range","unwatchTableOfContents","factory","RectangleLayoutService","getScale","itemLength","sqrt","getXGivenY","getYGivenX","pythagoreanTheorem","proto","prototype","getBoundingBox","numberOfItems","minimumXPosition","minimumYPosition","xPrime","ceil","yPrime","newYLength","yZLength","newXLength","xZLength","candidate","ROOT_CLASS","WIDTH","HEIGHT","troutStreamIntersections","IsOverOrNearTroutStreamSection","sort","a","denominator","publicTroutStreamIntersections","numerator","rows","generator","dimensions","numberOfColumns","numberOfRows","boxWidth","widthOfContainer","heightOfContainer","container","xPosition","yPosition","BaseApiService","HierarchicalGeometryViewModel","TABLE_OF_CONTENTS_CACHE_KEY","logCache","Object","create","cache","key","get","promise","doCall","regionTopoJson","topojson","feature","objects","streamProperties","stateHash","features","prop","properties","gid","centroidLatitude","short_name","centroidLongitude","indexBy","regionHash","sortBy","countyhash","countyModel","extend","countyByRegion","groupBy","minnesota","regionByState","streamHash","streamModel","CentroidLongitude","CentroidLatitude","stateId","streamCountyModel","put","BaseCollection","HierarchicalGeometryCollection","constructor","RegionRepositoryService","getRegions","isCached","regionid","cacheRegion","uncacheRegion","REGION_CACHE_KEY","createKey","RegionApiService","regionKey","createPath","totalLength","publicLandLength","computeRadiusFromLength","area","PI","waterRadius","publicLandLengthTOWaterLengthRatio","publicLandRadius","$cacheFactory","$http","getStreams","deferred","defer","gettingData","response","resolve","StreamLineViewModel","lineSegment","stop","Stop","start","Start","abs","getRegionGeometries","BaseModel","json","_fromJSON","hasOwnProperty","toJSON","hash","destroy","generateIdomaticName","udefOrArray","_models","_addAll","toArray","copy","arrayOrUndefined","modelData","len","add","instanceModel","modelDataOrId","referenceToModelOrId","_removeByModel","_removeById","empty","sortFn","sortDesc","modelA","modelB","sortByType","sortByString","sortByCount","sortByNumber","useLowercase","toLowerCase","at","getPage","pageNumber","perPage","startIndex","endIndex","contains","merge","otherCollection","self","removed","added","methods","method","args","Array","arguments","SORT","TYPE","ARRAY_LENGTH","STRING","DATE","NUMBER","globalCache","DEBUGGER_LATENCY","sessionStorage","resetCache","removeAll","info","endpoint","config","url","API_BASE_PATH","params","exceptionType","reject","reason","runBlock","$log","debug","run","$inject","routerConfig","$stateProvider","$urlRouterProvider","controllerAs","otherwise","$logProvider","debugEnabled","$templateCache"],"mappings":"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","file":"scripts/app-1ad788a646.js","sourcesContent":["(function() {\n  'use strict';\n  angular.module('fsm', []);\n  angular\n    .module('troutSpotr', ['ngAnimate', 'ngCookies', 'ngAria', 'ui.router', 'fsm', 'infinite-scroll']);\n\n})();\n\n'use strict';\n\n/**\n * @ngdoc directive\n * @name troutDashApp.directive:StreamListItemDirective\n * @description\n * # StreamListItemDirective\n */\nangular.module('troutSpotr')\n  .directive('streamListItemDirective', function() {\n    return {\n      templateUrl: 'app/ui/streamList/streamListItem/streamlistitemtemplate.html',\n      restrict: 'A',\n      link: function postLink(scope, element, attrs) {\n        scope.isSmall = true;\n        scope.isAlertSymbolDisplayed = function() {\n          if (scope.isSmall === false) {\n            return false;\n          }\n\n          var isRestrictions = scope.stream.Restrictions.length > 0;\n          var isMessage = scope.stream.AlertMessage != null && scope.stream.AlertMessage.length > 0;\n\n          if (isRestrictions && isMessage) {\n            return true;\n          }\n        };\n\n        scope.getAlertMessage = function() {\n          return scope.stream.AlertMessage;\n        };\n\n        scope.expand = function() {\n          scope.isSmall = !scope.isSmall;\n          console.log(scope.stream);\n        };\n\n        scope.getCounties = function() {\n          if (!scope.stream.Counties) {\n            return null;\n          }\n\n          return scope.stream.Counties.map(function(c) {\n            return c.Name;\n          }).join(',');\n        };\n\n        scope.getAlternativeNames = function() {\n          if (!scope.stream.LocalNames) {\n            return null;\n          }\n\n          if (scope.stream.LocalNames.length === 0) {\n            return '';\n          }\n\n          return 'aka ' + scope.stream.LocalNames.join(',');\n        };\n      }\n    };\n  });\n'use strict';\n\n/**\n * @ngdoc directive\n * @name troutDashApp.directive:StreamListItemDirective\n * @description\n * # StreamListItemDirective\n */\nangular.module('troutSpotr')\n  .directive('streamListItemHeader', function () {\n    return {\n      templateUrl: 'app/ui/streamList/streamListItem/StreamListItemHeaderTemplate.html',\n      restrict: 'A',\n      link: function postLink(scope, element, attrs) {\n\n      }\n    };\n  });\n\n'use strict';\n/**\n * @ngdoc directive\n * @name troutDashApp.directive:StreamListDirective\n * @description\n * # StreamListDirective\n */\nangular.module('troutSpotr')\n  .directive('regionHeader', ['StreamApiService',\n    function(StreamApiService) {\n      return {\n        //app/ui/main/main.html\n        templateUrl: 'app/ui/streamList/region/RegionHeaderTemplate.html',\n        restrict: 'A',\n        link: function postLink(scope, element, attrs) {\n          scope.displayedCounties = [];\n\n          scope.init = function() {\n            scope.clearCounties();  \n          };\n\n          scope.clearCounties = function() {\n            scope.displayedCounties = [];\n          };\n\n          scope.loadMoreCounties = function(numberOfCountiesToAdd) {\n            var numberOfDisplayedCounties = scope.displayedCounties.length;\n            var numberOfChildCounties = scope.region.children.length;\n\n            numberOfCountiesToAdd = numberOfCountiesToAdd == null ? 1 : numberOfCountiesToAdd;\n            var numberOfCountiesRemaining = numberOfChildCounties - numberOfDisplayedCounties;\n            numberOfCountiesToAdd = Math.min(numberOfCountiesRemaining, numberOfCountiesToAdd);\n            var finalIndex = numberOfDisplayedCounties + numberOfCountiesToAdd;\n            for (var i = numberOfDisplayedCounties; i < finalIndex; i++) {\n              var countyToInject = scope.region.children[i];\n              scope.displayedCounties.push(countyToInject);\n            }\n          };\n\n          scope.getScrollContainer = function() {\n            return '#js-list-container';\n          };\n\n          scope.getRegionScrollBodyId = function(region) {\n            var result = '#' + scope.getRegionId(region);\n            return result;\n          };\n\n          scope.getRegionId = function(region) {\n            var result = 'hdr-region_' + region.id;\n            return result;\n          };\n\n          scope.init();\n        }\n      };\n    }\n  ]);\n'use strict';\n/**\n * @ngdoc directive\n * @name troutDashApp.directive:StreamListDirective\n * @description\n * # StreamListDirective\n */\nangular.module('troutSpotr')\n  .directive('countyHeader', ['StreamApiService',\n    function(StreamApiService) {\n      return {\n        //app/ui/main/main.html\n        templateUrl: 'app/ui/streamList/county/CountyHeaderTemplate.html',\n        restrict: 'A',\n        link: function postLink(scope, element, attrs) {\n          scope.displayedStreams = [];\n\n          scope.init = function() {\n            scope.clearStreams();  \n          };\n\n          scope.clearStreams = function() {\n            scope.displayedStreams = [];\n          };\n\n          scope.loadMoreStreams = function(numberOfStreamsToAdd) {\n            var numberOfDisplayedStreams = scope.displayedStreams.length;\n            var numberOfChildStreams = scope.county.children.length;\n\n            numberOfStreamsToAdd = numberOfStreamsToAdd == null ? 30 : numberOfStreamsToAdd;\n            var numberOfStreamsRemaining = numberOfChildStreams - numberOfDisplayedStreams;\n            numberOfStreamsToAdd = Math.min(numberOfStreamsRemaining, numberOfStreamsToAdd);\n            var finalIndex = numberOfDisplayedStreams + numberOfStreamsToAdd;\n            for (var i = numberOfDisplayedStreams; i < finalIndex; i++) {\n              var streamToInject = scope.county.children[i];\n              scope.displayedStreams.push(streamToInject);\n            }\n          };\n\n          scope.getCountyScrollBodyId = function(county) {\n            var result = '#' + scope.getCountyId(county);\n            return result;\n          };\n\n          scope.getScrollContainer = function() {\n            return '#js-list-container';\n          };\n\n          scope.getCountyId = function(county) {\n            return 'hdr-county_' + county.id;\n          };\n\n          scope.init();\n        }\n      };\n    }\n  ]);\n'use strict';\n\n/**\n * @ngdoc directive\n * @name troutDashApp.directive:streamRatio\n * @description\n * # streamRatio\n */\nangular.module('troutSpotr')\n  .directive('streamRatio', function (StreamRatioViewModel) {\n    return {\n      templateUrl: 'app/ui/streamRatio/streamratiotemplate.html',\n      restrict: 'A',\n      link: function postLink(scope, element, attrs) {\n        var model = new StreamRatioViewModel(scope.stream.TroutStreamsLength, scope.stream.PalsLength);\n        scope.streamRatio = model;\n      }\n    };\n  });\n\n'use strict';\n/**\n * @ngdoc directive\n * @name troutDashApp.directive:StreamListDirective\n * @description\n * # StreamListDirective\n */\nangular.module('troutSpotr')\n  .directive('streamList', ['StreamApiService',\n    function(StreamApiService) {\n      return {\n        //app/ui/main/main.html\n        templateUrl: 'app/ui/streamList/streamlisttemplate.html',\n        restrict: 'A',\n        link: function postLink(scope, element, attrs) {\n          scope.stage = {\n            isLoaded: false,\n            streams: null,\n            selectedStream: null\n          };\n\n          // scope.getScrollContainer = function() {\n          //   return '#js-list-container';\n          // };\n\n          // scope.getRegionScrollBodyId = function(region) {\n          //   var result = '#' + scope.getRegionId(region);\n          //   return result;\n          // };\n\n          // scope.getRegionId = function(region) {\n          //   var result = 'hdr-region_' + region.id;\n          //   return result;\n          // };\n\n          scope.getScrollContainer = function() {\n            return '#js-list-container';\n          };\n\n          scope.$watch('stage.selectedStream', function(newSelectedStream, oldSelectedStream) {\n            if (newSelectedStream == null) {\n              return;\n            }\n          });\n        }\n      };\n    }\n  ]);\n'use strict';\n\n/**\n * @ngdoc function\n * @name troutDashApp.controller:StreamlistcontrollerCtrl\n * @description\n * # StreamlistcontrollerCtrl\n * Controller of the troutDashApp\n */\nangular.module('troutSpotr')\n\t.controller('StreamlistcontrollerCtrl', ['$scope', 'StreamApiService', \n\t\t'TableOfContentsRepository', 'RegionGeometryService', \n\t\t'$anchorScroll',\n\t\tfunction ($scope, StreamApiService, TableOfContentsRepository, RegionGeometryService, $anchorScroll) {\n\t\t$scope.isSmallView = false;\n\n\t\tvar getInitialMapState = function() {\n\t\t\tvar mapState = {\n\t\t\t\tisExpanded: false,\n\t\t\t\tisLoading: false,\n\t\t\t\tselectedRegionGeometry: null,\n\t\t\t\tselectedRegion: null,\n\t\t\t\tselectedCounty: null,\n\t\t\t\thighlightedStream: null,\n\t\t\t\tcurrentClientCoordinates: [NaN, NaN]\n\t\t\t};\n\t\t\treturn mapState;\n\t\t};\n\n\t\t$scope.mapState = getInitialMapState();\n\n\t\t$scope.selectCounty = function(countyId) {\n\t\t\tconsole.log(countyId);\n\t\t};\n\n\t\t$scope.selectRegion = function(regionModel) {\n\t\t\tif (regionModel == null) {\n\t\t\t\tthrow new Error('regionModel cannot be null');\n\t\t\t}\n\n\t\t\t\n\n\t\t\t// TODO: fix this to have an actual cache.\n\t\t\t// try to pull it from the cache\n\t\t\tvar canRetrieveFromCache = false;\n\t\t\tif (canRetrieveFromCache) {\n\t\t\t\t// return it from our cache.\n\t\t\t\t// TODO: fix this part too\n\t\t\t\t$scope.mapState.selectedRegionGeometry = null;\n\t\t\t\t$scope.mapState.selectedRegion = [regionModel];\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// load it from our repository.\n\t\t\tvar stateModel = regionModel.parent;\n\t\t\treturn RegionGeometryService.getRegion(stateModel, regionModel)\n\t\t\t\t.then(function(newSelectedRegionGeometry) {\n\t\t\t\t\t$scope.mapState.selectedRegionGeometry = [newSelectedRegionGeometry];\n\t\t\t\t\t$scope.mapState.selectedRegion = [regionModel];\n\t\t\t\t\t$anchorScroll('region-hdr_' + regionModel.id);\n\t\t\t\t\treturn newSelectedRegionGeometry;\n\t\t\t\t});\n\t\t};\n\n\t\t$scope.getTableOfContents = function() {\n\t\t\treturn TableOfContentsRepository.getTableOfContents()\n\t\t\t\t.then(function(toc) {\n\t\t\t\t\treturn toc;\n\t\t\t\t});\n\t\t};\n\n\t\t$scope.bustCache = function() {\n\t\t\tconsole.log('busting cache...');\n\t\t\t// this is actually going directly to the base cache...\n\t\t\tTableOfContentsRepository.bustTableOfContentsCache();\n\t\t};\n\n\t\t$scope.toggleMinimap = function() {\n\t\t\tif ($scope.mapState == null) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$scope.mapState.isExpanded = !$scope.mapState.isExpanded;\n\t\t};\n\t}]);\n\n'use strict';\n\n/**\n * @ngdoc directive\n * @name troutDashApp.directive:streamLine\n * @description\n * # streamLine\n */\nangular.module('troutSpotr')\n  .directive('streamLine', function(LinearReferenceViewModel) {\n    return {\n      templateUrl: 'app/ui/streamLine/streamlinetemplate.html',\n      restrict: 'A',\n      link: function(scope, element, attrs) {\n        var length = parseFloat(scope.stream.LengthMiles);\n        if (length <= 0) {\n          return;\n        }\n        var inverseLength = 1 / length;\n        scope.stage = {\n          width: element.width()\n        };\n\n        var createTickMarks = function(LengthMiles) {\n          var clampedLength = Math.floor(length);\n          var tickMarks = [];\n          if (clampedLength < 1) {\n            tickMarks.push({\n              xOffset: 0,\n              width: 1,\n              height: 3,\n              yOffset: 7\n            });\n\n            return tickMarks;\n          }\n\n          var tickWidth = scope.stage.width / LengthMiles;\n          for (var i = 0; i <= clampedLength; i++) {\n            tickMarks.push({\n              xOffset: i * tickWidth,\n              width: 1.5,\n              height: 4,\n              yOffset: 8\n            });\n          }\n\n          return tickMarks;\n        };\n\n\n        scope.drawLines = function() {\n\n          var length = parseFloat(scope.stream.LengthMiles);\n          var inverseLength = 1 / length;\n          scope.streamLine = d3.select(element[0])\n            .append('svg')\n            .attr('class', 'stream-line')\n            .attr('width', scope.stage.width)\n            .attr('height', 16)\n            .attr('xmlns', 'http://www.w3.org/2000/svg');\n\n          // PUBLIC LAND\n          // Prepare\n          scope.publicSegments = scope.stream.Pal.Sections.map(function(segment) {\n            return new LinearReferenceViewModel(segment, inverseLength);\n          });\n\n          // Stage\n          scope.streamLine.publicLand = scope.streamLine.append('g')\n            .attr('class', 'stream-line_public-land');\n\n          // Execute\n          scope.streamLine.publicLand.selectAll('rect')\n            .data(scope.publicSegments).enter()\n            .append('rect')\n            .attr('x', function(d) {\n              return d.xOffset * scope.stage.width;\n            })\n            .attr('y', 0)\n            .attr('width', function(d) {\n              return d.width * scope.stage.width;\n            })\n            .attr('height', 11)\n            .attr('rx', 4)\n            .attr('ry', 4)\n            .attr('class', 'public-land');\n\n\n          // STREAM LINE\n          scope.streamLine.stream = scope.streamLine.append('g')\n            .attr('class', 'stream-line_stream')\n            .append('rect')\n            .attr('x', 0)\n            .attr('y', 3)\n            .attr('height', 5)\n            .attr('width', scope.stage.width);\n\n          // LAKES\n          // Prepare\n          scope.lakes = scope.stream.Lakes.Sections.map(function(segment) {\n            return new LinearReferenceViewModel(segment, inverseLength);\n          });\n\n          scope.accessPoints = scope.stream.AccessPoints;\n\n          // Stage\n          scope.streamLine.lakes = scope.streamLine.append('g')\n            .attr('class', 'stream-line_stream'); // TODO: CHANGE TO LAKE CLASS\n\n          // Execute\n          scope.streamLine.lakes.selectAll('rect')\n            .data(scope.lakes).enter()\n            .append('rect')\n            .attr('x', function(d) {\n              return d.xOffset * scope.stage.width;\n            })\n            .attr('y', 1)\n            .attr('width', function(d) {\n              return d.width * scope.stage.width;\n            })\n            .attr('height', 9)\n            .attr('rx', 4)\n            .attr('ry', 4)\n            .attr('class', 'stream-line_stream');\n\n\n\n          // TROUT STREAM SECTIONS\n          scope.publicSegments = scope.stream.TroutStreams.Sections.map(function(segment) {\n            return new LinearReferenceViewModel(segment, inverseLength);\n          });\n\n          // Stage\n          scope.streamLine.troutStreamSections = scope.streamLine.append('g')\n            .attr('class', 'stream-line_route');\n\n          // Execute\n          scope.streamLine.append('g')\n            .attr('class', 'stream-line_route')\n            .selectAll('g').data(scope.publicSegments).enter()\n            .append('g')\n            .append('rect')\n            .attr('x', function(d) {\n              return d.xOffset * scope.stage.width;\n            })\n            .attr('y', 3)\n            .attr('width', function(d) {\n              return d.width * scope.stage.width;\n            })\n            .attr('height', 5)\n            .attr('class', 'stream-line_route');\n\n          // RESTRICTIONS\n          scope.stream.Restrictions.forEach(function(restriction, index) {\n\n            var restrictionModels = restriction.Sections.map(function(segment) {\n              var linearReferenceViewModel = new LinearReferenceViewModel(segment, inverseLength);\n              segment.segment = linearReferenceViewModel;\n              return segment;\n            });\n\n            scope.streamLine.append('g')\n              .attr('class', index === 0 ? 'stream-line_restriction' : 'stream-line_restriction_secondary')\n              .selectAll('g').data(restrictionModels).enter()\n              .append('g')\n              // .selectAll('rect').data(function(d) {\n              //     return d.segment;\n              // }).enter()\n              .append('rect')\n              .attr('x', function(d) {\n                return d.segment.xOffset * scope.stage.width;\n              })\n              .attr('y', 3)\n              .attr('width', function(d) {\n                return d.segment.width * scope.stage.width;\n              })\n              .attr('height', 5)\n              .attr('class', 'restriction');\n          });\n\n          scope.streamLine.roadIntersections = scope.streamLine.append('g')\n            .attr('class', 'stream-line_roadIntersections');\n\n\n          scope.streamLine.roadIntersections.selectAll('circle')\n            .data(scope.accessPoints).enter()\n            .append('circle')\n            .attr('cy', 5)\n            .attr('r', 2)\n            .attr('cx', function(d) {\n              return (1 - (d.LinearOffset / length)) * scope.stage.width;\n            })\n            .attr('class', function(d) {\n              return d.IsOverOrNearPublicLand ? 'roadIntersetion_public' : 'roadIntersetion_private';\n            });\n\n          var tickMarks = createTickMarks(length);\n          var firstMark = tickMarks[0];\n\n          firstMark.width = 1;\n          firstMark.height = 3;\n          scope.streamLine.tickMarks = scope.streamLine\n            .append('g')\n            .attr('class', 'stream-line_grid-lines')\n            .selectAll('rect').data(tickMarks).enter()\n            .append('rect')\n            .attr('x', function(d) {\n              return scope.stage.width - d.xOffset - d.width;\n            })\n            .attr('y', function(d) {\n              return d.yOffset;\n            })\n            .attr('width', function(d) {\n              return d.width;\n            })\n            .attr('height', function(d) {\n              return d.height;\n            })\n            .attr('class', 'tick');\n        };\n\n\n\n        scope.drawLines();\n      }\n    };\n  });\n'use strict';\n(function(angular) {\n    var fsm = angular.module('fsm');\n\n    fsm.directive('fsmStickyHeader', ['$rootScope', function($rootScope) {\n        return {\n            restrict: 'EA',\n            replace: false,\n            scope: {\n                scrollBody: '=',\n                scrollStop: '=',\n                scrollableContainer: '=',\n                contentOffset: '=',\n                scrollObject: '=',\n                zIndexOverride: '='\n            },\n            link: function(scope, element, attributes, control) {\n                var header = $(element, this);\n                var getContent = function() {\n\n                    var candidateContent;\n                    if (content == null || content.length !== 1) {\n                        content = $(scope.scrollBody);\n                    }\n\n                    return content;\n                };\n\n                scope.zIndexOverride = scope.zIndexOverride != null ? scope.zIndexOverride : 10000;\n\n                var content = getContent();\n                var clonedHeader = null;\n                var content = $(scope.scrollBody);\n                var scrollableContainer = $(scope.scrollableContainer);\n                var contentOffset = scope.contentOffset || 0;\n\n                if (scrollableContainer.length === 0) {\n                    scrollableContainer = $(window);\n                }\n\n                function setColumnHeaderSizes() {\n                    if (clonedHeader.is('tr') || clonedHeader.is('thead')) {\n                        var clonedColumns = clonedHeader.find('th');\n                        header.find('th').each(function(index, column) {\n                            var clonedColumn = $(clonedColumns[index]);\n                            clonedColumn.css('width', column.offsetWidth + 'px');\n                        });\n                    }\n                };\n\n                function determineVisibility() {\n                    var scrollTop = scrollableContainer.scrollTop() + scope.scrollStop;\n                    var currentContent = getContent();\n                    if (currentContent.length !== 1) {\n                        return;\n                    }\n                    var contentTop = currentContent.offset().top;\n                    var contentBottom = contentTop + currentContent.outerHeight(false);\n\n                    if ((scrollTop > contentTop) && (scrollTop < contentBottom)) {\n                        if (!clonedHeader) {\n                            createClone();\n                            clonedHeader.css({\n                                \"visibility\": \"visible\"\n                            });\n                        }\n\n                        if (scrollTop < contentBottom && scrollTop > contentBottom - clonedHeader.outerHeight(false)) {\n                            var top = contentBottom - scrollTop + scope.scrollStop - clonedHeader.outerHeight(false);\n                            clonedHeader.css('top', top + 'px');\n                        } else {\n                            calculateSize();\n                        }\n                    } else {\n                        if (clonedHeader) {\n                            /*\n                             * remove cloned element (switched places with original on creation)\n                             */\n                            header.remove();\n                            header = clonedHeader;\n                            clonedHeader = null;\n\n                            header.removeClass('fsm-sticky-header');\n                            header.css({\n                                position: 'relative',\n                                left: 0,\n                                top: 0,\n                                width: 'auto',\n                                'z-index': 0,\n                                visibility: 'visible'\n                            });\n                        }\n                    }\n                };\n\n                function calculateSize() {\n                    clonedHeader.css({\n                        top: scope.scrollStop,\n                        width: header.outerWidth(),\n                        left: header.offset().left\n                    });\n\n                    setColumnHeaderSizes();\n                };\n\n                function createClone() {\n                    /*\n                     * switch place with cloned element, to keep binding intact\n                     */\n                    $rootScope.$broadcast('header-clone', scope.scrollObject);\n                    clonedHeader = header;\n                    header = clonedHeader.clone();\n                    clonedHeader.after(header);\n                    clonedHeader.addClass('fsm-sticky-header');\n                    clonedHeader.css({\n                        position: 'fixed',\n                        'z-index': scope.zIndexOverride,\n                        visibility: 'hidden'\n                    });\n                    calculateSize();\n                };\n\n                scrollableContainer.on('scroll.fsmStickyHeader', determineVisibility).trigger(\"scroll\");\n                scrollableContainer.on('resize.fsmStickyHeader', determineVisibility);\n\n                scope.$on('$destroy', function() {\n                    scrollableContainer.off('.fsmStickyHeader');\n                });\n            }\n        };\n    }]);\n\n    fsm.directive('fsmMenu', ['$location', function($location) {\n        return {\n            restrict: 'A',\n            scope: {},\n            link: function(scope, el, attrs) {\n                var navigationMenu = angular.element(el);\n                var menuTitles = navigationMenu.find('.fsm-menu-title');\n                var menuItems = navigationMenu.find('[tc-menu-item]:visible');\n                var activeMenu = 0;\n\n                function menuOnClick(e) {\n                    var menuTitle = angular.element(e.currentTarget);\n                    // Find if our menu item has submenu items\n                    var submenu = menuTitle.next('.fsm-sub-menu');\n\n                    // If there is submenus, then we wan to either open or close the folder\n                    submenu.slideToggle('fast', function() {\n                        // swap the arrow from up to down, or vise-versa\n                        var chevron = menuTitle.children('[class*=\\'fa-chevron\\']');\n                        chevron.toggleClass('fa-chevron-down fa-chevron-up');\n\n                        // Find the list of currently visible menu items for keyboarding through.\n                        menuItems = navigationMenu.find('[tc-menu-item]:visible');\n                    });\n\n                }\n\n                function menuOnKeydown(e) {\n                    activeMenu = getCurrentMenuItem();\n\n                    if (e.keyCode === 9) {\n                        tabOutOfMenu(e);\n                    } else if (e.keyCode === 13 || e.keyCode === 37 || e.keyCode === 39) {\n                        triggerMenuItem(e);\n                    } else if (e.keyCode === 38 || e.keyCode === 40) {\n                        highlightMenuItem(e);\n                    }\n                }\n\n                function tabOutOfMenu(e) {\n                    if (e.shiftKey) {\n                        $('[fsm-menu-button]').focus();\n                    } else {\n                        var firstTabItem = $('[tabindex=1]');\n\n                        if (firstTabItem.length == 0) {\n                            return;\n                        } else {\n                            firstTabItem.focus();\n                        }\n                    }\n\n                    e.preventDefault();\n                    e.stopPropagation();\n                }\n\n                function triggerMenuItem(e) {\n                    e.currentTarget = $(menuItems[activeMenu]).children('a').first();\n                    menuOnClick(e);\n                }\n\n                function highlightMenuItem(e) {\n                    e.preventDefault();\n                    e.stopPropagation();\n\n                    if (e.keyCode === 38) {\n                        if (activeMenu > 0) {\n                            $(menuItems[activeMenu - 1]).children('a').first().focus();\n                        } else {\n                            $(menuItems[menuItems.length - 1]).children('a').first().focus();\n                        }\n                    } else if (e.keyCode === 40) {\n                        if (activeMenu < (menuItems.length - 1)) {\n                            $(menuItems[activeMenu + 1]).children('a').first().focus();\n                        } else {\n                            $(menuItems[0]).children('a').first().focus();\n                        }\n                    }\n                }\n\n                function getCurrentMenuItem() {\n                    var focusedMenu = navigationMenu.find(':focus');\n\n                    if (focusedMenu.length === 1) {\n                        return menuItems.index(focusedMenu.parent('[tc-menu-item]').first());\n                    }\n\n                    return menuItems.index(navigationMenu.find('[tc-menu-item].active').first());\n                }\n\n                function menuOnFocus(e) {\n                    e.preventDefault();\n                    e.stopPropagation();\n\n                    activeMenu = getCurrentMenuItem();\n                    $(menuItems[activeMenu]).children('a').first().focus();\n                }\n\n                menuTitles.click(menuOnClick);\n                navigationMenu.keydown(menuOnKeydown);\n                navigationMenu.focus(menuOnFocus);\n\n                scope.$watch(function() {\n                    return $location.path();\n                }, function(path) {\n                    // grab all the a tags that start with #, indicating and angular route.\n                    var allMenuItems = el.find('a[href^=\\'#\\']');\n\n                    angular.forEach(allMenuItems, function(menuItem) {\n                        var menu = angular.element(menuItem);\n                        var link = menu.attr('href').split('#')[1];\n\n                        if (path.indexOf(link) == 0) {\n                            // activate the menu item\n                            angular.element(menuItem.parentElement).addClass('active');\n\n                            // open up the submenus if they are not open\n                            var submenus = menu.parents('.fsm-sub-menu');\n                            submenus.show();\n\n                            // turn the chevrons up on the menu titles\n                            var chevrons = submenus.prev().children('[class*=\\'fa-chevron\\']');\n                            chevrons.removeClass('fa-chevron-down');\n                            chevrons.addClass('fa-chevron-up');\n                        } else {\n                            angular.element(menuItem.parentElement).removeClass('active');\n                        }\n                    });\n\n                    menuItems = navigationMenu.find('[tc-menu-item]:visible');\n                });\n            }\n        }\n    }]);\n\n    fsm.directive('fsmMenuButton', function() {\n        return {\n            restrict: 'EA',\n            replace: false,\n            scope: {},\n            link: function(scope, element, attributes, control) {\n                var menuButton = $(element, this);\n\n                menuButton.addClass('fsm-menu-button');\n                menuButton.keydown(menuOnKeydown);\n                $('body').keydown(bodyOnKeydown);\n\n                function bodyOnKeydown(e) {\n                    if (e.keyCode === 77 && e.ctrlKey && e.altKey) {\n                        if (isMenuClosed()) {\n                            menuOnClick();\n                        }\n                        $('[fsm-menu]').focus();\n                    } else if (e.keyCode === 77 && e.ctrlKey) {\n                        menuButton.focus();\n                        menuOnClick();\n                    }\n                }\n\n                function isMenuClosed() {\n                    return $('body').hasClass('fsm-menu-toggle');\n                }\n\n                function menuOnClick() {\n                    $('body').toggleClass('fsm-menu-toggle');\n                    setMenuSpin();\n                    setTimeout(setMenuSpin, 50);\n                };\n\n                function menuOnKeydown(e) {\n                    if (e.keyCode === 32 || e.keyCode === 13) {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        menuOnClick();\n                    }\n                }\n\n                function setMenuSpin() {\n                    menuButton.find('.fsm-menu-button-open').toggleClass('fsm-spin-forward');\n                    menuButton.find('.fsm-menu-button-close').toggleClass('fsm-spin-backward');\n                };\n\n                menuButton.on('click.fsmMenuButton', menuOnClick);\n\n                scope.$on('$destroy', function() {\n                    menuButton.off('.fsmMenuButton');\n                });\n            }\n        }\n    });\n\n    fsm.directive('fsmBigData', ['$filter', function($filter) {\n\n        return {\n            restrict: 'AE',\n            scope: {},\n            replace: false,\n            transclude: true,\n            link: function(scope, element, attrs, controller, transclude) {\n                var orderBy = $filter('orderBy');\n                var currentPage = 0;\n                var pagedDataName = attrs.fsmBigData.split(' of ')[0];\n                var rightHandExpression = attrs.fsmBigData.split(' of ')[1];\n                var pageSize = parseInt(rightHandExpression.split(' take ')[1], 10);\n                var sourceData = rightHandExpression.split(' take ')[0];\n\n                // Interesting things can be done here with the source object...\n                // var displayGetter = $parse(sourceData);\n                // var displaySetter = displayGetter.assign;\n                // var results = orderBy(displayGetter(scope.$parent), sortColumns);\n                // displaySetter(scope.$parent, results)\n\n                var rawData = [];\n                var sortedData = [];\n                var pagedData = [];\n                var page = $(window);\n                var sortTypes = ['None', 'Ascending', 'Descending'];\n                var sortColumns = [];\n\n                transclude(function(clone, transcludedScope) {\n\n                    transcludedScope.sortTypes = sortTypes;\n\n                    element.append(clone);\n                    transcludedScope[pagedDataName] = pagedData;\n\n                    function nextPage() {\n                        var dataSlice = sortedData.slice(pageSize * currentPage, (pageSize * (currentPage + 1)));\n                        if (dataSlice.length > 0) {\n                            pagedData.push.apply(pagedData, dataSlice);\n                            currentPage++;\n                        }\n                    }\n\n                    function renderData() {\n                        if (sortColumns.length) {\n                            sortedData = orderBy(rawData, sortColumns);\n                        } else {\n                            sortedData = rawData;\n                        }\n\n                        pagedData.length = 0;\n                        currentPage = 0;\n                        nextPage();\n                    }\n\n                    function addSortColumn(columnName, sortType) {\n\n                        // If this column is currently in the sort stack, remove it.\n                        for (var i = 0; i < sortColumns.length; i++) {\n                            if (sortColumns[i].indexOf(columnName) > -1) {\n                                sortColumns.splice(i, 1);\n                            }\n                        }\n\n                        // Push this sort on the top of the stack (aka. array)\n                        if (sortType > 0) {\n                            var direction = '';\n                            if (sortTypes[sortType] === 'Descending') {\n                                direction = '-';\n                            }\n                            sortColumns.unshift(direction + columnName);\n                        }\n\n                        renderData();\n                    }\n\n                    function onPageScroll() {\n                        var s = $(window).scrollTop();\n                        var d = $(document).height();\n                        var c = $(window).height();\n                        var scrollPercent = (s / (d - c));\n\n                        if (scrollPercent > 0.98) {\n                            // We use scope.apply here to tell angular about these changes because \n                            // they happen outside of angularjs context... we're using jquery here\n                            // to figure out when we need to load another page of data.\n                            transcludedScope.$apply(nextPage);\n                        }\n                    }\n\n                    transcludedScope.$parent.$watchCollection(sourceData, function(newData) {\n                        if (newData) {\n                            rawData = newData;\n                            renderData();\n                        }\n                    });\n\n                    transcludedScope.addSortColumn = addSortColumn;\n\n                    page.on('scroll.fsmBigData', onPageScroll).trigger('scroll');\n\n                    transcludedScope.$on('$destroy', function() {\n                        page.off('.fsmBigData');\n                    });\n                });\n            }\n        };\n    }]);\n\n    fsm.directive('fsmSort', [function() {\n        var sortIconTemplate = '<i class=\"fa fa-sort\"></i>';\n\n        return {\n            restrict: 'AE',\n            replace: false,\n            scope: {},\n            link: function(scope, element, attrs) {\n                var columnHeader = element;\n                var columnName = attrs.fsmSort;\n                var sortIcon = angular.element(sortIconTemplate);\n                columnHeader.append('&nbsp;');\n                columnHeader.append(sortIcon);\n                var currentSortType = 0;\n\n                function swapIcons() {\n                    sortIcon.removeClass('fa-sort-desc fa-sort-asc fa-sort');\n\n                    var classToAdd = 'fa-sort';\n\n                    if (scope.$parent.sortTypes[currentSortType] === 'Ascending') {\n                        classToAdd = 'fa-sort-asc';\n                    } else if (scope.$parent.sortTypes[currentSortType] === 'Descending') {\n                        classToAdd = 'fa-sort-desc';\n                    }\n\n                    sortIcon.addClass(classToAdd);\n                };\n\n                function applySort() {\n                    // Find the kind of sort this should now be\n                    currentSortType++;\n                    if (currentSortType == scope.$parent.sortTypes.length) {\n                        currentSortType = 0;\n                    }\n\n                    scope.$apply(scope.$parent.addSortColumn(columnName, currentSortType));\n\n                    swapIcons();\n                };\n\n                columnHeader.css({\n                    cursor: 'pointer'\n                });\n\n                columnHeader.on('click.fsmSort', applySort);\n\n                columnHeader.on('keydown.fsmSort', function(e) {\n                    if (e.keyCode === 13) {\n                        applySort();\n                        e.preventDefault();\n                        e.stopPropagation();\n                    }\n                });\n\n                scope.$on('$destroy', function() {\n                    columnHeader.off('.fsmSort');\n                });\n            }\n        };\n    }]);\n})(window.angular);\n'use strict';\n\n/**\n * @ngdoc directive\n * @name troutDashApp.directive:speciesSummary\n * @description\n * # speciesSummary\n */\nangular.module('troutSpotr')\n  .directive('speciesSummary', function() {\n    return {\n      templateUrl: 'app/ui/speciesSummary/speciessummarytemplate.html',\n      restrict: 'A',\n      link: function postLink(scope, element, attrs) {}\n    };\n  });\n'use strict';\n\n/**\n * @ngdoc directive\n * @name troutDashApp.directive:restrictionLegend\n * @description\n * # restrictionLegend\n */\nangular.module('troutSpotr')\n  .directive('restrictionLegend', function () {\n    return {\n      templateUrl: 'app/ui/restrictions/restrictionlegendtemplate.html',\n      restrict: 'A',\n      link: function postLink(scope, element, attrs) {\n      \tconsole.log('restrictionlegend directive', scope.stream);\n      }\n    };\n  });\n\n(function() {\n\t'use strict';\n\n\t/**\n\t * @ngdoc function\n\t * @name troutDashApp.controller:StreamlistcontrollerCtrl\n\t * @description\n\t * # StreamlistcontrollerCtrl\n\t * Controller of the troutDashApp\n\t */\n\tangular.module('troutSpotr')\n\t\t.controller('MainController', ['$scope', 'StreamApiService',\n\t\t\t'TableOfContentsRepository', 'RegionGeometryService',\n\t\t\t'$anchorScroll',\n\t\t\tfunction($scope, StreamApiService, TableOfContentsRepository, RegionGeometryService, $anchorScroll) {\n\t\t\t\t$scope.isSmallView = true;\n\t\t\t\tvar getInitialMapState = function() {\n\t\t\t\t\tvar mapState = {\n\t\t\t\t\t\tisExpanded: false,\n\t\t\t\t\t\tisLoading: false,\n\t\t\t\t\t\tselectedRegionGeometry: null,\n\t\t\t\t\t\tselectedRegion: null,\n\t\t\t\t\t\tselectedCounty: null,\n\t\t\t\t\t\thighlightedStream: null,\n\t\t\t\t\t\tcurrentClientCoordinates: [NaN, NaN]\n\t\t\t\t\t};\n\t\t\t\t\treturn mapState;\n\t\t\t\t};\n\n\t\t\t\t$scope.mapState = getInitialMapState();\n\n\t\t\t\t$scope.selectCounty = function(countyId) {\n\t\t\t\t\tconsole.log(countyId);\n\t\t\t\t};\n\n\t\t\t\t$scope.selectRegion = function(regionModel) {\n\t\t\t\t\tif (regionModel == null) {\n\t\t\t\t\t\tthrow new Error('regionModel cannot be null');\n\t\t\t\t\t}\n\n\n\n\t\t\t\t\t// TODO: fix this to have an actual cache.\n\t\t\t\t\t// try to pull it from the cache\n\t\t\t\t\tvar canRetrieveFromCache = false;\n\t\t\t\t\tif (canRetrieveFromCache) {\n\t\t\t\t\t\t// return it from our cache.\n\t\t\t\t\t\t// TODO: fix this part too\n\t\t\t\t\t\t$scope.mapState.selectedRegionGeometry = null;\n\t\t\t\t\t\t$scope.mapState.selectedRegion = [regionModel];\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// load it from our repository.\n\t\t\t\t\tvar stateModel = regionModel.parent;\n\t\t\t\t\treturn RegionGeometryService.getRegion(stateModel, regionModel)\n\t\t\t\t\t\t.then(function(newSelectedRegionGeometry) {\n\t\t\t\t\t\t\t$scope.mapState.selectedRegionGeometry = [newSelectedRegionGeometry];\n\t\t\t\t\t\t\t$scope.mapState.selectedRegion = [regionModel];\n\t\t\t\t\t\t\t$anchorScroll('region-hdr_' + regionModel.id);\n\t\t\t\t\t\t\treturn newSelectedRegionGeometry;\n\t\t\t\t\t\t});\n\t\t\t\t};\n\n\t\t\t\t$scope.getTableOfContents = function() {\n\t\t\t\t\treturn TableOfContentsRepository.getTableOfContents()\n\t\t\t\t\t\t.then(function(toc) {\n\t\t\t\t\t\t\treturn toc;\n\t\t\t\t\t\t});\n\t\t\t\t};\n\n\t\t\t\t$scope.bustCache = function() {\n\t\t\t\t\tconsole.log('busting cache...');\n\t\t\t\t\t// this is actually going directly to the base cache...\n\t\t\t\t\tTableOfContentsRepository.bustTableOfContentsCache();\n\t\t\t\t};\n\n\t\t\t\t$scope.toggleMinimap = function() {\n\t\t\t\t\tif ($scope.mapState == null) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t$scope.mapState.isExpanded = !$scope.mapState.isExpanded;\n\t\t\t\t};\n\t\t\t}\n\t\t]);\n\n})();\n'use strict';\n\n/**\n * @ngdoc directive\n * @name troutDashApp.directive:miniMapDirective\n * @description\n * # miniMapDirective\n */\n\nvar MINI_MAP_CLASS = '.js-mini-map';\n\nangular.module('troutSpotr')\n  .directive('miniMapDirective', [\n    '$rootScope', 'GeometryApiService', '$q', '$timeout',\n    function($rootScope, GeometryApiService, $q, $timeout) {\n      return {\n        // app/ui/main/main.html\n        templateUrl: 'app/ui/miniMap/minimaptemplate.html',\n        restrict: 'A',\n        link: function postLink(scope, element, attrs) {\n          scope.minimapState = {\n            isLoading: true,\n            regionGeometries: null,\n            selectedRegionId: null,\n            selectedCountyId: null,\n            width: 75,\n            height: 45,\n            isMacro: true,\n\n            loadingRegion: d3.select(null)\n          };\n\n          scope.active = d3.select(null);\n          scope.selectedCounty = d3.select(null);\n\n          $rootScope.$on('county-select', function(event, item) {\n            console.log(item);\n\n          });\n\n          $rootScope.$on('header-clone', function(event, item) {\n            if (item == null) {\n              return;\n            }\n\n            if (item.type === 'region') {\n              $timeout(function() {\n                scope.minimapState.selectedRegionId = item.id;\n                scope.$apply();\n              });\n            }\n\n            if (item.type === 'county') {\n              $timeout(function() {\n                scope.minimapState.selectedCountyId = item.name;\n                scope.$apply();\n              });\n            }\n          });\n\n          var unwatchRegionId = scope.$watch(function() {\n            return scope.minimapState.selectedRegionId;\n          }, function(newRegionId, oldRegionId) {\n            if (newRegionId == null) {\n              return;\n            }\n\n            if (newRegionId === oldRegionId) {\n              return;\n            }\n            // console.log('new region!', newRegionId);\n\n            var soughtRegion = scope.currentRegions.filter(function(f) {\n              return f.id === newRegionId;\n            });\n\n            if (soughtRegion.length > 0 && newRegionId !== oldRegionId) {\n              zoomToGeometry(soughtRegion[0]);\n            }\n\n          });\n\n          var unwatchCountyId = scope.$watch(function() {\n            return scope.minimapState.selectedCountyId;\n          }, function(newCounty, oldCounty) {\n            if (newCounty == null) {\n              return;\n            }\n\n            // console.log('new County!', newCounty);\n            var soughtCounty = scope.currentCounties.filter(function(f) {\n              return f.name === newCounty;\n            });\n            if (soughtCounty.length > 0 && newCounty !== oldCounty) {\n              selectCounty(soughtCounty[0]);\n            }\n          });\n\n          var unwatchGeometries = scope.$watch(function() {\n            return scope.minimapState.regionGeometries;\n          }, function(newGeometries, oldGeometries) {\n            if (newGeometries == null) {\n              return;\n            }\n\n            console.log('new Geometries!', newGeometries);\n            drawGeometries(newGeometries);\n          });\n\n          var drawGeometries = function(geometries) {\n            var root = d3.select(element[0]);\n            console.log(root);\n          };\n\n          var highlightCounty = function(countyId) {\n            console.log('highlight county');\n          };\n\n          var zoomToRegion = function(regionId) {\n            console.log('zoom to region');\n          };\n\n          // var gettingGeometries = GeometryApiService.getRegionGeometries();\n          // var gettingRegionData = StreamApiService.getRegions();\n\n          // This function takes geometry and will create a geometry and path\n          // function that are centred on this geometry.\n          var initializeMap = function(stateObject) {\n            // initialize a unit projection.\n            scope.projection = d3.geo.albersUsa()\n              .scale(1)\n              .translate([0, 0]);\n\n            // Create a path generator.\n            scope.path = d3.geo.path()\n              .projection(scope.projection)\n              .pointRadius(0.15);\n\n            var state = stateObject.geometry;\n\n            // Compute the bounds of a feature of interest, then derive scale & translate.\n            var b = scope.path.bounds(state),\n              s = 0.95 / Math.max((b[1][0] - b[0][0]) / scope.minimapState.width, (b[1][1] - b[0][1]) / scope.minimapState.height),\n              t = [(scope.minimapState.width - s * (b[1][0] + b[0][0])) / 2, (scope.minimapState.height - s * (b[1][1] + b[0][1])) / 2];\n\n            // Update the projection to use computed scale & translate.\n            scope.projection\n              .scale(s)\n              .translate(t);\n\n            scope.zoom = d3.behavior.zoom()\n              .translate([0, 0])\n              .scale(1)\n              .scaleExtent([1, 8])\n              .size([scope.minimapState.width, scope.minimapState.height])\n              .on('zoom', zoomed);\n\n            scope.svg = d3.select(element[0]).select(MINI_MAP_CLASS)\n              .append('svg')\n              .attr('viewBox', '0 0 ' + scope.minimapState.width + ' ' + scope.minimapState.height)\n              .attr('preserveAspectRatio', 'xMinYMin meet')\n              .attr('class', 'minimap-root')\n              .on('click', stopped, true);\n\n            scope.root = scope.svg.append('g')\n              .attr('class', 'minimap-geography');\n\n            scope.root.append('rect')\n              .attr('class', 'minimap-geography_background')\n              .attr('width', '100%')\n              .attr('height', '100%')\n              .on('click', onBackgroundClick);\n\n            scope.counties = scope.root.append('g')\n              .attr('class', 'minimap-geography minimap-geogrpahy_counties');\n\n            scope.states = scope.root.append('g')\n              .attr('class', 'minimap-geography minimap-geogrpahy_states');\n\n            scope.streams = scope.root.append('g')\n              .attr('class', 'minimap-geography minimap-geogrpahy_streams');\n\n            scope.regions = scope.root.append('g')\n              .attr('class', 'minimap-geography minimap-geogrpahy_regions');\n          };\n\n          var onRegionClick = function(region, regionId) {\n            var isMacro = scope.minimapState.isMacro;\n            if (isMacro) {\n              // assume selection has occured.\n              // set loading state on region.\n              onLoadRegion.bind(this)(region);\n              scope.minimapState.selectedRegionId = region.id;\n              scope.selectRegion(region)\n                .then(function(geometry) {\n                  $timeout(function() {\n\n                    resetLoadRegion();\n                    // set controller's state\n                    $timeout(minifyMinimap, 500);\n                  }, 1000);\n\n                });\n\n              // TODO: remove the minification.\n            } else {\n              macrofyMinimap();\n            }\n\n            $timeout(function() {\n              scope.$apply();\n            });\n          };\n\n          var onBackgroundClick = function() {\n            var isMacroMode = scope.minimapState.isMacro;\n            console.log(isMacroMode);\n            if (isMacroMode) {\n              // TODO: reset state\n              // TODO: set to minify\n\n              minifyMinimap();\n\n            } else {\n              // TODO: set state to outer.\n              macrofyMinimap();\n            }\n\n            $timeout(function() {\n              scope.$apply();\n            });\n\n          };\n\n          var minifyMinimap = function() {\n            scope.minimapState.isMacro = false;\n          };\n\n          var macrofyMinimap = function() {\n            scope.minimapState.isMacro = true;\n            reset();\n          };\n\n          var drawGeometryToMap = function(states, regions, counties) {\n            // scope.countiesGroup = scope.counties;\n            scope.counties.selectAll('path.minimap-geography_county')\n              .data(counties, function(d) {\n                return d.id;\n              })\n              .enter().append('path')\n              .attr('d', function(d) {\n                return scope.path(d.geometry);\n              })\n              .attr('data-id', function(d) {\n                return getFipsCodeSelector(d);\n              })\n              .attr('class', 'minimap-geography_county');\n\n            scope.regions.selectAll('path.minimap-geogrpahy_region')\n              .data(regions, function(d) {\n                return d.id;\n              })\n              .enter().append('path')\n\n            .attr('class', 'minimap-geogrpahy_region')\n              .attr('data-id', function(d) {\n                return d.id;\n              })\n              .attr('id', function(d) {\n                return 'region_' + d.id;\n              })\n              .attr('data-name', function(d) {\n                return d.shortName;\n              })\n              .attr('d', function(d) {\n                return scope.path(d.geometry);\n              })\n              .on('click', onRegionClick);\n          };\n\n          function reset() {\n            console.log('reset!');\n\n            scope.active.classed('active', false);\n            scope.active = d3.select(null);\n\n            scope.svg.transition()\n              .duration(300)\n              .call(scope.zoom.translate([0, 0]).scale(1).event);\n          }\n\n          function zoomed() {\n            scope.root.style('stroke-width', 1.5 / d3.event.scale + 'px');\n            scope.root.attr('transform', 'translate(' + d3.event.translate + ')scale(' + d3.event.scale + ')');\n          }\n\n          function onLoadRegion(regionElement) {\n            resetLoadRegion();\n            scope.minimapState.loadingRegion = d3.select(this).classed('minimap-geogrpahy_region_loading', true);\n            // show streams.\n            var arrayOfStreams = regionElement.children.map(function(county) {\n              return county.children;\n            });\n\n            var selectedStreams = _.unique(_.flatten(arrayOfStreams), 'Id');\n\n\n            var streamObjects = scope.streams.selectAll('path.minimap-geography_stream')\n              .data(selectedStreams, function(d) {\n                return d.Id;\n              });\n            streamObjects.enter()\n              .append('path')\n              .attr('class', 'minimap-geography_stream')\n              .attr('data-id', function(d) {\n                return d.id;\n              })\n              .attr('id', function(d) {\n                return 'streamPoint_' + d.id;\n              })\n              .attr('data-name', function(d) {\n                return d.name;\n              })\n              .attr('d', function(d) {\n                return scope.path(d.geometry);\n              })\n              .style('opacity', 0)\n              .transition()\n              .delay(200)\n              .duration(750)\n              .style('opacity', 1);\n\n            streamObjects.exit()\n              .transition()\n              .duration(300)\n              .style('opacity', 0)\n              .remove();\n\n          }\n\n          function resetLoadRegion() {\n            if (scope.minimapState.loadingRegion == null) {\n              return;\n            }\n\n            scope.minimapState.loadingRegion.classed('minimap-geogrpahy_region_loading', false);\n            scope.minimapState.loadingRegion = d3.select(null);\n          }\n\n          function zoomToGeometry(d) {\n            if (scope.active.node() === this) return reset();\n            scope.active.classed('active', false);\n            scope.active = d3.select(this).classed('active', true);\n\n            var bounds = scope.path.bounds(d.geometry),\n              dx = bounds[1][0] - bounds[0][0],\n              dy = bounds[1][1] - bounds[0][1],\n              x = (bounds[0][0] + bounds[1][0]) / 2,\n              y = (bounds[0][1] + bounds[1][1]) / 2,\n              scale = 0.95 / Math.max(dx / scope.minimapState.width, dy / scope.minimapState.height),\n              translate = [scope.minimapState.width / 2 - scale * x, scope.minimapState.height / 2 - scale * y];\n\n            scope.svg.transition()\n              .delay(200)\n              .duration(750)\n              .call(scope.zoom.translate(translate).scale(scale).event);\n          }\n\n          function getFipsCode(countyFeature) {\n            if (countyFeature == null) {\n              return '';\n            }\n\n            var fips = countyFeature.statefp + countyFeature.countyfp;\n            return fips;\n          }\n\n          function getFipsCodeSelector(countyFeature) {\n            return 'county_' + getFipsCode(countyFeature);\n          }\n\n          function selectCounty(d) {\n            var fips = getFipsCodeSelector(d);\n            var attribute = '[data-id=' + fips + ']';\n            var t = scope.counties.select(attribute).node();\n            if (scope.selectedCounty.node() === t) {\n              return;\n            }\n\n            scope.selectedCounty.classed('active', false);\n            scope.selectedCounty = d3.select(t).classed('active', true);\n          }\n\n          function stopped() {\n            if (d3.event.defaultPrevented) d3.event.stopPropagation();\n          }\n\n          scope.getTableOfContents()\n            .then(function(toc) {\n              console.log('minimap got toc');\n\n              var states = _.map(toc);\n              var regions = _(states)\n                .pluck('children')\n                .flatten()\n                .value();\n\n              var counties = _(regions)\n                .pluck('children')\n                .flatten()\n                .value();\n\n              scope.currentState = states[0];\n              scope.currentCounties = counties;\n              scope.currentRegions = regions;\n\n              var minStreamCount = 0;\n              var countyStreamCounts = scope.currentCounties.map(function(feat) {\n                return Math.max(0, feat.stream_count);\n              });\n              var maxStreamCount = d3.max(countyStreamCounts);\n\n              scope.countyChoroplethScale = d3.scale.linear()\n                .domain([minStreamCount, maxStreamCount])\n                .range(['#FFFFBB', '#BB00CC']);\n\n\n              scope.minimapState.isLoading = false;\n              initializeMap(scope.currentState);\n              drawGeometryToMap(states, regions, counties);\n\n            });\n\n          scope.$on('$destroy', function() {\n            unwatchRegionId();\n            unwatchCountyId();\n            unwatchGeometries();\n            unwatchTableOfContents();\n          });\n        }\n      };\n    }\n  ]);\nangular.module('troutSpotr')\n  .factory('RectangleLayoutService', [function() {\n    'use strict';\n\n    function RectangleLayoutService(width, height) {\n      this.width = width;\n      this.height = height;\n    }\n\n    var proto = RectangleLayoutService.prototype;\n\n    function getScale(width, height, itemLength) {\n      return Math.sqrt(itemLength / (width * height));\n    }\n\n    function getXGivenY(width, height, y) {\n      return (width / height) * y;\n    }\n\n    function getYGivenX(width, height, x) {\n      return (height / width) * x;\n    }\n\n    function pythagoreanTheorem(x, y) {\n      return Math.sqrt((x * x) + (y * y));\n    }\n\n    proto.getBoundingBox = function (numberOfItems) {\n      if (numberOfItems === 1) {\n        return [1, 1];\n      }\n\n      var scale = getScale(this.width, this.height, numberOfItems);\n      var minimumXPosition = this.width * scale;\n      var minimumYPosition = this.height * scale;\n\n      var xPrime = Math.ceil(minimumXPosition);\n      var yPrime = Math.ceil(minimumYPosition);\n\n      var newYLength = getYGivenX(this.width, this.height, xPrime);\n      var yZLength = pythagoreanTheorem(xPrime, newYLength);\n\n      var newXLength = getXGivenY(this.width, this.height, yPrime);\n      var xZLength = pythagoreanTheorem(newXLength, yPrime);\n\n      var candidate = function() {\n        if (xZLength > yZLength) {\n          return [xPrime, Math.floor(minimumYPosition)];\n        } else if (yZLength > xZLength) {\n          return [Math.floor(minimumXPosition), yPrime];\n        }\n        return [Math.ceil(minimumXPosition), Math.ceil(minimumYPosition)];\n      };\n\n      var result = candidate();\n      if (result[0] * result[1] < numberOfItems) {\n        return [xPrime, yPrime];\n      }\n      return result;\n    };\n\n    \n    return RectangleLayoutService;\n  }]);\nangular.module('troutSpotr')\n  .directive('accessPointSummaryTally', ['RectangleLayoutService', function(RectangleLayoutService) {\n    'use strict';\n    return {\n      templateUrl: 'app/ui/accessPointSummary/AccessPointSummaryTallyTemplate.html',\n      restrict: 'A',\n      link: function postLink(scope , element/*, attrs*/ ) {\n        var ROOT_CLASS = '.js-tally-root';\n        var WIDTH = 32;\n        var HEIGHT = 24;\n\n        var troutStreamIntersections = scope.stream.AccessPoints.filter(function(i) {\n          return i.IsOverOrNearTroutStreamSection;\n        }).sort(function(a) {\n          return a.IsOverOrNearPublicLand ? -100 : 100;\n        });\n        scope.denominator = troutStreamIntersections.length;\n        var publicTroutStreamIntersections = troutStreamIntersections.filter(function(i) {\n          return i.IsOverOrNearPublicLand;\n        });\n        scope.numerator = publicTroutStreamIntersections.length;\n        scope.rows = Math.ceil(Math.sqrt(scope.denominator));\n        if (scope.rows === 0) {\n          return;\n        }\n\n        // if (scope.rows > 3) { debugger};\n\n        var generator = new RectangleLayoutService(3, 2);\n        var dimensions = generator.getBoundingBox(scope.denominator);\n        console.log(dimensions, scope.denominator);\n        var numberOfColumns = dimensions[0];\n        var numberOfRows = dimensions[1];\n\n        var boxWidth = 3;\n\n        var widthOfContainer = numberOfColumns * boxWidth;\n        var heightOfContainer = numberOfRows * boxWidth;\n\n        var offset = [(WIDTH - widthOfContainer) * 0.5, (HEIGHT - heightOfContainer) * 0.5];\n        scope.root = d3.select(element[0]).select(ROOT_CLASS);\n        scope.container = scope.root.append('g')\n          .attr('class', 'access-points')\n          .attr('transform', 'translate(' + offset[0] + ', ' + offset[1] + ')');\n\n        scope.container.selectAll('circle')\n          .data(troutStreamIntersections)\n          .enter()\n          .append('circle')\n          .attr('data-length', scope.denominator)\n          .attr('data-width', numberOfColumns)\n          .attr('data-height', numberOfRows)\n          .attr('cx', function(d, index) {\n            var xPosition = ((index % numberOfColumns) * (boxWidth * 1.0));\n            // console.log(xPosition);\n            return xPosition;\n          })\n          .attr('cy', function(d, index) {\n            var yPosition = Math.floor(index / numberOfColumns) * (boxWidth * 1.0);\n            return yPosition;\n          })\n          .attr('r', boxWidth * 0.5)\n          .attr('class', function(d) {\n            return d.IsOverOrNearPublicLand ? 'numerator' : 'denominator';\n          });\n\n\n      }\n    };\n  }]);\nangular.module('troutSpotr')\n  .directive('accessPointSummary', [function() {\n    'use strict';\n    return {\n      templateUrl: 'app/ui/accessPointSummary/AccessPointSummaryTemplate.html',\n      restrict: 'A',\n      link: function postLink(scope /*, element, attrs*/ ) {\n        var troutStreamIntersections = scope.stream.AccessPoints.filter(function(i) {\n          return i.IsOverOrNearTroutStreamSection;\n        });\n        scope.denominator = troutStreamIntersections.length;\n        var publicTroutStreamIntersections = troutStreamIntersections.filter(function(i) {\n          return i.IsOverOrNearPublicLand;\n        });\n        scope.numerator = publicTroutStreamIntersections.length;\n      }\n    };\n  }]);\n\n/**\n * @ngdoc service\n * @name troutDashApp.TableOfContentsRepository\n * @description\n * # TableOfContentsRepository\n * Factory in the troutDashApp.\n */\nangular.module('troutSpotr')\n    .factory('TableOfContentsRepository', ['BaseApiService', 'RegionGeometryService', 'HierarchicalGeometryViewModel',\n        function(BaseApiService, RegionGeometryService, HierarchicalGeometryViewModel) {\n            'use strict';\n            var TABLE_OF_CONTENTS_CACHE_KEY = 'tableOfContents';\n            var COUNTIES_CACHE_KEY = 'counties';\n            var REGIONS_CACHE_KEY = 'regions';\n            var TableOfContentsRepository = function() {\n                BaseApiService.call(this);\n                this.logCache();\n            };\n\n            var proto = TableOfContentsRepository.prototype = Object.create(BaseApiService.prototype);\n\n            proto.bustTableOfContentsCache = function() {\n                var key = TABLE_OF_CONTENTS_CACHE_KEY;\n                this.cache.remove(TABLE_OF_CONTENTS_CACHE_KEY);\n            };\n\n            proto.getTableOfContents = function() {\n                var key = TABLE_OF_CONTENTS_CACHE_KEY;\n                if (this.cache.get(key)) {\n                    console.log('found in cache');\n                    return this.cache.get(key);\n                }\n\n                var promise = this.doCall({}, 'assets/data/tableOfContents.topo.json')\n                    .then(function(regionTopoJson) {\n                        var state = topojson.feature(regionTopoJson, regionTopoJson.objects.state);\n                        var regions = topojson.feature(regionTopoJson, regionTopoJson.objects.region);\n                        var counties = topojson.feature(regionTopoJson, regionTopoJson.objects.county);\n                        var streams = topojson.feature(regionTopoJson, regionTopoJson.objects.streamProperties);\n\n                        var stateHash = _(state.features)\n                            .map(function(feature) {\n                                var stateModel = new HierarchicalGeometryViewModel();\n                                var prop = feature.properties;\n                                stateModel.id = prop.gid;\n                                stateModel.name = prop.name;\n                                stateModel.centroidLatitude = NaN;\n                                stateModel.shortName = prop.short_name;\n                                stateModel.centroidLongitude = NaN;\n                                stateModel.parent = null;\n                                stateModel.type = 'state';\n                                stateModel.children = [];\n                                stateModel.geometry = feature;\n                                return stateModel;\n                            })\n                            .indexBy('id')\n                            .value();\n\n                        var regionHash = _(regions.features)\n                            .map(function(feature) {\n                                var regionModel = new HierarchicalGeometryViewModel();\n                                regionModel.shortName = feature.properties.name;\n                                regionModel.id = feature.properties.gid;\n                                regionModel.name = feature.properties.name;\n                                regionModel.geometry = feature;\n                                regionModel.type = 'region';\n                                return regionModel;\n                            })\n                            .sortBy('name')\n                            .indexBy('id')\n                            .value();\n\n                        var countyhash = _(counties.features)\n                            .filter(function(feature) {\n                                return feature.properties.stream_count > 0;\n                            })\n                            .map(function(feature) {\n                                var countyModel = new HierarchicalGeometryViewModel();\n                                var properties = feature.properties;\n                                countyModel.id = properties.gid;\n                                countyModel.name = properties.name;\n                                countyModel.geometry = feature;\n                                _.extend(countyModel, properties);\n                                countyModel.type = 'county';\n                                return countyModel;\n                            })\n                            .sortBy('name')\n                            .indexBy('id')\n                            .value();\n\n                        var countyByRegion = _(countyhash)\n                            .groupBy('region_id')\n                            .value();\n\n                        // TODO: Fix this nonsense.\n                        var minnesota = stateHash['49'];\n                        var regionByState = _(regionHash)\n                            .groupBy(function() {\n                                return minnesota.id;\n                            })\n                            .value();\n\n                        var streamHash = _(streams.features)\n                            .map(function(feature) {\n                                var streamModel = new HierarchicalGeometryViewModel();\n                                var properties = feature.properties;\n                                streamModel.id = properties.Id;\n                                streamModel.name = properties.Name;\n                                streamModel.geometry = feature;\n                                streamModel.centroidLongitude = properties.CentroidLongitude;\n                                streamModel.centroidLatitude = properties.CentroidLatitude;\n                                _.extend(streamModel, properties);\n                                // console.table(streamModel.AccessPoints);\n                                streamModel.type = 'streamCentroid';\n                                return streamModel;\n                            })\n                            .sortBy('name')\n                            .indexBy('id')\n                            .value();\n\n                        _.forEach(stateHash, function(state) {\n                            var stateId = state.id;\n                            var regions = regionByState[stateId];\n                            state.children = regions;\n                            // _(regions).forEach(function(r) { r.parent = state; });\n                            _.forEach(state.children, function(region) {\n                                var regionId = region.id;\n                                var counties = countyByRegion[regionId];\n                                region.children = counties;\n                                region.parent = state;\n                                _.forEach(region.children, function(c) {\n                                    c.parent = region;\n                                });\n                            });\n                        });\n\n                        // now we have to get the streams under the counties.\n                        // we have to respect the Many to Many relationship.\n                        _.forEach(streamHash, function(stream) {\n                            _.forEach(stream.Counties, function(streamCountyModel) {\n                                var countyModel = countyhash[streamCountyModel.Id];\n                                countyModel.children.push(stream);\n                                // what to do about the parent tho?\n                            });\n                        });\n\n                        this.logCache();\n                        return stateHash;\n\n                    }.bind(this));\n                this.cache.put(key, promise);\n                return promise;\n            };\n\n            TableOfContentsRepository.prototype = proto;\n            return new TableOfContentsRepository();\n        }\n    ]);\n'use strict';\n\n/**\n * @ngdoc service\n * @name troutDashApp.HierarchicalGeometryViewModel\n * @description\n * # HierarchicalGeometryViewModel\n * Factory in the troutDashApp.\n */\nangular.module('troutSpotr')\n  .factory('HierarchicalGeometryViewModel', function () {\n    function HierarchicalGeometryViewModel() {\n        this.init();\n    }\n\n    HierarchicalGeometryViewModel.prototype =  {\n      id: null,\n      name: '',\n      shortName: '',\n      geometry: null,\n      centroidLatitude: NaN,\n      centroidLongitude: NaN,\n      type: null,\n      parent: null,\n      children: [],\n\n      init: function() {\n        this.id = null;\n        this.name = '';\n        this.shortName = '';\n        this.geometry = null;\n        this.centroidLongitude = NaN;\n        this.centroidLatitude = NaN; \n        this.parent = null;\n        this.children = [];\n      }\n    };\n\n\n    return HierarchicalGeometryViewModel;\n  });\n\n'use strict';\n\n/**\n * @ngdoc service\n * @name troutDashApp.HierarchicalGeometryCollection\n * @description\n * # HierarchicalGeometryCollection\n * Factory in the troutDashApp.\n */\nangular.module('troutSpotr')\n  .factory('HierarchicalGeometryCollection', function (BaseCollection, HierarchicalGeometryViewModel) {\n    function HierarchicalGeometryCollection(data) {\n        BaseCollection.call(this, data);\n    }\n\n    /** @lends  HierarchicalGeometryCollection.prototype */\n    var proto = HierarchicalGeometryCollection.prototype = Object.create(BaseCollection.prototype);\n    HierarchicalGeometryCollection.prototype.constructor = HierarchicalGeometryCollection;\n\n    /**\n     * Constructor used to create models from JSON data\n     * @property {Function} model HierarchicalGeometryViewModel constructor function\n     */\n    proto.model = HierarchicalGeometryViewModel;\n\n    return HierarchicalGeometryCollection;\n  });\n\n'use strict';\n\n/**\n * @ngdoc service\n * @name troutDashApp.RegionRepositoryService\n * @description\n * # RegionRepositoryService\n * Factory in the troutDashApp.\n */\nangular.module('troutSpotr')\n  .factory('RegionRepositoryService', function (RegionGeometryService, TableOfContentsRepository, $q) {\n    var RegionRepositoryService = function () {\n        \n    };\n\n    var proto = {\n    \tgetRegions: function() {\n    \t\treturn TableOfContentsRepository.getTableOfContents()\n    \t\t\t.then(function(states) {\n    \t\t\t\tconsole.log('got em');\n    \t\t\t});\n    \t},\n\n    \tisCached: function(regionid) {\n            return false;\n    \t},\n\n    \tcacheRegion: function(regionId) {\n            return true;\n    \t},\n\n    \tuncacheRegion: function(regionId) {\n            return true;\n    \t},\n\n        getRegion: function(regionId) {\n            if (this.isCached()) {\n                // todo this\n            }\n\n            \n        }\n    };\n\n    RegionRepositoryService.prototype = proto;\n    return new RegionRepositoryService();\n  });\n\n'use strict';\n\nvar REGION_CACHE_KEY = 'region';\nvar createKey = function(stateId, regionId) {\n\treturn REGION_CACHE_KEY + '_' + stateId + '_' + regionId;\n};\n/**\n * @ngdoc service\n * @name troutDashApp.RegionGeometryService\n * @description\n * # RegionGeometryService\n * Factory in the troutDashApp.\n */\nangular.module('troutSpotr')\n  .factory('RegionGeometryService', ['BaseApiService', 'RegionApiService', 'HierarchicalGeometryViewModel', \n  \tfunction (BaseApiService, RegionApiService, HierarchicalGeometryViewModel) {\n    var RegionGeometryService = function () {\n        BaseApiService.call(this);\n    };\n\n    var proto = RegionGeometryService.prototype = Object.create(BaseApiService.prototype);\n\n    proto.getRegion = function(stateModel, regionModel) {\n\t\tif (stateModel == null || stateModel.shortName == null) {\n\t\t\tthrow new Error('state cannot be null');\n\t\t}\n\n\t\tif (regionModel == null || regionModel.shortName == null) {\n\t\t\tthrow new Error('region cannot be null');\n\t\t}\n\n\t\tvar stateId = stateModel.shortName;\n\t\tvar regionId = regionModel.shortName;\n\t\tvar regionKey = createKey(stateId, regionId);\n\n        if (this.cache.get(regionKey)) {\n            console.log('found in cache');\n            return this.cache.get(regionKey);\n        }\n\n\t\tvar promise = RegionApiService.getRegion(stateId, regionId)\n\t\t\t.then(function(geometry) {\n\t\t\t\tconsole.log('new geom', geometry);\n\t\t\t\treturn geometry;\n\t\t\t});\n\n        this.cache.put(regionKey, promise);\n    \treturn promise;\n\t};\n\n    RegionGeometryService.prototype = proto;\n    return new RegionGeometryService();\n  }]);\n\n'use strict';\nvar createPath = function(stateId, regionId) {\n  return stateId + '/' + regionId + '.topo.json';\n};\n/**\n * @ngdoc service\n * @name troutDashApp.RegionApiService\n * @description\n * # RegionApiService\n * Factory in the troutDashApp.\n */\nangular.module('troutSpotr')\n  .factory('RegionApiService', ['BaseApiService', function(BaseApiService) {\n    var RegionApiService = function() {\n      BaseApiService.call(this);\n      this.logCache();\n    };\n\n    var proto = RegionApiService.prototype = Object.create(BaseApiService.prototype);\n\n    proto.getRegion = function(stateId, regionId) {\n      if (stateId == null) {\n        throw new Error('stateId cannot be null');\n      }\n\n      if (regionId == null) {\n        throw new Error('regionId cannot be null');\n      }\n\n      var path = createPath(stateId, regionId);\n      return this.doCall({}, 'assets/data/' + path);\n    };\n\n    RegionApiService.prototype = proto;\n    return new RegionApiService();\n  }]);\n'use strict';\n\n/**\n * @ngdoc service\n * @name troutDashApp.StreamRatioViewModel\n * @description\n * # StreamRatioViewModel\n * Factory in the troutDashApp.\n */\nangular.module('troutSpotr')\n  .factory('StreamRatioViewModel', function () {\n        var StreamRatioViewModel = function(totalLength, publicLandLength) {\n            this.totalLength = 0;\n            this.publicLandLength = 0;\n            this.init(totalLength, publicLandLength);\n        };\n\n        var proto = StreamRatioViewModel.prototype;\n\n        proto.init = function(totalLength, publicLandLength) {\n            if (totalLength == null || publicLandLength < 0) {\n                throw new Error('totalLength cannot be null or less than 0');\n            }\n\n            if (publicLandLength == null || publicLandLength < 0) {\n                throw new Error('publicLength cannot be null or less than 0');\n            }\n\n            if (publicLandLength > totalLength) {\n                // clamp - technically this can be true, given the fact\n                // that a stream can have easement and not be a trout stream section.\n                // BUG: Currently we're computing how much is on trout streams.\n\n                publicLandLength = totalLength;\n            }\n\n            this.totalLength = totalLength;\n            this.publicLandLength = publicLandLength;\n\n            var computeRadiusFromLength = function(length) {\n                var area = Math.sqrt(length / Math.PI);\n                return area;\n            };\n\n            this.waterRadius = computeRadiusFromLength(this.totalLength);\n            // LIE about the width.\n           \t// use the diameter of the water ratio to determine how large\n           \tvar publicLandLengthTOWaterLengthRatio = this.publicLandLength / this.totalLength;\n            this.publicLandRadius = this.waterRadius * publicLandLengthTOWaterLengthRatio;\n        };\n\n        return StreamRatioViewModel;\n  });\n\n'use strict';\n\n/**\n * @ngdoc service\n * @name troutDashApp.StreamApiService\n * @description\n * # StreamApiService\n * Factory in the troutDashApp.\n */\nangular.module('troutSpotr')\n  .factory('StreamApiService', ['$rootScope', '$cacheFactory', '$http', '$q', '$timeout',\n    function($rootScope, $cacheFactory, $http, $q, $timeout) {\n      function StreamApiService() {\n\n      }\n\n      StreamApiService.prototype = {\n        getStreams: function() {\n          var deferred = $q.defer();\n\n          $timeout(function() {\n            var gettingData = $http.get('./data/trout-dash-minnesota.json')\n              .then(function(response) {\n                return response.data;\n              });\n\n            deferred.resolve(gettingData);\n          }, 1000);\n\n          return deferred.promise;\n        },\n\n        getRegions: function() {\n          // return $http.get('./data/regionDetails.json')\n          //   .then(function(response) {\n          //     return response.data;\n          //   });\n\n          var deferred = $q.defer();\n\n          $timeout(function() {\n            var gettingData = $http.get('./data/regionDetails.json')\n              .then(function(response) {\n                return response.data;\n              });\n\n            deferred.resolve(gettingData);\n          }, 1000);\n\n          return deferred.promise;\n        }\n      };\n\n      return new StreamApiService();\n    }\n  ]);\n'use strict';\n\n/**\n * @ngdoc service\n * @name troutDashApp.LinearReferenceViewModel\n * @description\n * # LinearReferenceViewModel\n * Factory in the troutDashApp.\n */\nangular.module('troutSpotr')\n  .factory('LinearReferenceViewModel', function () {\n    var StreamLineViewModel = function (lineSegment, inverseLength) {\n        this.lineSegment = null;\n        this.xOffset = 0.0;\n        this.width = 0.0;\n        this.init(lineSegment, inverseLength);\n    };\n\n    StreamLineViewModel.prototype.init = function(lineSegment, inverseLength) {\n      this.lineSegment = lineSegment;\n      var stop = lineSegment.Stop * inverseLength;\n      var start = lineSegment.Start * inverseLength;\n      this.xOffset = 1.0 - stop;\n      this.width = Math.abs(stop - start);\n    };\n\n    return StreamLineViewModel;\n  });\n\n'use strict';\n\n/**\n * @ngdoc service\n * @name troutDashApp.GeometryApiService\n * @description\n * # GeometryApiService\n * Factory in the troutDashApp.\n */\nangular.module('troutSpotr')\n  .factory('GeometryApiService', ['$rootScope', '$cacheFactory', '$http', '$q', '$timeout',\n    function ($rootScope, $cacheFactory, $http, $q, $timeout) {\n    function GeometryApiService() {\n\n    }\n\n    GeometryApiService.prototype = {\n      getRegionGeometries: function() {\n        var deferred = $q.defer();\n\n          $timeout(function() {\n            var gettingData = $http.get('./data/regionGeometry.json')\n            .then(function(response) {\n              return response.data;\n            });\n\n            deferred.resolve(gettingData);\n          }, 1000);\n\n          return deferred.promise;\n      }\n    };\n\n    return new GeometryApiService();\n  }]);\n\n'use strict';\n\n/**\n * @ngdoc service\n * @name troutDashApp.BaseModel\n * @description\n * # BaseModel\n * Factory in the troutDashApp.\n */\nangular.module('troutSpotr')\n  .factory('BaseModel', function () {\n    function BaseModel(json) {\n        if (json) {\n            this._fromJSON(json);\n        }\n    }\n\n    /** @lends  BaseModel.prototype */\n    BaseModel.prototype = {\n        constructor: BaseModel,\n        /**\n         * Merges properties from a POJO into the model\n         * @param  {Object} json raw data\n         */\n        _fromJSON: function(json) {\n            var key;\n            for (key in json) {\n                if (json.hasOwnProperty(key)) {\n                    this[key] = json[key];\n                }\n            }\n        },\n\n        /**\n         * Returns an object hash of the model properties\n         * @return {Object}\n         */\n        toJSON: function() {\n            var hash = {};\n            var key;\n            for (key in this) {\n                if (this.hasOwnProperty(key) && typeof this[key] !== 'function') {\n                    hash[key] = this[key];\n                }\n            }\n\n            return hash;\n        },\n\n        destroy: function() {\n            var key;\n            for (key in this) {\n                if (this.hasOwnProperty(key)) {\n                    delete this[key];\n                }\n            }\n        }\n    };\n\n    BaseModel.generateIdomaticName = function(model) {\n        return model.type;\n    };\n\n    return BaseModel;\n  });\n\n'use strict';\n\n/**\n * @ngdoc service\n * @name troutDashApp.BaseCollection\n * @description\n * # BaseCollection\n * Factory in the troutDashApp.\n */\nangular.module('troutSpotr')\n  .factory('BaseCollection', function (BaseModel) {\n    function BaseCollection(udefOrArray) {\n        this._models = [];\n        if (udefOrArray) {\n            this._addAll(udefOrArray);\n        }\n    }\n\n    /** @lends BaseCollection.prototype */\n    BaseCollection.prototype = {\n\n        /**\n         * @property {Function} model BaseModel constructor function, used to convert raw JSON into models\n         */\n        model: BaseModel,\n        constructor: BaseCollection,\n\n        /**\n         * @property {BaseModel[]} _models Reference store for model instances\n         */\n        _models: null,\n\n        /**\n         * @property {Number} Number of models in the colleciton\n         */\n        length: 0,\n\n        /**\n         * @method\n         * @return {Object[]} Array of POJO model data\n         */\n        toJSON: function() {\n            return this.map(function(model) {\n                return model.toJSON();\n            });\n        },\n\n        toArray: function() {\n            return this._models.slice();\n        },\n\n        destroy: function() {\n            this.each(function(model) {\n                model.destroy();\n            });\n            this._models.length = 0;\n            this._models = null;\n        },\n\n        /**\n         * @method\n         * @param {BaseModel[]|null} arrayOrUndefined Returns a new instance of BaseCollection.\n         * @return {BaseCollection} Returns a copy of the collection. If an array of BaseModels are passed, only those\n         *                          models are included. Otherwise, the full collection is copied.\n         */\n        copy: function(arrayOrUndefined) {\n            if (arrayOrUndefined) {\n                return new this.constructor(arrayOrUndefined);\n            }\n\n            return new this.constructor(this._models);\n        },\n\n        /**\n         * @method\n         * @param {Object[]|BaseModel[]} modelData Convenience method for adding many models.  Iterates and calls #add\n         * @see add\n         */\n        _addAll: function(modelData) {\n            var i;\n            var len = modelData.length;\n            for (i = 0; i < len; i++) {\n                this.add(modelData[i]);\n            }\n        },\n\n        /**\n         * Adds a model to the collection.  If type Object is passed, it gets passed to new {this.model} first\n         * @method\n         * @param {Object|BaseModel} modelData Model data to add\n         */\n        add: function(modelData) {\n            var instanceModel;\n            if (!(modelData instanceof this.model)) {\n                instanceModel = new this.model(modelData);\n            } else {\n                instanceModel = modelData;\n            }\n\n            this._models.push(instanceModel);\n            this.length++;\n            return this.length;\n        },\n\n        /**\n         * Remove a model from the collection.  Delegates to _removeByModel or _removeByModelId based on the parameter\n         * @method\n         * @param {BaseModel|Number} modelDataOrId Model instance or model id value\n         * @return {Number} Length of the collection after attempting to remove the model\n         */\n        remove: function(modelDataOrId) {\n            var model;\n            // avoid concurrency bug\n            var referenceToModelOrId = modelDataOrId;\n            if (referenceToModelOrId instanceof this.model) {\n                model = this._removeByModel(referenceToModelOrId);\n            } else {\n                model = this._removeById(referenceToModelOrId);\n            }\n\n            if (model && model !== -1) {\n                this.length--;\n            }\n\n            return this.length;\n        },\n\n        /**\n         * Remove all elements from the collection and reset its length to 0\n         * @method\n         */\n        empty: function() {\n            this._models.length = 0;\n            this.length = 0;\n        },\n\n        /**\n         * Return the first element from the collection\n         * Especially useful for creating non-queue based pools\n         * @return {BaseModel|undefined}\n         */\n        first: function() {\n            return this._models[0];\n        },\n\n        /**\n         * Applies browser-standard sorting via Array.prototype.sort to _models\n         * @method\n         * @param {Function} sortFn Sorting function to use\n         */\n        sort: function(sortFn) {\n            this._models.sort(sortFn);\n        },\n\n        /**\n         * Applies browser-standard sorting via Array.prototype.sort to _models.  Directly compares model keys\n         * @method\n         * @param {String} key      Model key to sort by\n         * @param {Boolean|Undefined} sortDesc If true, sorts by descending order\n         */\n        sortBy: function(key, sortDesc) {\n            this.sort(function(modelA, modelB) {\n                var a = modelA[key];\n                var b = modelB[key];\n\n                if (sortDesc) {\n                    return a > b ? -1 : a < b ? 1 : 0;\n                } else {\n                    return a < b ? -1 : a > b ? 1 : 0;\n                }\n            });\n        },\n\n        /**\n         * Strategy method for browser-standard sorting via Array.prototype.sort to _models. Delegates sorting to a\n         * private method based on the type parameter\n         * @method\n         * @param {String} key      Model key to sort by\n         * @param {Boolean|Undefined} sortDesc If true, sorts by descending order\n         * @param {BaseCollection.SORT.TYPE} type Sorting method is delegated by the type value\n         */\n        sortByType: function(key, sortDesc, type) {\n            if (type === 'string') {\n                this.sortByString(key, sortDesc, true);\n            } else if (type === 'arrayLength') {\n                this.sortByCount(key, sortDesc);\n            } else if (type === 'number') {\n                this.sortByNumber(key, sortDesc);\n            } else {\n                this.sortBy(key, sortDesc);\n            }\n        },\n\n        /**\n         * Strategy method for browser-standard sorting via Array.prototype.sort to _models. Key must be a model\n         * property of type String.\n         * Default sort is ascii order, unless useLowercase is true\n         * @method\n         * @param {String} key      Model key to sort by\n         * @param {Boolean|Undefined} sortDesc If true, sorts by descending order\n         * @param {Boolean} [type=false] Use alphabetical instead of ascii\n         */\n        sortByString: function(key, sortDesc, useLowercase) {\n            this.sort(function(modelA, modelB) {\n                var a = modelA[key];\n                var b = modelB[key];\n\n                if (useLowercase) {\n                    a = a.toLowerCase();\n                    b = b.toLowerCase();\n                }\n\n                if (sortDesc) {\n                    return a > b ? -1 : a < b ? 1 : 0;\n                } else {\n                    return a < b ? -1 : a > b ? 1 : 0;\n                }\n            });\n        },\n\n        /**\n         * Strategy method for browser-standard sorting via Array.prototype.sort to _models. Key must be a model\n         * property of type Array.\n         * Default sort is ascending order, unless sortDesc is true\n         * @method\n         * @param {String} key      Model key to sort by\n         * @param {Boolean|Undefined} sortDesc If true, sorts by descending order\n         * @param {Boolean} [type=false] Use descending or ascending order (ascending is default)\n         */\n        sortByCount: function(key, sortDesc) {\n            this.sort(function(modelA, modelB) {\n                var a = modelA[key] ? modelA[key].length : 0;\n                var b = modelB[key] ? modelB[key].length : 0;\n\n                if (sortDesc) {\n                    return a > b ? -1 : a < b ? 1 : 0;\n                } else {\n                    return a < b ? -1 : a > b ? 1 : 0;\n                }\n            });\n        },\n\n         /**\n         * Strategy method for browser-standard sorting via Array.prototype.sort to _models. Key must be a model\n         * property of type Array.\n         * Default sort is ascending order, unless sortDesc is true\n         * @method\n         * @param {String} key      Model key to sort by\n         * @param {Boolean|Undefined} sortDesc If true, sorts by descending order\n         * @param {Boolean} [type=false] Use descending or ascending order (ascending is default)\n         */\n        sortByNumber: function(key, sortDesc) {\n            this.sort(function(modelA, modelB) {\n                var a = modelA[key] ? modelA[key] : 0;\n                var b = modelB[key] ? modelB[key] : 0;\n\n                if (sortDesc) {\n                    return a > b ? -1 : a < b ? 1 : 0;\n                } else {\n                    return a < b ? -1 : a > b ? 1 : 0;\n                }\n            });\n        },\n\n        /**\n         * @method\n         * @param  {Number|String} id ID of the model to return\n         * @return {BaseModel}    Found model\n         */\n        get: function(id) {\n            var i = 0;\n            var len = this._models.length;\n            for (; i < len; i++) {\n                // Some server IDs are BIGINT (strings), others are numbers. However, all are auto-incremented, so\n                // 0 is never a valid identifier and type coersion is both acceptable and necessary in this case.\n                /* jshint eqeqeq:false */\n                if (this._models[i].id == id) {\n                    return this._models[i];\n                }\n            }\n        },\n\n        /**\n         * Return the model at the given index.  Appropriate only when .each is not acceptable (i.e. in a for loop)\n         * @param  {Integer} index index of the model\n         * @return {BaseModel}\n         */\n        at: function(index) {\n            return this._models[index];\n        },\n\n        /**\n         * @method\n         * @param  {Number} pageNumber Starting index of models to return\n         * @param  {Number} perPage    Range length of models to return\n         * @return {BaseModel[]}       Array of models starting at pageNumber up to but not including pageNumber+perPage\n         */\n        getPage: function(pageNumber, perPage) {\n            var startIndex = perPage * (pageNumber - 1);\n            var endIndex = startIndex + perPage;\n\n            if (startIndex > this._models.length - 1) {\n                return [];\n            }\n\n            return this._models.slice(startIndex, endIndex);\n        },\n\n        contains: function(id) {\n            var i;\n            var len = this.length;\n            for (i = 0; i < len; i++) {\n                if (this._models[i].id === id) {\n                    return true;\n                }\n            }\n            return false;\n        },\n\n        /**\n         * Compare this collection to another, then\n         *   remove and add items individually until the two match\n         * @param otherCollection {BaseCollection}\n         *   A collection of the same type as `this`\n         * @return {Object<Array<?>>}\n         *   A diff representing the changes made to this object. Example:\n         *   - this collection's IDs: [1, 2, 3, 4, 5]\n         *   - other collection's IDs: [4, 5, 6, 7]\n         *   - after merge, this collection's IDs: [4, 5, 6, 7]\n         *   - return value: {removed: [1, 2, 3], added: [6, 7]}\n         */\n        merge: function(otherCollection) {\n            var self;\n            var removed; \n            var added;\n\n            // Ignore collections of different types\n            if (this.constructor !== otherCollection.constructor) {\n                return []; // exit early\n            }\n\n            self = this;\n            removed = [];\n            added = [];\n\n            // Remove models\n            this.each(function(element, index) {\n                if (!otherCollection.contains(element.id)) {\n                    this.remove(element.id);\n                    removed.push(element.id);\n                }\n            });\n\n            // Add model objects\n            otherCollection.each(function(element, index) {\n                if (!this.contains(element.id)) {\n                    this.add(element);\n                    added.push(element.id);\n                }\n            });\n\n            return {\n                'removed': removed,\n                'added': added\n            };\n\n        },\n\n        /**\n         * @method\n         * @param  {Number} id ID of model to remove\n         * @return {BaseModel|Number} Model removed, or -1 if model not found\n         */\n        _removeById: function(id) {\n            var len = this.length;\n            var i;\n\n            for (i = 0; i < len; i++) {\n                if (this._models[i].id === id) {\n                    return this._models.splice(i, 1);\n                }\n            }\n        },\n\n        /**\n         * @method\n         * @param  {BaseModel} Model to remove\n         * @return {BaseModel|Number} Model removed, or -1 if model not found\n         */\n        _removeByModel: function(model) {\n            var len = this.length;\n            var i;\n\n            for(i = 0; i < len; i++) {\n                if (this._models[i] === model) {\n                    return this._models.splice(i, 1);\n                }\n            }\n        }\n    };\n\n    // Borrowed from Backbone\n    // @see http://backbonejs.org/docs/backbone.html\n    var methods = [\n        'forEach',\n        'each',\n        'map',\n        'reduce',\n        'find',\n        'filter',\n        'indexOf'\n    ];\n\n    _.each(methods, function(method) {\n        BaseCollection.prototype[method] = function() {\n            var args = Array.prototype.slice.call(arguments);\n            args.unshift(this._models);\n            return _[method].apply(_, args);\n        };\n    });\n\n    /**\n     * Sorting constants\n     * @memberOf BaseCollection\n     * @constant\n     */\n    BaseCollection.SORT = {\n        /** @enum Sorting types */\n        TYPE: {\n            ARRAY_LENGTH: 'arrayLength',\n            STRING: 'string',\n            DATE: 'date',\n            NUMBER: 'number'\n        }\n    };\n\n    return BaseCollection;\n  });\n\n'use strict';\n\n/**\n * @ngdoc service\n * @name troutDashApp.BaseApiService\n * @description\n * # BaseApiService\n * Factory in the troutDashApp.\n */\n\n\n\nangular.module('troutSpotr')\n  .factory('BaseApiService', ['$rootScope', '$cacheFactory', '$http', '$q', '$timeout',\n    function ($rootScope, $cacheFactory, $http, $q, $timeout) {\n    var sessionStorage = window.sessionStorage;\n    var DEBUGGER_LATENCY = 800;\n    var globalCache = $cacheFactory('du');\n\n    function BaseApiService() {\n        this.cache = globalCache;\n    }\n\n    BaseApiService.prototype = {\n      cache: null,\n      resetCache: function() {\n          globalCache.removeAll();\n      },\n\n      logCache: function() {\n        var info = this.cache.info();\n        console.log('cache', info);\n      },\n\n      doCall: function(data, endpoint, cache) {\n        cache = false;\n\n        var config = {\n            url: BaseApiService.API_BASE_PATH + endpoint,\n            params: data,\n            cache: cache,\n            method: 'GET'\n        };\n\n        var deferred = $q.defer();\n\n          $timeout(function() {\n            var gettingData = $http(config)\n              .then(function(response) {\n                  if (response && response.data && response.data.exceptionType) {\n                      return $q.reject(response.data);\n                  }\n\n                  return response.data;\n              }).catch(function(reason) {\n                  // perform some operation here if need be...\n                  return $q.reject(reason);\n              });\n\n            deferred.resolve(gettingData);\n          }, DEBUGGER_LATENCY);\n\n          return deferred.promise;\n      }\n    };\n\n    BaseApiService.API_BASE_PATH = '';\n\n    return BaseApiService;\n  }]);\n\n(function() {\n  'use strict';\n\n  angular\n    .module('troutSpotr')\n    .run(runBlock);\n\n  /** @ngInject */\n  function runBlock($log) {\n\n    $log.debug('runBlock end');\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('troutSpotr')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig($stateProvider, $urlRouterProvider) {\n    $stateProvider\n      .state('home', {\n        url: '/',\n        templateUrl: 'app/ui/main/main.html',\n        controller: 'MainController',\n        controllerAs: 'main'\n      });\n\n    $urlRouterProvider.otherwise('/');\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('troutSpotr');\n    // .constant('malarkey', malarkey)\n    // .constant('moment', moment);\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('troutSpotr')\n    .config(config);\n\n  /** @ngInject */\n  function config($logProvider) {\n    // Enable log\n    $logProvider.debugEnabled(true);\n  }\n\n})();\n\nangular.module(\"troutSpotr\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"app/ui/accessPointSummary/AccessPointSummaryTallyTemplate.html\",\"<svg class=\\\"js-tally-root access-point\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" width=\\\"100%\\\" height=\\\"100%\\\" viewbox=\\\"0 0 32 24\\\"></svg>\");\n$templateCache.put(\"app/ui/accessPointSummary/AccessPointSummaryTemplate.html\",\"<span class=\\\"access-point\\\"><span data-ng-class=\\\"{\\'hide\\': numerator === 0}\\\" class=\\\"numerator\\\">{{::numerator}}:</span><span class=\\\"denominator\\\">{{::denominator}}</span></span>\");\n$templateCache.put(\"app/ui/main/main.html\",\"<div class=\\\"container\\\"><div data-mini-map-directive=\\\"\\\"></div><div data-stream-list=\\\"\\\"></div></div>\");\n$templateCache.put(\"app/ui/miniMap/minimaptemplate.html\",\"<div class=\\\"somethingContainer\\\" data-ng-class=\\\"{\\'somethingContainer-major\\': minimapState.isMacro}\\\"><div class=\\\"js-mini-map something\\\"></div></div>\");\n$templateCache.put(\"app/ui/restrictions/restrictionlegendtemplate.html\",\"<ul class=\\\"restrictions\\\" data-ng-repeat=\\\"restriction in stream.Restrictions\\\"><li><div class=\\\"media\\\"><div class=\\\"media-hd legend\\\" data-ng-class=\\\"{\\'stream-line_restriction\\': $index === 0, \\'stream-line_restriction_secondary\\': $index === 1}\\\"></div><span class=\\\"media-bd heading\\\">{{restriction.FullText}}</span></div></li></ul>\");\n$templateCache.put(\"app/ui/restrictions/streamrestrictiontemplate.html\",\"<ul class=\\\"restrictions\\\" data-ng-repeat=\\\"restriction in restrictionViewModel.restrictions\\\"><li><div class=\\\"media\\\"><div class=\\\"media-hd legend {{restriction.cssClass}}\\\"></div><span class=\\\"media-bd heading\\\">{{restriction.text}}</span></div></li></ul>\");\n$templateCache.put(\"app/ui/speciesSummary/speciessummarytemplate.html\",\"<span class=\\\"icon\\\"><svg preserveaspectratio=\\\"xMidYMid meet\\\" width=\\\"100%\\\" height=\\\"100%\\\" viewbox=\\\"0 0 16 16\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" class=\\\"species\\\"><g><g class=\\\"species brown\\\"><circle class=\\\"population\\\" data-is-populated=\\\"{{::stream.HasBrownTrout}}\\\" data-ng-class=\\\"{\\'none\\': stream.HasBrownTrout === false}\\\" cx=\\\"4\\\" cy=\\\"12\\\" r=\\\"2.5\\\"></circle><circle class=\\\"stocking {{stream.HasStockedBrownTrout ? \\'stocked\\' : \\'none\\'}}\\\" data-is-stocked=\\\"{{::stream.HasStockedBrownTrout}}\\\" cx=\\\"4\\\" cy=\\\"12\\\" r=\\\"2.7\\\"></circle></g><g class=\\\"species brook\\\"><circle class=\\\"population\\\" data-is-populated=\\\"{{::stream.HasBrookTrout}}\\\" data-ng-class=\\\"{\\'none\\': stream.HasBrookTrout === false}\\\" cx=\\\"12\\\" cy=\\\"12\\\" r=\\\"2.5\\\"></circle><circle class=\\\"stocking {{stream.HasStockedBrookTrout ? \\'stocked\\' : \\'none\\'}}\\\" data-is-stocked=\\\"{{::stream.HasStockedBrookTrout}}\\\" cx=\\\"12\\\" cy=\\\"12\\\" r=\\\"2.7\\\"></circle></g><g class=\\\"species rainbow\\\"><circle class=\\\"population\\\" data-is-populated=\\\"{{::stream.HasRainbowTrout}}\\\" data-ng-class=\\\"{\\'none\\': stream.HasRainbowTrout === false}\\\" cx=\\\"8\\\" cy=\\\"5.0718\\\" r=\\\"2.5\\\"></circle><circle class=\\\"stocking {{stream.HasStockedRainbowTrout ? \\'stocked\\' : \\'none\\'}}\\\" data-is-stocked=\\\"{{::stream.HasStockedRainbowTrout}}\\\" cx=\\\"8\\\" cy=\\\"5.0718\\\" r=\\\"2.7\\\"></circle></g></g></svg></span>\");\n$templateCache.put(\"app/ui/streamLine/streamlinetemplate.html\",\"<div class=\\\"js-stream-line\\\"></div>\");\n$templateCache.put(\"app/ui/streamList/streamlisttemplate.html\",\"<div data-ng-cloak=\\\"\\\" id=\\\"js-list-container\\\"><div data-ng-repeat=\\\"region in mapState.selectedRegion | limitTo:1 | orderBy:\\'name\\'\\\" id=\\\"{{::getRegionId(region)}}\\\" data-region-header=\\\"\\\"></div></div>\");\n$templateCache.put(\"app/ui/streamRatio/streamratiotemplate.html\",\"<svg class=\\\"stream-ratio\\\" preserveaspectratio=\\\"xMidYMid meet\\\" width=\\\"100%\\\" height=\\\"100%\\\" viewbox=\\\"0 0 16 16\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><g class=\\\"stream-line_route\\\"><circle cx=\\\"8\\\" cy=\\\"8\\\" ng-attr-r=\\\"{{::streamRatio.waterRadius * 2.2}}\\\"></circle></g><g class=\\\"stream-ratio_public-land\\\"><circle cx=\\\"8\\\" cy=\\\"8\\\" ng-attr-r=\\\"{{::streamRatio.publicLandRadius * 2.2}}\\\"></circle></g></svg>\");\n$templateCache.put(\"app/ui/streamList/county/CountyHeaderTemplate.html\",\"<div fsm-sticky-header=\\\"\\\" scroll-body=\\\"getCountyScrollBodyId(county)\\\" scroll-stop=\\\"23\\\" scroll-object=\\\"county\\\" z-index-override=\\\"10000\\\" class=\\\"sectionTitle region-header\\\">{{::county.name}} Co. {{displayedStreams.length}} : {{county.children.length}}</div><div infinite-scroll=\\\"loadMoreStreams()\\\" infinite-scroll-distance=\\\"1\\\"><div ng-class-odd=\\\"\\'box\\'\\\" ng-class-even=\\\"\\'box box-secondary\\'\\\" data-ng-repeat=\\\"stream in displayedStreams\\\"><div data-stream-list-item-directive=\\\"\\\"></div></div></div>\");\n$templateCache.put(\"app/ui/streamList/region/RegionHeaderTemplate.html\",\"<div fsm-sticky-header=\\\"\\\" scroll-body=\\\"getRegionScrollBodyId(region)\\\" scroll-stop=\\\"0\\\" scroll-object=\\\"region\\\" z-index-override=\\\"10100\\\" class=\\\"sectionTitle region-header\\\"><a id=\\\"region-hdr_{{region.id}}\\\" href=\\\"#\\\">{{::region.name}} {{displayedCounties.length}} : {{region.children.length}}</a></div><div infinite-scroll=\\\"loadMoreCounties()\\\" infinite-scroll-distance=\\\"1\\\"><div data-ng-repeat=\\\"county in displayedCounties\\\" id=\\\"{{::getCountyId(county)}}\\\" data-county-header=\\\"\\\"></div></div>\");\n$templateCache.put(\"app/ui/streamList/streamListItem/StreamListItemHeaderTemplate.html\",\"<div class=\\\"header-container\\\"><div data-ng-click=\\\"expand()\\\" class=\\\"primary\\\"><span data-stream-ratio=\\\"\\\" class=\\\"icon\\\"></span> <span class=\\\"title\\\">{{::stream.Name}}</span></div><div class=\\\"details header-container\\\"><div class=\\\"icon\\\"><div data-species-summary=\\\"\\\"></div></div><div class=\\\"icon\\\" data-access-point-summary-tally=\\\"\\\"></div><div class=\\\"icon\\\"><svg class=\\\"alert\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" width=\\\"40%\\\" height=\\\"40%\\\" viewbox=\\\"0 0 32 32\\\"><path d=\\\"M31.858 27.675c-3.196-5.42-11.116-18.857-14.395-24.42-0.987-1.672-1.947-1.641-2.859-0.096-3.223 5.464-11.137 18.878-14.395 24.402-0.004 0.006-0.87 2.439 0.954 2.439h29.561c1.969 0 1.048-2.471 1.134-2.325z\\\"></path><text class=\\\"alert-text\\\" x=\\\"12\\\" y=\\\"25\\\" font-family=\\\"Futura\\\" font-size=\\\"24\\\">!</text></svg></div></div></div>\");\n$templateCache.put(\"app/ui/streamList/streamListItem/streamlistitemtemplate.html\",\"<div class=\\\"box\\\" data-stream-id=\\\"{{::stream.Id}}\\\"><div><div data-stream-list-item-header=\\\"\\\"></div><div data-ng-if=\\\"isSmall === false\\\"><div class=\\\"containerBody grid-row\\\"><div class=\\\"grid-row-col_12of12\\\"><div data-stream-line=\\\"\\\"></div></div></div><div class=\\\"grid-row\\\"><div class=\\\"grid-row-col grid-row-col_9of12 media_list\\\"><div data-ng-if=\\\"stream.Restrictions.length > 0\\\" data-restriction-legend=\\\"\\\"></div><div data-ng-repeat=\\\"accessPoint in stream.AccessPoints | orderBy:\\'LinearOffset\\':true\\\"><span class=\\\"roadIntersectionIndicator\\\" data-ng-class=\\\"{\\'roadIntersectionIndicator_public\\': accessPoint.IsOverOrNearPublicLand}\\\"></span> <span class=\\\"roadIntersectionIndicator troutStreamIntersection\\\" data-ng-class=\\\"{\\'troutStreamIntersection_none\\': accessPoint.IsOverOrNearTroutStreamSection === false}\\\"></span> <a class=\\\"heading\\\" target=\\\"_blank\\\" href=\\\"https://www.google.com/maps/@{{accessPoint.Latitude}},{{accessPoint.Longitude}},17z\\\">{{accessPoint.Name}}</a></div></div><div class=\\\"grid-row-col grid-row-col_3of12\\\"><div data-stream-ratio-text=\\\"\\\"></div></div></div></div></div></div>\");}]);"],"sourceRoot":"/source/"}